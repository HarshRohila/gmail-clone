import{a as e,f as t,h as r,w as i}from"./p-cf919539.js";const n=e=>!("isConnected"in e)||e.isConnected,o=(()=>{let e;return(...t)=>{e&&clearTimeout(e),e=setTimeout((()=>{e=0,(e=>{for(let t of e.keys())e.set(t,e.get(t).filter(n))})(...t)}),2e3)}})(),s=e=>"function"==typeof e,a=e=>"string"==typeof e,u=e=>e.pathname.toLowerCase(),c=e=>u(e)+e.search;let l;const d=(n,d,h,f,p)=>{let y=!1,m=h.href;const R=[],b=[],w=e=>new URL(e,d.baseURI),{state:g,dispose:O}=((r,i)=>{const n=((e,t=((e,t)=>e!==t))=>{let r=new Map(Object.entries(null!=e?e:{}));const i={dispose:[],get:[],set:[],reset:[]},n=()=>{r=new Map(Object.entries(null!=e?e:{})),i.reset.forEach((e=>e()))},o=e=>(i.get.forEach((t=>t(e))),r.get(e)),s=(e,n)=>{const o=r.get(e);t(n,o,e)&&(r.set(e,n),i.set.forEach((t=>t(e,n,o))))},a="undefined"==typeof Proxy?{}:new Proxy(e,{get:(e,t)=>o(t),ownKeys:()=>Array.from(r.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>r.has(t),set:(e,t,r)=>(s(t,r),!0)}),u=(e,t)=>(i[e].push(t),()=>{((e,t)=>{const r=e.indexOf(t);r>=0&&(e[r]=e[e.length-1],e.length--)})(i[e],t)});return{state:a,get:o,set:s,on:u,onChange:(t,r)=>{const i=u("set",((e,i)=>{e===t&&r(i)})),n=u("reset",(()=>r(e[t])));return()=>{i(),n()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(u("set",t.set)),t.get&&e.push(u("get",t.get)),t.reset&&e.push(u("reset",t.reset)),t.dispose&&e.push(u("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{i.dispose.forEach((e=>e())),n()},reset:n,forceUpdate:e=>{const t=r.get(e);i.set.forEach((r=>r(e,t,t)))}}})(r,i);return n.use((()=>{if("function"!=typeof e)return{};const r=new Map;return{dispose:()=>r.clear(),get:t=>{const i=e();i&&((e,t,r)=>{const i=e.get(t);i?i.includes(r)||i.push(r):e.set(t,[r])})(r,t,i)},set:e=>{const i=r.get(e);i&&r.set(e,i.filter(t)),o(r)},reset:()=>{r.forEach((e=>e.forEach(t))),o(r)}}})()),n})({href:m,path:c(h),hash:h.hash,views:[],popState:!1}),$=e=>{try{null!=c(e)&&(g.href=e.href)}catch(e){console.error(e)}},z=(e,t)=>{for(let r=0;r<t.length;r++){const i=t[r],n=v(u(e),i.path);if(n)return null!=i.to?($(w(i.to)),z(w(i.to),t)):{params:n,route:i,index:r}}},A=async(e,t=!1)=>{const r=w(e);if(g.href!==r.href){b.forEach((t=>{try{t(w(e),w(m))}catch(e){console.error(e)}}));try{(null==p?void 0:p.beforePush)&&await p.beforePush(r)}catch(e){console.error(e)}g.href=r.href,g.popState=t}else t||""===r.hash||(h.href=r.href)},j=e=>{r(((t,r,i)=>{const n=Array.isArray(e.c)?e.c:[e.c];i.forEach(n,((t,r)=>{t&&!a(e.c[r])&&a(t.vtag)&&t.vtag.includes("-")&&(y=!0)}))}),null)},S=e=>r(((t,r,i)=>{const n=Array.isArray(e.c)?e.c:[e.c];return i.map(n,((t,r)=>{if(a(n[r]))return n[r];if(t&&y&&0===e.s){t.vattrs=t.vattrs||{},t.vattrs.class=(t.vattrs.class||"")+" stencil-router-queue";const r=t.vattrs.ref;t.vattrs.ref=t=>{x(e,t),r&&r(t)}}return t}))}),null),x=(e,t)=>{if(t){t.componentOnReady&&e.p.push(t.componentOnReady());const r=t.children;for(let t=0;t<r.length;t++)x(e,r[t])}},k=()=>{if(y||(g.views=[g.views[0]]),1===g.views.length)g.views[0].s=1;else{const e=g.views.filter((e=>0===e.s));if(e.length>0)return e.forEach((e=>{Array.isArray(e.c)&&(e.c=e.c.map((e=>a(e)?"":e)))})),void i((async()=>{const e=g.views[0];await Promise.all(e.p),e.s=1,g.views=[e]}))}const e=g.views[0],t=w(e.h),r=t.href;m!==r&&(((e,t,r,i,n)=>{const o=c(t),s=n.href,a=n.hash.startsWith("#");((e,t)=>c(e)!==c(t))(t,n)&&r.pushState(null,"",s),i||(o!==c(n)?a?t.href=s:e.scrollTo(0,0):a&&(t.href=s))})(n,h,f,e.o,t),g.path=c(t),g.hash=t.hash,R.forEach((e=>{try{e(w(r),w(m))}catch(e){console.error(e)}})),m=r)},F=e=>{if(!s(p.reloadOnPopState)||!p.reloadOnPopState(e))return A(h.href,!0);h.reload()},T=l={Switch:(e,t)=>{const r=z(w(g.href),t);if(r){const e=(e=>{const t=null==e?void 0:e.route;if(t){if(s(t.jsx)){const r=t.mapParams?t.mapParams(e.params,w(g.href)):void 0;return t.jsx(e.params,r)}return t.jsx}})(r),i=z(w(h.href),t),n=(null==i?void 0:i.index)!==(null==r?void 0:r.index);if(e)return((e,t)=>{(e=>{const t=g.views;(0===t.length||t.length>0&&t[0].h!==g.href)&&(g.views=[{s:0,c:e,h:g.href,o:g.popState,p:[]},...t.filter((e=>0!==e.s)).map((e=>({...e,s:2})))])})(e),y=!1;const r=g.views;if(t&&r.length>1)for(const e of r)if(0===e.s&&j(e),!y)break;if(y&&r.length>1)for(const e of r)e.c=S(e);else r[0].c=e;k()})(e,n),g.views.slice().reverse().map((e=>e.c))}},get path(){return g.path},get hash(){return g.hash},push:A,on:(e,t)=>("change"===e?R:b).push(t),onHrefRender:e=>{s(p.onHrefRender)&&p.onHrefRender(e,w(g.href))},preload:e=>{if(!d.head.querySelector(`link[href="${e.href}"]`)){const t=d.createElement("link");t.href=e.href,"module"===e.as?t.rel="modulepreload":(t.rel="prefetch",t.as=e.as),d.head.appendChild(t)}},dispose:()=>{l=void 0,n.removeEventListener("popstate",F),O()},serializeURL:c};return n.addEventListener("popstate",F),{router:T,state:g}},h=(e,t=l)=>{if("string"!=typeof e)return{};const r=document.baseURI,i=new URL(e,r);if(e.startsWith("#")||i.host!==new URL(r).host)return{href:e};t.onHrefRender(i);const n=e.includes("#")?`#${e.split("#")[1]}`:"";return{href:t.serializeURL(i)+n,onClick:r=>{r.metaKey||r.ctrlKey||2==r.which||1==r.button||(r.preventDefault(),t.push(e))}}},f=(e,t)=>{var r;return"to"in e?{path:e.path,to:e.to}:{path:e.path,id:e.id,jsx:null!==(r=e.render)&&void 0!==r?r:t,mapParams:e.mapParams}},v=(e,t)=>{if(a(t)){if(t===e)return{}}else if(s(t)){const r=t(e);if(r)return!0===r?{}:{...r}}else{const r=t.exec(e);if(r)return t.lastIndex=0,{...r}}},p=(e={})=>d(window,document,location,history,e).router,y=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g"),m=e=>e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),R=e=>e.replace(/([=!:$/()])/g,"\\$1"),b=e=>e&&e.sensitive?"":"i",w=(e,t,r)=>{const i=(r=r||{}).strict,n=!1!==r.end,o=m(r.delimiter||"/"),s=r.delimiters||"./",a=[].concat(r.endsWith||[]).map(m).concat("$").join("|");let u="",c=!1;for(let r=0;r<e.length;r++){let i=e[r];if("string"==typeof i)u+=m(i),c=r===e.length-1&&s.indexOf(i[i.length-1])>-1;else{const e=m(i.prefix||""),r=i.repeat?"(?:"+i.pattern+")(?:"+e+"(?:"+i.pattern+"))*":i.pattern;t&&t.push(i),u+=i.optional?i.partial?e+"("+r+")?":"(?:"+e+"("+r+"))?":e+"("+r+")"}}return n?(i||(u+="(?:"+o+")?"),u+="$"===a?"$":"(?="+a+")"):(i||(u+="(?:"+o+"(?="+a+"))?"),c||(u+="(?="+o+"|"+a+")")),new RegExp("^"+u,b(r))},g=(e,t,r)=>e instanceof RegExp?((e,t)=>{if(t){const r=e.source.match(/\((?!\?)/g);if(r)for(let e=0;e<r.length;e++)t.push({name:e,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null})}return e})(e,t):Array.isArray(e)?((e,t,r)=>{const i=[];for(let n=0;n<e.length;n++)i.push(g(e[n],t,r).source);return new RegExp("(?:"+i.join("|")+")",b(r))})(e,t,r):((e,t,r)=>w(((e,t)=>{const r=[],i=t&&t.delimiter||"/",n=t&&t.delimiters||"./";let o,s=0,a=0,u="",c=!1;for(;null!==(o=y.exec(e));){const t=o[0],l=o[1],d=o.index;if(u+=e.slice(a,d),a=d+t.length,l){u+=l[1],c=!0;continue}let h="";const f=e[a],v=o[2],p=o[3],y=o[4],b=o[5];if(!c&&u.length){const e=u.length-1;n.indexOf(u[e])>-1&&(h=u[e],u=u.slice(0,e))}u&&(r.push(u),u="",c=!1);const w=h||i,g=p||y;r.push({name:v||s++,prefix:h,delimiter:w,optional:"?"===b||"*"===b,repeat:"+"===b||"*"===b,partial:""!==h&&void 0!==f&&f!==h,pattern:g?R(g):"[^"+m(w)+"]+?"})}return(u||a<e.length)&&r.push(u+e.substr(a)),r})(e,r),t,r))(e,t,r);let O=0;const $={},z=(e,t={})=>{const{exact:r=!1,strict:i=!1}=t,{re:n,keys:o}=((e,t)=>{const r=`${t.end}${t.strict}`,i=$[r]||($[r]={}),n=JSON.stringify(e);if(i[n])return i[n];const o=[],s={re:g(e,o,t),keys:o};return O<1e4&&(i[n]=s,O+=1),s})(e,{end:r,strict:i});return e=>{const t=n.exec(e);if(!t)return;const[i,...s]=t;return r&&e!==i?void 0:o.reduce(((e,t,r)=>(e[t.name]=s[r],e)),{})}};function A(e,t){if(B.debug){if("function"==typeof t){if(t())return}else if(t)return;console.warn(e)}}class j extends Error{get description(){return A("'Exception#description' has been deprecated. Please access 'message' instead."),this.message}}class S extends j{constructor(e){super(`Action not logged: ${e}`),this.id=e}}class x extends j{constructor(e){super(`Out of range: ${e}`),this.value=e}}class k extends j{constructor(e){super(`Assertion failed: ${e}`)}}function F(e,t){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;let r,i=Object.prototype.toString.call(e);if(i!==Object.prototype.toString.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;if("[object Array]"===i&&e.length!==t.length)return!1;for(r in t)if(t.hasOwnProperty(r)&&!F(e[r],t[r]))return!1;for(r in e)if(e.hasOwnProperty(r)&&!F(e[r],t[r]))return!1;return!0}function T(e){if(null==e||"object"!=typeof e)return e;let t,r=Object.prototype.toString.call(e);if("[object Date]"===r)t=new Date,t.setTime(e.getTime());else if("[object RegExp]"===r)t=e.constructor(e);else if("[object Array]"===r){t=[];for(let r=0,i=e.length;r<i;r++)e.hasOwnProperty(r)&&t.push(T(e[r]))}else{let r;t={};for(let i in e)e.hasOwnProperty(i)&&(r=e[i],"object"==typeof r&&(r=T(r)),t[i]=r)}return t}function q(e){return _(e)?[]:Array.isArray(e)?e:[e]}function P(e){return null!==e&&"object"==typeof e}function _(e){return null==e}function E(e,...t){return t.forEach((t=>{Object.keys(t).forEach((r=>{if(t.hasOwnProperty(r)){let i=e[r],n=t[r];P(i)&&P(n)&&!Array.isArray(i)&&!Array.isArray(n)?E(i,n):void 0!==n&&(e[r]=T(n))}}))})),e}function I(e,t){let r=-1,i=e;for(;++r<t.length;)if(i=i[t[r]],!i)return i;return i}function M(e,t,r){let i,n=e,o=t.pop();for(let e=0,r=t.length;e<r;e++)i=t[e],void 0===n[i]&&(n[i]="number"==typeof i?[]:{}),n=n[i];return n[o]!==r&&(n[o]=r,!0)}function N(e){return Object.values?Object.values(e):Object.keys(e).map((t=>e[t]))}
/**
 * Fast UUID generator, RFC4122 version 4 compliant.
 * @author Jeff Ward (jcward.com).
 * @license MIT license
 * @link http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
 **/const C=[];for(let e=0;e<256;e++)C[e]=(e<16?"0":"")+e.toString(16);var D;const U="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global||{},L=void 0!==(null===(D=U.crypto)||void 0===D?void 0:D.randomUUID)?()=>U.crypto.randomUUID():function(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return C[255&e]+C[e>>8&255]+C[e>>16&255]+C[e>>24&255]+"-"+C[255&t]+C[t>>8&255]+"-"+C[t>>16&15|64]+C[t>>24&255]+"-"+C[63&r|128]+C[r>>8&255]+"-"+C[r>>16&255]+C[r>>24&255]+C[255&i]+C[i>>8&255]+C[i>>16&255]+C[i>>24&255]},B={globals:U,assert:function(e,t){if(!t)throw new k(e)},debug:!0,deprecate:A,uuid:L};class Q{constructor(e,t){this.target=e,this.task=t,this.reset()}reset(){this._started=!1,this._settled=!1,this._settlement=new Promise(((e,t)=>{this._success=t=>{this._settled=!0,e(t)},this._fail=e=>{this._settled=!0,t(e)}}))}get started(){return this._started}get settled(){return this._settled}settle(){return this._settlement}process(){return this._started||(this._started=!0,this.target.perform(this.task).then(this._success,this._fail)),this.settle()}reject(e){if(this._settled)throw new Error("TaskProcessor#reject can not be invoked when processing has already settled.");this._fail&&this._fail(e)}}class J{constructor(){this.listeners=[]}addListener(e){return this.listeners.push(e),()=>this.removeListener(e)}removeListener(e){const t=this.listeners;for(let r=0,i=t.length;r<i;r++)if(t[r]===e)return void t.splice(r,1)}emit(...e){this.listeners.slice(0).forEach((t=>t(...e)))}}function H(e){let t=e.prototype;t.__evented__||(t.__evented__=!0,t.on=function(e,t){return Z(this,e,!0).addListener(t)},t.off=function(e,t){const r=Z(this,e);r&&(t?r.removeListener(t):function(e,t){e._eventedNotifiers&&e._eventedNotifiers[t]&&delete e._eventedNotifiers[t]}(this,e))},t.one=function(e,t){const r=Z(this,e,!0),i=function(){t(...arguments),r.removeListener(i)};return r.addListener(i)},t.emit=function(e,...t){let r=Z(this,e);r&&r.emit.apply(r,t)},t.listeners=function(e){let t=Z(this,e);return t?t.listeners:[]})}async function K(e,t,...r){const i=e.listeners(t),n=[];for(let e of i)try{n.push(await e(...r))}catch(e){n.push(e)}return n}async function V(e,t,...r){const i=e.listeners(t),n=[];for(let e of i)n.push(await e(...r));return n}function Z(e,t,r=!1){void 0===e._eventedNotifiers&&(e._eventedNotifiers={});let i=e._eventedNotifiers[t];return!i&&r&&(i=e._eventedNotifiers[t]=new J),i}const{assert:G}=B;let W=class{constructor(e,t={}){this._tasks=[],this._processors=[],this._performer=e,this._name=t.name,this._bucket=t.bucket,this.autoProcess=void 0===t.autoProcess||t.autoProcess,this._bucket&&G("TaskQueue requires a name if it has a bucket",!!this._name),void 0===t.autoActivate||t.autoActivate?this.activate():this._reify()}async activate(){await this._reify(),this.length>0&&this.autoProcess&&this.process()}get name(){return this._name}get performer(){return this._performer}get bucket(){return this._bucket}get length(){return this._tasks.length}get entries(){return this._tasks}get current(){return this._tasks[0]}get currentProcessor(){return this._processors[0]}get error(){return this._error}get empty(){return 0===this.length}get processing(){const e=this.currentProcessor;return void 0!==e&&e.started&&!e.settled}get reified(){return this._reified}async push(e){await this._reified;const t=new Q(this._performer,e);return this._tasks.push(e),this._processors.push(t),await this._persist(),this.autoProcess&&this._settle(),t.settle()}async retry(){await this._reified,this._cancel();let e=this.currentProcessor;return e.reset(),await this._persist(),this._settle(),e.settle()}async skip(e){await this._reified,this._cancel(),this._tasks.shift();let t=this._processors.shift();void 0===t||t.settled||t.reject(e||new Error("Processing cancelled via `TaskQueue#skip`")),await this._persist(),this.autoProcess&&this._settle()}async clear(e){await this._reified,this._cancel(),this._tasks=[];for(let t of this._processors)t.settled||t.reject(e||new Error("Processing cancelled via `TaskQueue#clear`"));this._processors=[],await this._persist(),await this._settle()}async shift(e){await this._reified;let t=this._tasks.shift();if(t){this._cancel();let t=this._processors.shift();void 0===t||t.settled||t.reject(e||new Error("Processing cancelled via `TaskQueue#shift`")),await this._persist()}return t}async unshift(e){await this._reified;let t=new Q(this._performer,e);return this._cancel(),this._tasks.unshift(e),this._processors.unshift(t),await this._persist(),this.autoProcess&&this._settle(),t.settle()}async process(){await this._reified;let e=this._resolution;return e||(0===this._tasks.length?e=this._complete():(this._error=void 0,this._resolution=e=new Promise(((e,t)=>{this._resolve=e,this._reject=t})),await this._settleEach(e))),e}async _settle(){try{await this.process()}catch(e){}}async _complete(){this._resolve&&this._resolve(),this._resolve=void 0,this._reject=void 0,this._error=void 0,this._resolution=void 0,await K(this,"complete")}async _fail(e,t){this._reject&&this._reject(t),this._resolve=void 0,this._reject=void 0,this._error=t,this._resolution=void 0,await K(this,"fail",e,t)}_cancel(){this._error=void 0,this._resolution=void 0}async _settleEach(e){if(0===this._tasks.length)return this._complete();{const t=this._tasks[0],r=this._processors[0];try{await K(this,"beforeTask",t),await r.process(),e===this._resolution&&(this._tasks.shift(),this._processors.shift(),await this._persist(),await K(this,"task",t),await this._settleEach(e))}catch(r){if(e===this._resolution)return this._fail(t,r)}}}_reify(){return this._tasks=[],this._processors=[],this._reified=this._loadTasksFromBucket().then((e=>{e&&(this._tasks=e,this._processors=e.map((e=>new Q(this._performer,e))))})),this._reified}async _loadTasksFromBucket(){if(this._bucket&&this._name)return this._bucket.getItem(this._name)}async _persist(){this.emit("change"),this._bucket&&this._name&&await this._bucket.setItem(this._name,this._tasks)}};W=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([H],W);let X=class{constructor(e={}){void 0===e.version&&(e.version=1),void 0===e.namespace&&(e.namespace="orbit-bucket"),this._applySettings(e)}get name(){return this._name}get namespace(){return this._namespace}get version(){return this._version}upgrade(e={}){return void 0===e.version&&(e.version=this._version+1),this._applySettings(e).then((()=>this.emit("upgrade",this._version)))}async _applySettings(e){void 0!==e.name&&(this._name=e.name),void 0!==e.namespace&&(this._namespace=e.namespace),void 0!==e.version&&(this._version=e.version)}};X=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([H],X);const{assert:Y}=B;let ee=class{constructor(e={}){this._data=[],this._name=e.name,this._bucket=e.bucket,this._bucket&&Y("Log requires a name if it has a bucket",!!this._name),this._reify(e.data)}get name(){return this._name}get bucket(){return this._bucket}get head(){return this._data[this._data.length-1]}get entries(){return this._data}get length(){return this._data.length}append(...e){return this.reified.then((()=>(Array.prototype.push.apply(this._data,e),this._persist()))).then((()=>{this.emit("append",e)}))}before(e,t=0){const r=this._data.indexOf(e);if(-1===r)throw new S(e);const i=r+t;if(i<0||i>=this._data.length)throw new x(i);return this._data.slice(0,i)}after(e,t=0){const r=this._data.indexOf(e);if(-1===r)throw new S(e);const i=r+1+t;if(i<0||i>this._data.length)throw new x(i);return this._data.slice(i)}truncate(e,t=0){let r;return this.reified.then((()=>{const i=this._data.indexOf(e);if(-1===i)throw new S(e);const n=i+t;if(n<0||n>this._data.length)throw new x(n);return n===this._data.length?(r=this._data,this._data=[]):(r=this._data.slice(0,n),this._data=this._data.slice(n)),this._persist()})).then((()=>{this.emit("truncate",e,t,r)}))}rollback(e,t=0){let r;return this.reified.then((()=>{const i=this._data.indexOf(e);if(-1===i)throw new S(e);const n=i+1+t;if(n<0||n>this._data.length)throw new x(n);return r=this._data.slice(n),this._data=this._data.slice(0,n),this._persist()})).then((()=>{this.emit("rollback",e,t,r)}))}clear(){let e;return this.reified.then((()=>(e=this._data,this._data=[],this._persist()))).then((()=>this.emit("clear",e)))}contains(e){return this._data.indexOf(e)>-1}async _persist(){this.emit("change"),this._bucket&&this._name&&await this._bucket.setItem(this._name,this._data)}_reify(e){return e?(this._initData(e),this.reified=Promise.resolve()):this.reified=this._loadDataFromBucket().then((e=>this._initData(e))),this.reified}async _loadDataFromBucket(){if(this._bucket&&this._name)return await this._bucket.getItem(this._name)}_initData(e){this._data=null!=e?e:[]}};ee=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([H],ee);class te extends j{constructor(e,t){super(`Query expression parse error: ${e}`),this.expression=t}}class re extends j{constructor(e,t){super(`Query not allowed: ${e}`),this.query=t}}class ie extends j{constructor(e,t){super(`Transform not allowed: ${e}`),this.transform=t}}class ne{constructor(e){this._operation=e}toOperation(){return this._operation}options(e){return this._operation.options=E(this._operation.options||{},e),this}}function oe(e,t,r,i){if("function"==typeof e)return oe(e(i),t,r);{let i,n,o,s=e;if(function(e){return void 0!==e.expressions}(s)){if(!t&&!r)return s;i=s.expressions,n=s.options&&t?{...s.options,...t}:null!=t?t:s.options,o=null!=r?r:s.id}else{if(Array.isArray(e)){i=[];for(let t of e)i.push(se(t))}else i=se(e);n=t,o=null!=r?r:B.uuid()}return{expressions:i,options:n,id:o}}}function se(e){return function(e){return"function"==typeof e.toQueryExpression}(e)?e.toQueryExpression():e}function ae(e,t){let r;if(void 0!==e)if(Array.isArray(e)){for(let i of e)if(i){let e=ue(i,t);r=r?{...r,...e}:e}}else r=ue(e,t);return r}function ue(e,t){if(e.sources){let{sources:r,...i}=e;return t&&r[t]?{...i,...r[t]}:i}return e}function ce(e){let t={};for(let r of e)"string"==typeof(null==r?void 0:r[0])&&void 0!==(null==r?void 0:r[1])&&(t[r[0]]=r[1]);return t}const{assert:le}=B;let de=class{constructor(e={}){const t=this._name=e.name,r=this._bucket=e.bucket,i=e.requestQueueSettings||{},n=e.syncQueueSettings||{},o=void 0===e.autoActivate||e.autoActivate;this._queryBuilder=e.queryBuilder,this._transformBuilder=e.transformBuilder,this._defaultQueryOptions=e.defaultQueryOptions,this._defaultTransformOptions=e.defaultTransformOptions,r&&le("TransformLog requires a name if it has a bucket",!!t),this._transformLog=new ee({name:t?`${t}-log`:void 0,bucket:r}),this._syncQueue=new W(this,{name:t?`${t}-sync`:void 0,bucket:r,autoActivate:!1,...n}),this._requestQueue=new W(this,{name:t?`${t}-requests`:void 0,bucket:r,autoActivate:!1,...i}),o&&this.activate()}get name(){return this._name}get bucket(){return this._bucket}get transformLog(){return this._transformLog}get requestQueue(){return this._requestQueue}get syncQueue(){return this._syncQueue}get queryBuilder(){return this._queryBuilder}get transformBuilder(){return this._transformBuilder}get defaultQueryOptions(){return this._defaultQueryOptions}set defaultQueryOptions(e){this._defaultQueryOptions=e}get defaultTransformOptions(){return this._defaultTransformOptions}set defaultTransformOptions(e){this._defaultTransformOptions=e}getQueryOptions(e,t){return ae([this._defaultQueryOptions,e.options,null==t?void 0:t.options],this._name)}getTransformOptions(e,t){return ae([this._defaultTransformOptions,e.options,null==t?void 0:t.options],this._name)}perform(e){const t=`__${e.type}__`,r=this[t];return le(`Method '${t}' does not exist on Source`,void 0!==r),r.call(this,e.data)}upgrade(){return Promise.resolve()}get activated(){if(!this._activated)throw new Error(`"${this.name}" source is not activated`);return this._activated}async activate(){this._activated||(this._activated=this._activate()),await this._activated}async deactivate(){this._activated&&await this._activated,this._activated=void 0}async transformed(e){await this.activated;for(let t of e)this._transformLog.contains(t.id)||(await this._transformLog.append(t.id),await K(this,"transform",t))}async _activate(){await this._transformLog.reified,await this._syncQueue.activate(),await this._requestQueue.activate()}};function he(e,t,r,i){if("function"==typeof e)return he(e(i),t,r);{let i,n,o,s=e;if(function(e){return void 0!==e.operations}(s)){if(!t&&!r)return s;i=s.operations,n=s.options&&t?{...s.options,...t}:null!=t?t:s.options,o=null!=r?r:s.id}else{if(Array.isArray(e)){i=[];for(let t of e)i.push(fe(t))}else i=fe(e);n=t,o=null!=r?r:B.uuid()}return{operations:i,options:n,id:o}}}function fe(e){return function(e){return"function"==typeof e.toOperation}(e)?e.toOperation():e}de=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([H],de);const{assert:ve,deprecate:pe}=B,{assert:ye,deprecate:me}=B,{assert:Re}=B;function be(e){let t=e.prototype;t.__queryable__||(Re("Queryable interface can only be applied to a Source",t instanceof de),t.__queryable__=!0,t.query=async function(e,t,r){await this.activated;const i=oe(e,t,r,this.queryBuilder),n=await this._requestQueue.push({type:"query",data:i});return(null==t?void 0:t.fullResponse)?n:n.data},t.__query__=async function(e){var t;try{const r={},i=await V(this,"beforeQuery",e,r),n=await this._query(e,r);return i.length>0&&(n.sources=ce(i)),(null===(t=n.transforms)||void 0===t?void 0:t.length)>0&&await this.transformed(n.transforms),await K(this,"query",e,n),n}catch(t){throw await K(this,"queryFail",e,t),t}})}const{assert:we}=B,{assert:ge}=B;function Oe(e){let t=e.prototype;t.__updatable__||(ge("Updatable interface can only be applied to a Source",t instanceof de),t.__updatable__=!0,t.update=async function(e,t,r){await this.activated;const i=he(e,t,r,this.transformBuilder);if(this.transformLog.contains(i.id))return(null==t?void 0:t.fullResponse)?{transforms:[]}:void 0;{const e=await this._requestQueue.push({type:"update",data:i});return(null==t?void 0:t.fullResponse)?e:e.data}},t.__update__=async function(e){var t;if(this.transformLog.contains(e.id))return{transforms:[]};try{const r={},i=await V(this,"beforeUpdate",e,r),n=await this._update(e,r);return i.length>0&&(n.sources=ce(i)),(null===(t=n.transforms)||void 0===t?void 0:t.length)>0&&await this.transformed(n.transforms),await K(this,"update",e,n),n}catch(t){throw await K(this,"updateFail",e,t),t}})}function $e(e){const{type:t,id:r}=e;return{type:t,id:r}}function ze(e,t){return _(e)&&_(t)||!!e&&!!t&&e.type===t.type&&e.id===t.id}function Ae(e,t){if(e.length===t.length){if(0===e.length)return!0;const r=qe(e),i=qe(t);return 0===Pe(r,i).length&&0===Pe(i,r).length}return!1}function je(e,t){return Pe(qe(e),qe(t)).map((e=>Te(e)))}function Se(e,t){for(let r of e)if(ze(r,t))return!0;return!1}function xe(e,t){if(e){let r=$e(e);return ke(r,e,t,"meta",0),ke(r,e,t,"links",0),ke(r,e,t,"attributes",1),ke(r,e,t,"keys",1),ke(r,e,t,"relationships",2),r}return T(t)}function ke(e,t,r,i,n){if(t[i]&&r[i])if(0===n)e[i]=T(r[i]);else if(1===n)e[i]=Object.assign({},t[i],r[i]);else{e[i]={};for(let o of Object.keys(t[i]))ke(e[i],t[i],r[i],o,n-1);for(let t of Object.keys(r[i]))e[i][t]||(e[i][t]=T(r[i][t]))}else t[i]?e[i]=T(t[i]):r[i]&&(e[i]=T(r[i]))}function Fe(e){return`${e.type}:${e.id}`}function Te(e){const[t,r]=e.split(":");return{type:t,id:r}}function qe(e){return e.map((e=>Fe(e)))}function Pe(e,t){return e.filter((e=>!t.includes(e)))}const _e=(e,t)=>e instanceof Date?void 0!==(null==t?void 0:t.minimum)&&e<t.minimum?[{validator:"date",validation:"minimum",description:"is too early",ref:e,details:{minimum:t.minimum}}]:void 0!==(null==t?void 0:t.maximum)&&e>t.maximum?[{validator:"date",validation:"maximum",description:"is too late",ref:e,details:{maximum:t.maximum}}]:void 0!==(null==t?void 0:t.exclusiveMinimum)&&e<=t.exclusiveMinimum?[{validator:"date",validation:"exclusiveMinimum",description:"is too early",ref:e,details:{exclusiveMinimum:t.exclusiveMinimum}}]:void 0!==(null==t?void 0:t.exclusiveMaximum)&&e>=t.exclusiveMaximum?[{validator:"date",validation:"exclusiveMaximum",description:"is too late",ref:e,details:{exclusiveMaximum:t.exclusiveMaximum}}]:void 0:[{validator:"date",validation:"type",description:"is not a date",ref:e}];var Ee;!function(e){e.Array="array",e.Boolean="boolean",e.Date="date",e.DateTime="datetime",e.Number="number",e.Object="object",e.String="string"}(Ee||(Ee={}));const Ie={array:(e,t)=>Array.isArray(e)?void 0!==(null==t?void 0:t.minItems)&&e.length<t.minItems?[{validator:"array",validation:"minItems",description:"has too few members",ref:e,details:{minItems:t.minItems}}]:void 0!==(null==t?void 0:t.maxItems)&&e.length>t.maxItems?[{validator:"array",validation:"maxItems",description:"has too many members",ref:e,details:{maxItems:t.maxItems}}]:void 0:[{validator:"array",validation:"type",description:"is not an array",ref:e}],boolean:e=>{if("boolean"!=typeof e)return[{validator:"boolean",validation:"type",description:"is not a boolean",ref:e}]},date:_e,datetime:_e,number:(e,t)=>"number"!=typeof e?[{validator:"number",validation:"type",description:"is not a number",ref:e}]:void 0!==(null==t?void 0:t.minimum)&&e<t.minimum?[{validator:"number",validation:"minimum",description:"is too low",ref:e,details:{minimum:t.minimum}}]:void 0!==(null==t?void 0:t.maximum)&&e>t.maximum?[{validator:"number",validation:"maximum",description:"is too high",ref:e,details:{maximum:t.maximum}}]:void 0!==(null==t?void 0:t.exclusiveMinimum)&&e<=t.exclusiveMinimum?[{validator:"number",validation:"exclusiveMinimum",description:"is too low",ref:e,details:{exclusiveMinimum:t.exclusiveMinimum}}]:void 0!==(null==t?void 0:t.exclusiveMaximum)&&e>=t.exclusiveMaximum?[{validator:"number",validation:"exclusiveMaximum",description:"is too high",ref:e,details:{exclusiveMaximum:t.exclusiveMaximum}}]:void 0,object:e=>{if("object"!=typeof e||null===e)return[{validator:"object",validation:"type",description:"is not an object",ref:e}]},string:(e,t)=>"string"!=typeof e?[{validator:"string",validation:"type",description:"is not a string",ref:e}]:void 0!==(null==t?void 0:t.minLength)&&e.length<t.minLength?[{validator:"string",validation:"minLength",description:"is too short",ref:e,details:{minLength:t.minLength}}]:void 0!==(null==t?void 0:t.maxLength)&&e.length>t.maxLength?[{validator:"string",validation:"maxLength",description:"is too long",ref:e,details:{maxLength:t.maxLength}}]:void 0};function Me(e,t){return t&&t.length>0?`${e}\n${t.map((e=>`- ${e.description.replace(/\n/g,"\n  ")}`)).join("\n")}`:e}class Ne extends j{constructor(e){super(`Schema: ${e}`)}}class Ce extends j{constructor(e,t){super(Me(e,t)),this.issues=t}}class De extends Ne{constructor(e){super(`Model '${e}' not defined.`)}}class Ue extends Ne{constructor(e,t){super(`Attribute '${t}' not defined for model '${e}'.`)}}class Le extends Ne{constructor(e,t){super(`Key '${t}' not defined for model '${e}'.`)}}class Be extends Ne{constructor(e,t){super(`Relationship '${t}' not defined for model '${e}'.`)}}class Qe extends j{constructor(e,t,r,i){let n=`${t}:${r}`;i&&(n=`${n}/${i}`),super(`${e}: ${n}`),this.type=t,this.id=r,this.field=i}}class Je extends Qe{constructor(e,t){super("Record not found",e,t)}}function He(e){e._deleted=!0}function Ke(e){return!0===e._deleted}function Ve(e,t,r){var i,n,o,s;e.options||t.options||(ze(e.record,t.record)?"removeRecord"===t.op?(He(e),"addRecord"===e.op&&He(t)):Ke(t)||!r&&"replaceAttribute"!==t.op||(Ze(e.op)&&Ze(t.op)?"replaceAttribute"===e.op&&"replaceAttribute"===t.op&&e.attribute===t.attribute||"replaceRelatedRecord"===e.op&&"replaceRelatedRecord"===t.op&&e.relationship===t.relationship||"replaceRelatedRecords"===e.op&&"replaceRelatedRecords"===t.op&&e.relationship===t.relationship?He(e):("replaceAttribute"===e.op?(Ge(e.record,e.attribute,e.value),delete e.attribute,delete e.value):"replaceRelatedRecord"===e.op?(We(e.record,e.relationship,e.relatedRecord),delete e.relationship,delete e.relatedRecord):"replaceRelatedRecords"===e.op&&(Xe(e.record,e.relationship,e.relatedRecords),delete e.relationship,delete e.relatedRecords),"replaceAttribute"===t.op?Ge(e.record,t.attribute,t.value):"replaceRelatedRecord"===t.op?We(e.record,t.relationship,t.relatedRecord):"replaceRelatedRecords"===t.op&&Xe(e.record,t.relationship,t.relatedRecords),e.op="updateRecord",He(t)):"addRecord"!==e.op&&"updateRecord"!==e.op&&"replaceRecord"!==e.op||"updateRecord"!==t.op&&"replaceRecord"!==t.op?"addRecord"!==e.op&&"updateRecord"!==e.op&&"replaceRecord"!==e.op||!Ze(t.op)?"addToRelatedRecords"===t.op?"addRecord"===e.op?(Ye(e.record,t.relationship,t.relatedRecord),He(t)):"updateRecord"!==e.op&&"replaceRecord"!==e.op||(null===(n=null===(i=e.record.relationships)||void 0===i?void 0:i[t.relationship])||void 0===n?void 0:n.data)&&(Ye(e.record,t.relationship,t.relatedRecord),He(t)):"removeFromRelatedRecords"===t.op&&("addToRelatedRecords"===e.op&&e.relationship===t.relationship&&ze(e.relatedRecord,t.relatedRecord)?(He(e),He(t)):"addRecord"!==e.op&&"updateRecord"!==e.op&&"replaceRecord"!==e.op||(null===(s=null===(o=e.record.relationships)||void 0===o?void 0:o[t.relationship])||void 0===s?void 0:s.data)&&(function(e,t,r){const i=I(e,["relationships",t,"data"]);if(i)for(let e=0,t=i.length;e<t;e++)if(ze(i[e],r)){i.splice(e,1);break}}(e.record,t.relationship,t.relatedRecord),He(t))):("replaceAttribute"===t.op?Ge(e.record,t.attribute,t.value):"replaceRelatedRecord"===t.op?We(e.record,t.relationship,t.relatedRecord):"replaceRelatedRecords"===t.op&&Xe(e.record,t.relationship,t.relatedRecords),He(t)):(e.record=xe(e.record,t.record),He(t))):t.record&&"removeRecord"===t.op&&e.relatedRecord&&ze(e.relatedRecord,t.record)&&He(e))}function Ze(e){return"replaceAttribute"===e||"replaceRelatedRecord"===e||"replaceRelatedRecords"===e}function Ge(e,t,r){M(e,["attributes",t],r)}function We(e,t,r){M(e,["relationships",t,"data"],r?$e(r):null)}function Xe(e,t,r){M(e,["relationships",t,"data"],r.map($e))}function Ye(e,t,r){const i=I(e,["relationships",t,"data"])||[];i.push($e(r)),M(e,["relationships",t,"data"],i)}function et(e){for(let t=0,r=e.length;t<r;t++){let i=e[t],n=!0;for(let o=t+1;o<r;o++){let t=e[o];if(Ve(i,t,n),Ke(i))break;Ke(t)||(n=!1)}}return e.filter((e=>!Ke(e)))}var tt;!function(e){e.Record="record",e.RecordAttribute="recordAttribute",e.RecordIdentity="recordIdentity",e.RecordKey="recordKey",e.RecordOperation="recordOperation",e.RecordQueryExpression="recordQueryExpression",e.RecordRelationship="recordRelationship",e.RecordType="recordType",e.RelatedRecord="relatedRecord",e.RecordFieldDefinition="recordFieldDefinition"}(tt||(tt={}));class rt extends ne{constructor(e,t){super(t),this.$transformBuilder=e}toOperation(){const e=super.toOperation(),t=this.$transformBuilder.$validatorFor;if(t){const r=this.$transformBuilder.$schema,i=t(tt.RecordOperation)(e,{validatorFor:t,schema:r});if(void 0!==i)throw new Ce("Validation isssues encountered while building a transform operation",i)}return e}}class it extends rt{constructor(e,t){super(e,{op:"addRecord",record:t})}}class nt extends rt{constructor(e,t){super(e,{op:"updateRecord",record:t})}}class ot extends rt{constructor(e,t){super(e,{op:"removeRecord",record:t})}}class st extends rt{constructor(e,t,r,i){super(e,{op:"replaceAttribute",record:t,attribute:r,value:i})}}class at extends rt{constructor(e,t,r,i){super(e,{op:"replaceKey",record:t,key:r,value:i})}}class ut extends rt{constructor(e,t,r,i){super(e,{op:"addToRelatedRecords",record:t,relationship:r,relatedRecord:i})}}class ct extends rt{constructor(e,t,r,i){super(e,{op:"removeFromRelatedRecords",record:t,relationship:r,relatedRecord:i})}}class lt extends rt{constructor(e,t,r,i){super(e,{op:"replaceRelatedRecords",record:t,relationship:r,relatedRecords:i})}}class dt extends rt{constructor(e,t,r,i){super(e,{op:"replaceRelatedRecord",record:t,relationship:r,relatedRecord:i})}}class ht extends class{constructor(e){this._expression=e}toQueryExpression(){return this._expression}options(e){return this._expression.options=E(this._expression.options||{},e),this}}{constructor(e,t){super(t),this.$queryBuilder=e}toQueryExpression(){const e=super.toQueryExpression(),t=this.$queryBuilder.$validatorFor;if(t){const r=this.$queryBuilder.$schema,i=t(tt.RecordQueryExpression)(e,{validatorFor:t,schema:r});if(void 0!==i)throw new Ce("Validation isssues encountered while building a query expression",i)}return e}}class ft extends ht{constructor(e,t){super(e,{op:"findRecord",record:t})}}class vt extends ht{constructor(e,t,r){super(e,{op:"findRelatedRecord",record:t,relationship:r})}}class pt extends ht{sort(...e){var t;const r=e.map((e=>this.$sortParamToSpecifier(e)));return this._expression.sort=(null!==(t=this._expression.sort)&&void 0!==t?t:[]).concat(r),this}page(e){return this._expression.page=this.$pageParamToSpecifier(e),this}filter(...e){var t;const r=e.map((e=>this.$filterParamToSpecifier(e)));return this._expression.filter=(null!==(t=this._expression.filter)&&void 0!==t?t:[]).concat(r),this}$filterParamToSpecifier(e){var t;let r;if(function(e){return void 0!==e.kind}(e))r=e;else{const i=null!==(t=e.op)&&void 0!==t?t:"equal";if(function(e){return void 0!==e.attribute}(e)){const{attribute:t,value:n}=e;r={kind:"attribute",op:i,attribute:t,value:n}}else if(function(e){return void 0!==e.relation&&void 0!==e.record}(e)){const{relation:t}=e;let n;n=Array.isArray(e.record)?e.record.map((e=>this.$queryBuilder.$normalizeRecordIdentity(e))):e.record?this.$queryBuilder.$normalizeRecordIdentity(e.record):null,r={kind:"relatedRecord",op:i,relation:t,record:n}}else if(function(e){return void 0!==e.relation&&void 0!==e.records}(e)){const{relation:t}=e;r={kind:"relatedRecords",op:i,relation:t,records:e.records.map((e=>this.$queryBuilder.$normalizeRecordIdentity(e)))}}}if(void 0===r)throw new Ce("Unrecognized `filter` param encountered while building query expression");return r}$pageParamToSpecifier(e){let t;if((e.hasOwnProperty("offset")||e.hasOwnProperty("limit"))&&(t={kind:"offsetLimit",offset:e.offset,limit:e.limit}),void 0===t)throw new Ce("Unrecognized `page` param encountered while building query expression");return t}$sortParamToSpecifier(e){let t;if(P(e)?e.hasOwnProperty("kind")?t=e:e.hasOwnProperty("attribute")&&(t={kind:"attribute",attribute:e.attribute,order:e.order||"ascending"}):"string"==typeof e&&(t=this.$parseSortParamString(e)),void 0===t)throw new Ce("Unrecognized `sort` param encountered while building query expression");return t}$parseSortParamString(e){let t,r;return"-"===e[0]?(t=e.slice(1),r="descending"):(t=e,r="ascending"),{kind:"attribute",attribute:t,order:r}}}const{assert:yt}=B;class mt{constructor(e={}){const{schema:t,normalizer:r,validatorFor:i}=e;i&&yt("A RecordQueryBuilder that has been assigned a `validatorFor` requires a `schema`",void 0!==t),this.$schema=t,this.$normalizer=r,this.$validatorFor=i}findRecord(e){return new ft(this,this.$normalizeRecordIdentity(e))}findRecords(e){const t={op:"findRecords"};return Array.isArray(e)?t.records=e.map((e=>this.$normalizeRecordIdentity(e))):void 0!==e&&(t.type=this.$normalizeRecordType(e)),new pt(this,t)}findRelatedRecord(e,t){return new vt(this,this.$normalizeRecordIdentity(e),t)}findRelatedRecords(e,t){const r={op:"findRelatedRecords",record:this.$normalizeRecordIdentity(e),relationship:t};return new pt(this,r)}$normalizeRecordType(e){return void 0!==this.$normalizer?this.$normalizer.normalizeRecordType(e):e}$normalizeRecordIdentity(e){return void 0!==this.$normalizer?this.$normalizer.normalizeRecordIdentity(e):e}}const{uuid:Rt,deprecate:bt}=B;let wt=class{constructor(e={}){void 0===e.version&&(e.version=1),void 0===e.models&&(e.models={}),this._applySettings(e)}get version(){return this._version}async upgrade(e={}){void 0===e.version&&(e.version=this._version+1),this._applySettings(e),await async function(e,t,...r){const i=e.listeners("upgrade"),n=[];for(let e of i)n.push(e(...r));return Promise.all(n)}(this,0,this._version)}_applySettings(e){void 0!==e.version&&(this._version=e.version),e.generateId&&(this.generateId=e.generateId),e.pluralize&&(bt("Schema#pluralize has been deprecated. Use inflectors from in @orbit/serializers instead."),this.pluralize=e.pluralize),e.singularize&&(bt("Schema#singularize has been deprecated. Use inflectors from @orbit/serializers instead."),this.singularize=e.singularize),e.models&&(this._deprecateRelationshipModel(e.models),this._models=e.models)}generateId(e){return Rt()}pluralize(e){return bt("Schema#pluralize has been deprecated. Use inflectors from @orbit/serializers instead."),e+"s"}singularize(e){return bt("Schema#singularize has been deprecated. Use inflectors from @orbit/serializers instead."),e.lastIndexOf("s")===e.length-1?e.substr(0,e.length-1):(console.warn(`Orbit's built-in naive singularization rules cannot singularize ${e}. Pass singularize & pluralize functions to Schema to customize.`),e)}get models(){return this._models}getModel(e){const t=this.models[e];if(t)return t;throw new De(e)}getAttribute(e,t){var r;const i=null===(r=this.getModel(e).attributes)||void 0===r?void 0:r[t];if(i)return i;throw new Ue(e,t)}getKey(e,t){var r;const i=null===(r=this.getModel(e).keys)||void 0===r?void 0:r[t];if(i)return i;throw new Le(e,t)}getRelationship(e,t){var r;const i=null===(r=this.getModel(e).relationships)||void 0===r?void 0:r[t];if(i)return i;throw new Be(e,t)}hasModel(e){return void 0!==this.models[e]}hasAttribute(e,t){var r,i;return void 0!==(null===(i=null===(r=this.models[e])||void 0===r?void 0:r.attributes)||void 0===i?void 0:i[t])}hasKey(e,t){var r,i;return void 0!==(null===(i=null===(r=this.models[e])||void 0===r?void 0:r.keys)||void 0===i?void 0:i[t])}hasRelationship(e,t){var r,i;return void 0!==(null===(i=null===(r=this.models[e])||void 0===r?void 0:r.relationships)||void 0===i?void 0:i[t])}eachAttribute(e,t){const r=this.getModel(e).attributes||{};for(let e in r)t(e,r[e])}eachKey(e,t){const r=this.getModel(e).keys||{};for(let e in r)t(e,r[e])}eachRelationship(e,t){const r=this.getModel(e).relationships||{};for(let e in r)t(e,r[e])}_deprecateRelationshipModel(e){for(let t in e)if(e[t].relationships){let r=e[t].relationships;for(let e in r)r[e].model&&bt("RelationshipDefinition.model is deprecated, use `type` and `kind` instead.")}}};wt=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([H],wt);const{assert:gt,deprecate:Ot}=B;class $t{constructor(e={}){const{schema:t,normalizer:r,validatorFor:i,recordInitializer:n}=e;i&&gt("A RecordTransformBuilder that has been assigned a `validatorFor` requires a `schema`",void 0!==t),this.$schema=t,this.$normalizer=r,this.$validatorFor=i,n&&(void 0!==this.$normalizer?Ot("A `normalizer` and `recordInitializer` have both been assigned to the `TransformBuilder`. Only the `normalizer` will be used."):(Ot("A `recordInitializer` has been assigned to the `TransformBuilder`. The `recordInitializer` setting has been deprecated in favor of `normalizer`, and will be treated as if it were a `RecordNormalizer`."),this.$normalizer={normalizeRecordType:e=>e,normalizeRecord:e=>n.initializeRecord(e),normalizeRecordIdentity:e=>e}))}addRecord(e){return new it(this,this.$normalizeRecord(e))}updateRecord(e){return new nt(this,this.$normalizeRecord(e))}removeRecord(e){return new ot(this,this.$normalizeRecordIdentity(e))}replaceKey(e,t,r){return new at(this,this.$normalizeRecordIdentity(e),t,r)}replaceAttribute(e,t,r){return new st(this,this.$normalizeRecordIdentity(e),t,r)}addToRelatedRecords(e,t,r){return new ut(this,this.$normalizeRecordIdentity(e),t,this.$normalizeRecordIdentity(r))}removeFromRelatedRecords(e,t,r){return new ct(this,this.$normalizeRecordIdentity(e),t,this.$normalizeRecordIdentity(r))}replaceRelatedRecords(e,t,r){return new lt(this,this.$normalizeRecordIdentity(e),t,r.map((e=>this.$normalizeRecordIdentity(e))))}replaceRelatedRecord(e,t,r){return new dt(this,this.$normalizeRecordIdentity(e),t,r?this.$normalizeRecordIdentity(r):null)}$normalizeRecord(e){return this.$normalizer?this.$normalizer.normalizeRecord(e):e}$normalizeRecordIdentity(e){return void 0!==this.$normalizer?this.$normalizer.normalizeRecordIdentity(e):e}}const zt=(e,t)=>{if(void 0===(null==t?void 0:t.validatorFor)||void 0===(null==t?void 0:t.schema))throw new k("validateRecordOperation requires both a `validationFor` and a `schema`.");const{schema:r,validatorFor:i}=t;let n;switch(e.op){case"addRecord":n=i(tt.Record)(e.record,{schema:r,validatorFor:i});break;case"updateRecord":n=i(tt.Record)(e.record,{schema:r,validatorFor:i,partialRecord:!0});break;case"removeRecord":n=i(tt.RecordIdentity)(e.record,{schema:r,validatorFor:i});break;case"replaceKey":n=i(tt.RecordKey)(e,{schema:r,validatorFor:i});break;case"replaceAttribute":n=i(tt.RecordAttribute)(e,{schema:r,validatorFor:i});break;case"addToRelatedRecords":case"removeFromRelatedRecords":n=i(tt.RelatedRecord)(e,{schema:r,validatorFor:i});break;case"replaceRelatedRecords":n=i(tt.RecordRelationship)({record:e.record,relationship:e.relationship,data:e.relatedRecords},{schema:r,validatorFor:i});break;case"replaceRelatedRecord":n=i(tt.RecordRelationship)({record:e.record,relationship:e.relationship,data:e.relatedRecord},{schema:r,validatorFor:i});break;default:return[{validator:tt.RecordOperation,validation:"operationAllowed",ref:e,description:`record operation '${e.op}' is not recognized`}]}if(void 0!==n)return[{validator:tt.RecordOperation,validation:"operationValid",ref:e,details:n,description:Me("record operation is invalid",n)}]},At={record:(e,t)=>{var r,i,n,o,s,a;if(void 0===(null==t?void 0:t.validatorFor)||void 0===(null==t?void 0:t.schema))throw new k("validateRecord requires both a `validatorFor` and `schema`");const{validatorFor:u,schema:c,partialRecord:l}=t;let{modelDef:d}=t;const h=u(tt.RecordIdentity)(e,{validatorFor:u,modelDef:d,schema:c});if(h)return h;const{type:f,id:v}=e,p=[];if(null!=d||(d=c.getModel(f)),e.keys||d.keys){const t=u(tt.RecordKey);if(e.keys)for(let i in e.keys){const n=null===(r=d.keys)||void 0===r?void 0:r[i],o=t({record:{type:f,id:v},key:i,value:e.keys[i]},{schema:c,keyDef:n,validatorFor:u});o&&p.push(...o)}if(!l&&d.keys)for(let r in d.keys)if(void 0===(null===(i=e.keys)||void 0===i?void 0:i[r])){const e=t({record:{type:f,id:v},key:r,value:void 0},{schema:c,keyDef:d.keys[r],validatorFor:u});e&&p.push(...e)}}if(e.attributes||d.attributes){const t=u(tt.RecordAttribute);if(e.attributes)for(let r in e.attributes){const i=null===(n=d.attributes)||void 0===n?void 0:n[r],o=t({record:{type:f,id:v},attribute:r,value:e.attributes[r]},{schema:c,attributeDef:i,validatorFor:u});o&&p.push(...o)}if(!l&&d.attributes)for(let r in d.attributes)if(void 0===(null===(o=e.attributes)||void 0===o?void 0:o[r])){const e=t({record:{type:f,id:v},attribute:r,value:void 0},{schema:c,attributeDef:d.attributes[r],validatorFor:u});e&&p.push(...e)}}if(e.relationships||d.relationships){const t=u(tt.RecordRelationship);if(e.relationships)for(let r in e.relationships){const i=null===(s=d.relationships)||void 0===s?void 0:s[r],n=t({record:{type:f,id:v},relationship:r,data:e.relationships[r].data},{schema:c,relationshipDef:i,validatorFor:u});n&&p.push(...n)}if(!l&&d.relationships)for(let r in d.relationships)if(void 0===(null===(a=e.relationships)||void 0===a?void 0:a[r])){const e=t({record:{type:f,id:v},relationship:r,data:void 0},{schema:c,relationshipDef:d.relationships[r],validatorFor:u});e&&p.push(...e)}}return p.length>0?p:void 0},recordAttribute:(e,t)=>{var r,i;if(void 0===(null==t?void 0:t.validatorFor))throw new k("validateRecordAttribute requires a `validatorFor`");const{record:n,attribute:o,value:s}=e,{type:a}=n,{validatorFor:u,schema:c}=t;let{attributeDef:l}=t;if(void 0===l){if(void 0===c)throw new k("validateRecordAttribute requires either a `schema` or `attributeDef`");const e=u(tt.RecordFieldDefinition)({kind:"attribute",type:a,field:o},{schema:c});if(e)return e;l=c.getAttribute(a,o)}if(void 0===s){if(null===(r=l.validation)||void 0===r?void 0:r.required)return[{validator:tt.RecordAttribute,validation:"valueRequired",description:"value is required",ref:{record:n,attribute:o,value:s}}]}else if(null===s){if(null===(i=l.validation)||void 0===i?void 0:i.notNull)return[{validator:tt.RecordAttribute,validation:"valueNotNull",description:"value can not be null",ref:{record:n,attribute:o,value:s}}]}else if(l.type){const e=u(l.type);if(void 0===e)return[{validator:tt.RecordAttribute,ref:{record:n,attribute:o,value:s},validation:"type",description:`validator has not been provided for attribute '${o}' of \`type\` '${l.type}'`}];{const t=e(s,l.validation);if(t)return[{validator:tt.RecordAttribute,ref:{record:n,attribute:o,value:s},validation:"valueValid",description:"value is invalid",details:t}]}}},recordIdentity:(e,t)=>{const{type:r,id:i}=e;if("string"!=typeof r||"string"!=typeof i)return[{validator:tt.RecordIdentity,validation:"type",ref:e,description:"Record identities must be in the form `{ type, id }`, with string values for both `type` and `id`."}];if(void 0===(null==t?void 0:t.modelDef)){if(void 0===(null==t?void 0:t.validatorFor)||void 0===(null==t?void 0:t.schema))throw new k("validateRecordIdentity requires either a `modelDef` or both a `validatorFor` and a `schema`");const{validatorFor:e,schema:i}=t;return e(tt.RecordType)(r,{schema:i})}},recordKey:(e,t)=>{var r,i;if(void 0===(null==t?void 0:t.validatorFor))throw new k("validateRecordKey requires a `validatorFor`");const{record:n,key:o,value:s}=e,{type:a}=n,{validatorFor:u,schema:c}=t;let{keyDef:l}=t;if(void 0===l){if(void 0===c)throw new k("validateRecordKey requires either a `schema` or `keyDef`");const e=u(tt.RecordFieldDefinition)({kind:"key",type:a,field:o},{schema:c});if(e)return e;l=c.getKey(a,o)}if(void 0===s){if(null===(r=l.validation)||void 0===r?void 0:r.required)return[{validator:tt.RecordKey,validation:"valueRequired",description:"value is required",ref:{record:n,key:o,value:s}}]}else if(null===s){if(null===(i=l.validation)||void 0===i?void 0:i.notNull)return[{validator:tt.RecordKey,validation:"valueNotNull",description:"value can not be null",ref:{record:n,key:o,value:s}}]}else if("string"!=typeof s)return[{validator:tt.RecordKey,ref:{record:n,key:o,value:s},validation:"valueValid",description:"value is invalid"}]},recordOperation:zt,recordQueryExpression:(e,t)=>{if(void 0===(null==t?void 0:t.validatorFor)||void 0===(null==t?void 0:t.schema))throw new k("validateRecordQueryExpression requires both a `validationFor` and a `schema`.");const{schema:r,validatorFor:i}=t;let n;switch(e.op){case"findRecord":n=function(e,t){const{schema:r,validatorFor:i}=t;return i(tt.RecordIdentity)(e.record,{schema:r,validatorFor:i})}(e,{schema:r,validatorFor:i});break;case"findRelatedRecord":n=function(e,t){const{schema:r,validatorFor:i}=t,n=[],o=i(tt.RecordIdentity)(e.record,{schema:r,validatorFor:i});o&&n.push(...o);const s=i(tt.RecordFieldDefinition)({kind:"relationship",type:e.record.type,field:e.relationship},{schema:r});if(s&&n.push(...s),n.length>0)return n}(e,{schema:r,validatorFor:i});break;case"findRelatedRecords":n=function(e,t){const{schema:r,validatorFor:i}=t,n=[],o=i(tt.RecordIdentity)(e.record,{schema:r,validatorFor:i});o&&n.push(...o);const s=i(tt.RecordFieldDefinition)({kind:"relationship",type:e.record.type,field:e.relationship},{schema:r});if(s&&n.push(...s),n.length>0)return n}(e,{schema:r,validatorFor:i});break;case"findRecords":n=function(e,t){const{schema:r,validatorFor:i}=t,n=[];if(e.records){const t=i(tt.RecordIdentity);e.records.forEach((e=>{let o=t(e,{schema:r,validatorFor:i});o&&n.push(...o)}))}if(e.type){let t=i(tt.RecordType)(e.type,{schema:r});t&&n.push(...t)}if(n.length>0)return n}(e,{schema:r,validatorFor:i});break;default:return[{validator:tt.RecordQueryExpression,validation:"queryExpressionAllowed",ref:e,description:`record query expression '${e.op}' is not recognized`}]}if(void 0!==n)return[{validator:tt.RecordQueryExpression,validation:"queryExpressionValid",ref:e,details:n,description:Me("record query expression is invalid",n)}]},recordRelationship:(e,t)=>{var r,i;if(void 0===(null==t?void 0:t.validatorFor)||void 0===(null==t?void 0:t.schema))throw new k("validateRecordRelationship requires both a `validatorFor` and `schema`");const{record:n,relationship:o,data:s}=e,{type:a}=n,{validatorFor:u,schema:c}=t;let{relationshipDef:l}=t;if(void 0===l){const e=u(tt.RecordFieldDefinition)({kind:"relationship",type:a,field:o},{schema:c});if(e)return e;l=c.getRelationship(a,o)}if(void 0===s){if(null===(r=l.validation)||void 0===r?void 0:r.required)return[{validator:tt.RecordRelationship,validation:"dataRequired",description:"data is required",ref:{record:n,relationship:o,data:s}}]}else{const e=[],t=u(tt.RelatedRecord);if("hasMany"===l.kind){if(!Array.isArray(s))return[{validator:tt.RecordRelationship,ref:{record:n,relationship:o,data:s},validation:"dataValid",description:"data for a hasMany relationship must be an array"}];if(l.validation){const t=u(Ee.Array)(s,l.validation);t&&e.push(...t)}for(let r of s){let i=t({record:n,relationship:o,relatedRecord:r},{validatorFor:u,schema:c,relationshipDef:l});i&&e.push(...i)}}else if("hasOne"===l.kind)if(null===s){if(null===(i=l.validation)||void 0===i?void 0:i.notNull)return[{validator:tt.RecordRelationship,validation:"dataNotNull",description:"data can not be null",ref:{record:n,relationship:o,data:s}}]}else{if(Array.isArray(s))return[{validator:tt.RecordRelationship,ref:{record:n,relationship:o,data:s},validation:"dataValid",description:"data for a hasOne relationship can not be an array"}];{let r=t({record:n,relationship:o,relatedRecord:s},{validatorFor:u,schema:c,relationshipDef:l});r&&e.push(...r)}}if(e.length>0)return[{validator:tt.RecordRelationship,ref:{record:n,relationship:o,data:s},validation:"dataValid",details:e,description:Me("relationship data is invalid",e)}]}},recordType:(e,t)=>{if("string"!=typeof e)return[{validator:tt.RecordType,validation:"type",ref:e,description:"Record `type` must be a string."}];if(void 0===(null==t?void 0:t.schema))throw new k("validateRecordType requires a `schema`");return t.schema.hasModel(e)?void 0:[{validator:tt.RecordType,validation:"recordTypeDefined",ref:e,description:`Record type '${e}' does not exist in schema`}]},relatedRecord:(e,t)=>{if(void 0===(null==t?void 0:t.validatorFor)||void 0===(null==t?void 0:t.schema))throw new k("validateRelatedRecord requires both a `validatorFor` and `schema`");const{record:r,relationship:i,relatedRecord:n}=e,{type:o}=r,{validatorFor:s,schema:a}=t;let{relationshipDef:u}=t;if(void 0===u){const e=s(tt.RecordFieldDefinition)({kind:"relationship",type:o,field:i},{schema:a});if(e)return e;u=a.getRelationship(o,i)}const c=s(tt.RecordIdentity)(n,{schema:a,validatorFor:s});if(c)return[{validator:tt.RelatedRecord,validation:"relatedRecordValid",ref:{record:r,relationship:i,relatedRecord:n},details:c,description:Me("relatedRecord is not a valid record identity",c)}];const l=u.type;if(l){const e=n.type,t=Array.isArray(l)?l:[l];if(!t.includes(e))return[{validator:tt.RelatedRecord,validation:"relatedRecordType",ref:{record:r,relationship:i,relatedRecord:n},details:{allowedTypes:t},description:`relatedRecord has a type '${e}' which is not an allowed type for this relationship`}]}},recordFieldDefinition:(e,t)=>{if(void 0===(null==t?void 0:t.schema))throw new k("validateRecordFieldDefinition requires a `schema`");const{schema:r}=t,{kind:i,type:n,field:o}=e;if(!("attribute"===i&&r.hasAttribute(n,o)||"key"===i&&r.hasKey(n,o)||"relationship"===i&&r.hasRelationship(n,o)))return[{validator:tt.RecordFieldDefinition,validation:"fieldDefined",ref:e,description:`${i} '${o}' for type '${n}' is not defined in schema`}]}};function jt(e){return function(e){const{validators:t}=e;return function(e){var r;return null!==(r=t[e])&&void 0!==r?r:t.unknown}}({validators:{...Ie,...At,...null==e?void 0:e.validators}})}const{assert:St,deprecate:xt}=B;class kt{constructor(e){const{schema:t,keyMap:r,cloneInputs:i,validateInputs:n}=e;St("StandardRecordNormalizer's `schema` must be specified in the `settings.schema` constructor argument",!!t),this.schema=t,this.keyMap=r,this.cloneInputs=i,this.validateInputs=n}normalizeRecordType(e){if(this.validateInputs){if("string"!=typeof e)throw new k("StandardRecordNormalizer expects record types to be strings");if(!this.schema.hasModel(e))throw new De(e)}return e}normalizeRecordIdentity(e){const{schema:t,keyMap:r,cloneInputs:i,validateInputs:n}=this,{type:o}=e;if(n&&!t.hasModel(o))throw new De(o);if(function(e){const{id:t,type:r}=e;return"string"==typeof t&&"string"==typeof r}(e))return i?this.cloneRecordIdentity(e):e;{if(void 0===r)throw new k("StandardRecordNormalizer's `keyMap` must be specified in order to lookup an `id` from a `key`");const{key:i,value:s}=e;if("string"!=typeof i||"string"!=typeof s)throw new k("StandardRecordNormalizer expects record identities in the form `{ type: string, id: string }` or `{ type: string, key: string, value: string }`");if(n&&!t.hasKey(o,i))throw new Le(o,i);let a=r.keyToId(o,i,s);return void 0===a&&(a=this.schema.generateId(o),r.pushRecord({type:o,id:a,keys:{[i]:s}})),{type:o,id:a}}}normalizeRecord(e){const{keyMap:t,schema:r,cloneInputs:i,validateInputs:n}=this,{type:o}=e;if(n&&!r.hasModel(o))throw new De(o);let s=i?this.cloneRecord(e):e;if(void 0!==r.initializeRecord&&(xt("RecordSchema's `initializeRecord` method should NOT be defined. Instead override `normalizeRecord` on the RecordNormalizer to initialize records."),s=r.initializeRecord(s)),void 0===s.id){const{keys:e}=s;if(void 0!==t&&void 0!==e){n&&Object.keys(e).forEach((e=>{if(!r.hasKey(o,e))throw new Le(o,e)}));const i=t.idFromKeys(s.type,e);i&&(s.id=i)}void 0===s.id&&(s.id=r.generateId(s.type),t&&void 0!==s.keys&&t.pushRecord(s))}return s}cloneRecordIdentity(e){return $e(e)}cloneRecord(e){return T(e)}}const{assert:Ft}=B;class Tt extends de{constructor(e){const t=void 0===e.autoActivate||e.autoActivate,{schema:r}=e;let{validatorFor:i,validators:n}=e;const o=!1!==e.autoValidate;if(o?void 0!==i?Ft("RecordSource can be constructed with either a `validatorFor` or `validators`, but not both",void 0===n):i=jt({validators:n}):Ft("RecordSource should not be constructed with a `validatorFor` or `validators` if `autoValidate === false`",void 0===n&&void 0===i),Ft("RecordSource's `schema` must be specified in `settings.schema` constructor argument",!!r),void 0===e.queryBuilder||void 0===e.transformBuilder){let{normalizer:t}=e;void 0===t&&(t=new kt({schema:r,keyMap:e.keyMap,validateInputs:o})),void 0===e.queryBuilder&&(e.queryBuilder=new mt({schema:r,normalizer:t,validatorFor:i})),void 0===e.transformBuilder&&(e.transformBuilder=new $t({schema:r,normalizer:t,validatorFor:i}))}super({...e,autoActivate:!1}),this._schema=r,this._keyMap=e.keyMap,this._validatorFor=i,(void 0===e.autoUpgrade||e.autoUpgrade)&&this._schema.on("upgrade",(()=>this.upgrade())),t&&this.activate()}get schema(){return this._schema}get keyMap(){return this._keyMap}get validatorFor(){return this._validatorFor}get queryBuilder(){return this._queryBuilder}get transformBuilder(){return this._transformBuilder}async upgrade(){}}const qt=Math.pow(2,5),Pt=qt-1,_t=qt/2,Et=qt/4,It={};function Mt(e){return function(){return e}}function Nt(e){const t=void 0===e?"undefined":(r=e)&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r;var r;if("number"===t)return e;"string"!==t&&(e+="");let i=0;for(var n=0,o=e.length;n<o;++n)i=(i<<5)-i+e.charCodeAt(n)|0;return i}function Ct(e,t){return t>>>e&Pt}function Dt(e){return 1<<e}function Ut(e,t){return r=e&t-1,r=(r=(858993459&(r-=r>>1&1431655765))+(r>>2&858993459))+(r>>4)&252645135,127&(r+=r>>8)+(r>>16);var r}function Lt(e,t,r,i){var n=i;if(!e){var o=i.length;n=new Array(o);for(var s=0;s<o;++s)n[s]=i[s]}return n[t]=r,n}function Bt(e,t,r){var i=r.length,n=0,o=0,s=r;if(e)n=o=t;else{for(s=new Array(i-1);n<t;)s[o++]=r[n++];++n}for(;n<i;)s[o++]=r[n++];return s}const Qt={__hamt_isEmpty:!0,_modify(e,t,r,i,n,o,s){var a=i();return a===It?Qt:(++s.value,Ht(e,n,o,a))}};function Jt(e){return e===Qt||e&&e.__hamt_isEmpty}function Ht(e,t,r,i){return{type:1,edit:e,hash:t,key:r,value:i,_modify:Xt}}function Kt(e,t,r){return{type:2,edit:e,hash:t,children:r,_modify:Yt}}function Vt(e,t,r){return{type:3,edit:e,mask:t,children:r,_modify:er}}function Zt(e,t,r){return{type:4,edit:e,size:t,children:r,_modify:tr}}function Gt(e,t,r,i,n,o){if(r===n)return Kt(e,r,[o,i]);var s=Ct(t,r),a=Ct(t,n);return Vt(e,Dt(s)|Dt(a),s===a?[Gt(e,t+5,r,i,n,o)]:s<a?[i,o]:[o,i])}function Wt(e,t){return e===t.edit}function Xt(e,t,r,i,n,o,s){if(t(o,this.key)){var a=i(this.value);return a===this.value?this:a===It?(--s.value,Qt):Wt(e,this)?(this.value=a,this):Ht(e,n,o,a)}var u=i();return u===It?this:(++s.value,Gt(e,r,this.hash,this,n,Ht(e,n,o,u)))}function Yt(e,t,r,i,n,o,s){if(n===this.hash){var a=function(e,t,r,i,n,o,s,a){for(var u=n.length,c=0;c<u;++c){var l=n[c];if(r(s,l.key)){var d=l.value,h=o(d);return h===d?n:h===It?(--a.value,Bt(e,c,n)):Lt(e,c,Ht(t,i,s,h),n)}}var f=o();return f===It?n:(++a.value,Lt(e,u,Ht(t,i,s,f),n))}(Wt(e,this),e,t,this.hash,this.children,i,o,s);return a===this.children?this:a.length>1?Kt(e,this.hash,a):a[0]}var u=i();return u===It?this:(++s.value,Gt(e,r,this.hash,this,n,Ht(e,n,o,u)))}function er(e,t,r,i,n,o,s){var a=this.mask,u=this.children,c=Ct(r,n),l=Dt(c),d=Ut(a,l),h=a&l,f=h?u[d]:Qt,v=f._modify(e,t,r+5,i,n,o,s);if(f===v)return this;var p,y=Wt(e,this),m=a,R=void 0;if(h&&Jt(v)){if(!(m&=~l))return Qt;if(u.length<=2&&((p=u[1^d])===Qt||1===p.type||2===p.type))return u[1^d];R=Bt(y,d,u)}else if(h||Jt(v))R=Lt(y,d,v,u);else{if(u.length>=_t)return function(e,t,r,i,n){for(var o=[],s=i,a=0,u=0;s;++u)1&s&&(o[u]=n[a++]),s>>>=1;return o[t]=r,Zt(e,a+1,o)}(e,c,v,a,u);m|=l,R=function(e,t,r,i){var n=i.length;if(e){for(var o=n;o>=t;)i[o--]=i[o];return i[t]=r,i}for(var s=0,a=0,u=new Array(n+1);s<t;)u[a++]=i[s++];for(u[t]=r;s<n;)u[++a]=i[s++];return u}(y,d,v,u)}return y?(this.mask=m,this.children=R,this):Vt(e,m,R)}function tr(e,t,r,i,n,o,s){var a=this.size,u=this.children,c=Ct(r,n),l=u[c],d=(l||Qt)._modify(e,t,r+5,i,n,o,s);if(l===d)return this;var h=Wt(e,this),f=void 0;if(Jt(l)&&!Jt(d))++a,f=Lt(h,c,d,u);else if(!Jt(l)&&Jt(d)){if(--a<=Et)return function(e,t,r,i){for(var n=new Array(t-1),o=0,s=0,a=0,u=i.length;a<u;++a)if(a!==r){var c=i[a];c&&!Jt(c)&&(n[o++]=c,s|=1<<a)}return Vt(e,s,n)}(e,a,c,u);f=Lt(h,c,Qt,u)}else f=Lt(h,c,d,u);return h?(this.size=a,this.children=f,this):Zt(e,a,f)}function rr(e,t,r,i){for(var n=i._root,o=0,s=i._config.keyEq;;)switch(n.type){case 1:return s(r,n.key)?n.value:e;case 2:if(t===n.hash)for(var a=n.children,u=0,c=a.length;u<c;++u){var l=a[u];if(s(r,l.key))return l.value}return e;case 3:var d=Dt(Ct(o,t));if(n.mask&d){n=n.children[Ut(n.mask,d)],o+=5;break}return e;case 4:if(n=n.children[Ct(o,t)]){o+=5;break}return e;default:return e}}function ir(e,t,r){return rr(e,r._config.hash(t),t,r)}function nr(e,t,r){return rr(It,e,t,r)!==It}function or(e,t){return e===t}function sr(e,t,r,i){var n={value:i._size},o=i._root._modify(i._editable?i._edit:NaN,i._config.keyEq,0,e,t,r,n);return i.setTree(o,n.value)}function ar(e,t,r,i){return sr(Mt(r),e,t,i)}const ur=Mt(It);function cr(e,t,r){return sr(ur,e,t,r)}function lr(e){return new $r(e._editable+1,e._edit+1,e._config,e._root,e._size)}function dr(e){return e._editable=e._editable&&e._editable-1,e}function hr(e){return e&&fr(e[0],e[1],e[2],e[3],e[4])}function fr(e,t,r,i,n){for(;r<e;){var o=t[r++];if(o&&!Jt(o))return vr(o,i,[e,t,r,i,n])}return hr(n)}function vr(e,t,r){switch(e.type){case 1:return{value:t(e),rest:r};case 2:case 4:case 3:var i=e.children;return fr(i.length,i,0,t,r);default:return hr(r)}}const pr={done:!0};function yr(e,t){return new Or(vr(e._root,t))}function mr(e){return[e.key,e.value]}function Rr(e){return yr(e,mr)}function br(e){return e.key}function wr(e){return e.value}function gr(e,t,r){var i=r._root;if(1===i.type)return e(t,i.value,i.key);for(var n=[i.children],o=void 0;o=n.pop();)for(var s=0,a=o.length;s<a;){var u=o[s++];u&&u.type&&(1===u.type?t=e(t,u.value,u.key):n.push(u.children))}return t}class Or{constructor(e){this.v=e}next(){if(!this.v)return pr;var e=this.v;return this.v=hr(e.rest),e}[Symbol.iterator](){return this}}class $r{constructor(e=!1,t=0,r={},i=Qt,n=0){this._editable=e,this._edit=t,this._config={keyEq:r&&r.keyEq||or,hash:r&&r.hash||Nt},this._root=i,this._size=n}get size(){return this._size}setTree(e,t){return this._editable?(this._root=e,this._size=t,this):e===this._root?this:new $r(this._editable,this._edit,this._config,e,t)}tryGetHash(e,t,r){return rr(e,t,r,this)}tryGet(e,t){return ir(e,t,this)}getHash(e,t){return function(e,t,r){return rr(void 0,e,t,r)}(e,t,this)}get(e,t){return ir(t,e,this)}hasHash(e,t){return nr(e,t,this)}has(e){return function(e,t){return nr(t._config.hash(e),e,t)}(e,this)}isEmpty(){return this&&!!Jt(this._root)}modifyHash(e,t,r){return sr(r,e,t,this)}modify(e,t){return function(e,t,r){return sr(e,r._config.hash(t),t,r)}(t,e,this)}setHash(e,t,r){return ar(e,t,r,this)}set(e,t){return function(e,t,r){return ar(r._config.hash(e),e,t,r)}(e,t,this)}deleteHash(e,t){return cr(e,t,this)}removeHash(e,t){return cr(e,t,this)}remove(e){return function(e,t){return cr(t._config.hash(e),e,t)}(e,this)}beginMutation(){return lr(this)}endMutation(){return dr(this)}mutate(e){return function(e,t){var r=lr(t);return e(r),dr(r)}(e,this)}entries(){return Rr(this)}keys(){return yr(this,br)}values(){return yr(this,wr)}fold(e,t){return gr(e,t,this)}forEach(e){return function(e,t){return gr((function(r,i,n){return e(i,n,t)}),null,t)}(e,this)}[Symbol.iterator](){return Rr(this)}}class zr{constructor(e){this._data=e?e.data:new $r}get size(){return this._data.size}clear(){this._data=new $r}get(e){return this._data.get(e)}set(e,t){this._data=this._data.set(e,t)}setMany(e){let t=this._data.beginMutation();e.forEach((e=>{t.set(e[0],e[1])})),this._data=t.endMutation()}remove(e){this._data=this._data.remove(e)}removeMany(e){let t=this._data.beginMutation();e.forEach((e=>{t.remove(e)})),this._data=t.endMutation()}has(e){return void 0!==this.get(e)}keys(){return this._data.keys()}values(){return this._data.values()}entries(){return this._data.entries()}get data(){return this._data}}const{assert:Ar}=B;let jr=class{constructor(e){Ar("RecordCache requires a `schema` setting to be constructed",!!e.schema);const{name:t,schema:r,keyMap:i}=e;this._name=t,this._schema=r,this._keyMap=i;let{validatorFor:n,validators:o}=e;const s=!1!==e.autoValidate;if(s?void 0!==n?Ar("RecordCache can be constructed with either a `validatorFor` or `validators`, but not both",void 0===o):n=jt({validators:o}):Ar("RecordCache should not be constructed with a `validatorFor` or `validators` if `autoValidate === false`",void 0===o&&void 0===n),this._validatorFor=n,void 0===e.queryBuilder||void 0===e.transformBuilder){let t=e.normalizer;void 0===t&&(t=new kt({schema:r,keyMap:i,validateInputs:s})),void 0===e.queryBuilder&&(e.queryBuilder=new mt({schema:r,normalizer:t,validatorFor:n})),void 0===e.transformBuilder&&(e.transformBuilder=new $t({schema:r,normalizer:t,validatorFor:n}))}this._queryBuilder=e.queryBuilder,this._transformBuilder=e.transformBuilder,this._defaultQueryOptions=e.defaultQueryOptions,this._defaultTransformOptions=e.defaultTransformOptions}get name(){return this._name}get schema(){return this._schema}get keyMap(){return this._keyMap}get validatorFor(){return this._validatorFor}get queryBuilder(){return this._queryBuilder}get transformBuilder(){return this._transformBuilder}get defaultQueryOptions(){return this._defaultQueryOptions}set defaultQueryOptions(e){this._defaultQueryOptions=e}get defaultTransformOptions(){return this._defaultTransformOptions}set defaultTransformOptions(e){this._defaultTransformOptions=e}getQueryOptions(e,t){return ae([this._defaultQueryOptions,e.options,null==t?void 0:t.options],this._name)}getTransformOptions(e,t){return ae([this._defaultTransformOptions,e.options,null==t?void 0:t.options],this._name)}};var Sr,xr;jr=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([H],jr);const{assert:kr}=B;let Fr;const Tr="function"==typeof(null===(Sr=B.globals.process)||void 0===Sr?void 0:Sr.nextTick)?function(e){Fr||(Fr=Promise.resolve()),Fr.then((()=>{B.globals.process.nextTick(e)}))}:null!==(xr=B.globals.setImmediate)&&void 0!==xr?xr:setTimeout;function qr(e){Pr.delete(e)}const Pr=new WeakSet;class _r{constructor(e){this._cache=e.cache,this._query=e.query}query(){return this._cache.query(this._query)}}class Er extends class{constructor(e){kr("Only single expression queries are supported on LiveQuery",!Array.isArray(e.query.expressions)),this.debounce=e.debounce,this._query=e.query}_subscribe(e){const t=this.debounce?(r=e,function e(){Pr.has(e)||(Pr.add(e),Tr((()=>{r(),qr(e)})))}):e;var r;const i=this.cache.on("patch",(e=>{this.operationRelevantForQuery(e)&&t()})),n=this.cache.on("reset",(()=>{t()}));return function(){qr(t),i(),n()}}operationRelevantForQuery(e){const t=function(e){const t=e.record,r={...$e(t),remove:!1,keys:[],attributes:[],relationships:[],meta:[],links:[]};switch(e.op){case"addRecord":case"updateRecord":t.keys&&(r.keys=Object.keys(t.keys)),t.attributes&&(r.attributes=Object.keys(t.attributes)),t.relationships&&(r.relationships=Object.keys(t.relationships)),t.meta&&(r.meta=Object.keys(t.meta)),t.links&&(r.links=Object.keys(t.links));break;case"replaceAttribute":r.attributes=[e.attribute];break;case"replaceKey":r.keys=[e.key];break;case"replaceRelatedRecord":case"replaceRelatedRecords":case"addToRelatedRecords":case"removeFromRelatedRecords":r.relationships=[e.relationship];break;case"removeRecord":r.remove=!0}return r}(e);return this.queryExpressionRelevantForChange(this._query.expressions,t)}queryExpressionRelevantForChange(e,t){switch(e.op){case"findRecord":return this.findRecordQueryExpressionRelevantForChange(e,t);case"findRecords":return this.findRecordsQueryExpressionRelevantForChange(e,t);case"findRelatedRecord":return this.findRelatedRecordQueryExpressionRelevantForChange(e,t);case"findRelatedRecords":return this.findRelatedRecordsQueryExpressionRelevantForChange(e,t);default:return!0}}findRecordQueryExpressionRelevantForChange(e,t){return ze(e.record,t)}findRecordsQueryExpressionRelevantForChange(e,t){if(e.type)return e.type===t.type;if(e.records){for(let r of e.records)if(r.type===t.type)return!0;return!1}return!0}findRelatedRecordQueryExpressionRelevantForChange(e,t){return ze(e.record,t)&&(t.relationships.includes(e.relationship)||t.remove)}findRelatedRecordsQueryExpressionRelevantForChange(e,t){const r=this.schema.getRelationship(e.record.type,e.relationship),i=null==r?void 0:r.type;return!(!Array.isArray(i)||!i.find((e=>e===t.type)))||i===t.type||ze(e.record,t)&&(t.relationships.includes(e.relationship)||t.remove)}}{constructor(e){super(e),this.cache=e.cache}get schema(){return this.cache.schema}get _update(){return new _r({cache:this.cache,query:this._query})}query(){return this._update.query()}subscribe(e){return this._subscribe((()=>{e(this._update)}))}}class Ir{constructor(e){this._accessor=e}get accessor(){return this._accessor}reset(e){}upgrade(){}validate(e){}before(e){return[]}after(e){return[]}immediate(e){}finally(e){return[]}}function Mr(e,t,r,i){return i?{record:$e(t),relationship:r,relatedRecord:i}:null}function Nr(e,t,r,i){if(i&&i.length>0){const e=$e(t);return i.map((t=>({record:e,relationship:r,relatedRecord:t})))}return[]}function Cr(e,t){const r=$e(t),i=[];return e.eachRelationship(t.type,(e=>{const n=I(t,["relationships",e,"data"]);if(Array.isArray(n))for(let t of n)i.push({record:r,relationship:e,relatedRecord:t});else n&&i.push({record:r,relationship:e,relatedRecord:n})})),i}class Dr extends Ir{after(e){switch(e.op){case"replaceRelatedRecord":return this.removeInverseRelationship(e.record,e.relationship,this.accessor.getRelatedRecordSync(e.record,e.relationship)),[];case"replaceRelatedRecords":return this.removeInverseRelationships(e.record,e.relationship,this.accessor.getRelatedRecordsSync(e.record,e.relationship)),[];case"removeFromRelatedRecords":return this.removeInverseRelationship(e.record,e.relationship,e.relatedRecord),[];case"removeRecord":case"updateRecord":return this.removeAllInverseRelationships(e.record),[];default:return[]}}finally(e){switch(e.op){case"replaceRelatedRecord":return this.addInverseRelationship(e.record,e.relationship,e.relatedRecord),[];case"replaceRelatedRecords":return this.addInverseRelationships(e.record,e.relationship,e.relatedRecords),[];case"addToRelatedRecords":return this.addInverseRelationship(e.record,e.relationship,e.relatedRecord),[];case"addRecord":case"updateRecord":return this.addAllInverseRelationships(e.record),[];case"removeRecord":return this.clearInverseRelationshipOps(e.record);default:return[]}}addInverseRelationship(e,t,r){let i=Mr(0,e,t,r);i&&this.accessor.addInverseRelationshipsSync([i])}addInverseRelationships(e,t,r){let i=Nr(0,e,t,r);i&&this.accessor.addInverseRelationshipsSync(i)}addAllInverseRelationships(e){let t=Cr(this.accessor.schema,e);t.length>0&&this.accessor.addInverseRelationshipsSync(t)}removeInverseRelationship(e,t,r){let i=Mr(0,e,t,r);i&&this.accessor.removeInverseRelationshipsSync([i])}removeInverseRelationships(e,t,r){let i=Nr(0,e,t,r);i.length>0&&this.accessor.removeInverseRelationshipsSync(i)}removeAllInverseRelationships(e){const t=this.accessor.getRecordSync(e);if(t){const e=Cr(this.accessor.schema,t);e.length>0&&this.accessor.removeInverseRelationshipsSync(e)}}clearInverseRelationshipOps(e){return function(e,t){var r;const i=[];for(let n of t){const{type:t}=n.record,{relationship:o}=n,s=e.getRelationship(t,o);"hasMany"===(null!==(r=s.kind)&&void 0!==r?r:s.type)?i.push({op:"removeFromRelatedRecords",record:n.record,relationship:n.relationship,relatedRecord:n.relatedRecord}):i.push({op:"replaceRelatedRecord",record:n.record,relationship:n.relationship,relatedRecord:null})}return i}(this.accessor.schema,this.accessor.getInverseRelationshipsSync(e))}}function Ur(e,t,r,i,n){const o=[];if(!ze(i,n)){const{type:s}=t,a=e.getRelationship(s,r).inverse;a&&(n&&o.push(Hr(e,n,a,t)),i&&o.push(Jr(e,i,a,t)))}return o}function Lr(e,t,r,i,n){const o=[],{type:s}=t,a=e.getRelationship(s,r);let u;if(n&&n.length>0){let r=je(n,i);Array.prototype.push.apply(o,Qr(e,t,a,r)),u=je(i,n)}else u=i;return Array.prototype.push.apply(o,Br(e,t,a,u)),o}function Br(e,t,r,i){if(i.length>0&&r.inverse){const n=r.inverse;return i.map((r=>Jr(e,r,n,t)))}return[]}function Qr(e,t,r,i){if(i.length>0){if("remove"===r.dependent)return function(e){return e.map((e=>({op:"removeRecord",record:e})))}(i);if(r.inverse){const n=r.inverse;return i.map((r=>Hr(e,r,n,t)))}}return[]}function Jr(e,t,r,i){var n;const{type:o}=t,s=e.getRelationship(o,r);return{op:"hasMany"===(null!==(n=s.kind)&&void 0!==n?n:s.type)?"addToRelatedRecords":"replaceRelatedRecord",record:t,relationship:r,relatedRecord:i}}function Hr(e,t,r,i){var n;const{type:o}=t,s=e.getRelationship(o,r),a="hasMany"===(null!==(n=s.kind)&&void 0!==n?n:s.type);return{op:a?"removeFromRelatedRecords":"replaceRelatedRecord",record:t,relationship:r,relatedRecord:a?i:null}}function Kr(e){return Array.isArray(e)?e:e?[e]:[]}class Vr extends Ir{after(e){switch(e.op){case"addRecord":return function(e,t){const r=[];if(t.relationships){const i=$e(t);e.eachRelationship(t.type,((n,o)=>{const s=I(t,["relationships",n,"data"]);if(s){const t=Kr(s);Array.prototype.push.apply(r,Br(e,i,o,t))}}))}return r}(this.accessor.schema,e.record);case"addToRelatedRecords":return function(e,t,r,i){const n=[];if(i){const{type:o}=t,s=e.getRelationship(o,r).inverse;s&&n.push(Jr(e,i,s,t))}return n}(this.accessor.schema,e.record,e.relationship,e.relatedRecord);case"replaceRelatedRecord":return Ur(this.accessor.schema,e.record,e.relationship,e.relatedRecord,this.accessor.getRelatedRecordSync(e.record,e.relationship));case"replaceRelatedRecords":return Lr(this.accessor.schema,e.record,e.relationship,e.relatedRecords,this.accessor.getRelatedRecordsSync(e.record,e.relationship));case"removeFromRelatedRecords":return function(e,t,r,i,n){const o=[];if(n){const{type:n}=t,s=e.getRelationship(n,r).inverse;s&&o.push(Hr(e,i,s,t))}return o}(this.accessor.schema,e.record,e.relationship,e.relatedRecord,this.accessor.getRecordSync(e.relatedRecord));case"removeRecord":return function(e,t){const r=[];if(t&&t.relationships){const i=$e(t);e.eachRelationship(t.type,((n,o)=>{const s=I(t,["relationships",n,"data"]);if(s){const t=Kr(s);Array.prototype.push.apply(r,Qr(e,i,o,t))}}))}return r}(this.accessor.schema,this.accessor.getRecordSync(e.record));case"updateRecord":return function(e,t,r){const i=[];if(t.relationships){const n=$e(t);e.eachRelationship(t.type,((o,s)=>{var a;const u=I(t,["relationships",o,"data"]),c=r&&I(r,["relationships",o,"data"]);void 0!==u&&("hasMany"===(null!==(a=s.kind)&&void 0!==a?a:s.type)?Array.prototype.push.apply(i,Lr(e,n,o,u||[],c||[])):Array.prototype.push.apply(i,Ur(e,n,o,u||null,c||null)))}))}return i}(this.accessor.schema,e.record,this.accessor.getRecordSync(e.record));default:return[]}}}class Zr extends Ir{constructor(e){super(e);const t=this.accessor,{schema:r,validatorFor:i}=t;if(void 0===i||void 0===r)throw new k("SyncSchemaValidationProcessor requires a RecordCache with both a `validationFor` and a `schema`.");this.schema=r,this.validatorFor=i}validate(e){const{schema:t,validatorFor:r}=this,i=zt(e,{schema:t,validatorFor:r});if(i)throw new Ce("Validation failed",i)}}const Gr={addRecord(e,t,r){const i=t,{type:n,id:o}=i.record,s=e.getRecordSync(i.record);return s?F(s,i.record)?void 0:{op:"updateRecord",record:s}:{op:"removeRecord",record:{type:n,id:o}}},updateRecord(e,t,r){const i=t,n=e.getRecordSync(i.record),o=i.record,{type:s,id:a}=o;if(!n){if(null==r?void 0:r.raiseNotFoundExceptions)throw new Je(s,a);return{op:"removeRecord",record:{type:s,id:a}}}{let e={type:s,id:a},t=!1;if(["attributes","keys"].forEach((r=>{o[r]&&Object.keys(o[r]).forEach((i=>{let s=o[r][i],a=I(n,[r,i]);F(s,a)||(t=!0,M(e,[r,i],void 0===a?null:a))}))})),o.relationships&&Object.keys(o.relationships).forEach((r=>{let i=I(o,["relationships",r,"data"]);if(void 0!==i){let o,s=I(n,["relationships",r,"data"]);Array.isArray(i)?s?o=!Ae(s,i):(o=!0,s=[]):s?o=!ze(s,i):(o=!0,s=null),o&&(t=!0,M(e,["relationships",r,"data"],s))}})),t)return{op:"updateRecord",record:e}}},removeRecord(e,t,r){const i=t,{record:n}=i,o=e.getRecordSync(n);if(o)return{op:"addRecord",record:o};if(null==r?void 0:r.raiseNotFoundExceptions)throw new Je(n.type,n.id)},replaceKey(e,t,r){const i=t,{record:n,key:o}=i,s=e.getRecordSync(n);if(void 0===s&&(null==r?void 0:r.raiseNotFoundExceptions))throw new Je(n.type,n.id);const a=s&&I(s,["keys",o]);if(!F(a,i.value)){const{type:e,id:t}=n;return{op:"replaceKey",record:{type:e,id:t},key:o,value:a}}},replaceAttribute(e,t,r){const i=t,{record:n,attribute:o}=i,s=e.getRecordSync(n);if(void 0===s&&(null==r?void 0:r.raiseNotFoundExceptions))throw new Je(n.type,n.id);const a=s&&I(s,["attributes",o]);if(!F(a,i.value)){const{type:e,id:t}=n;return{op:"replaceAttribute",record:{type:e,id:t},attribute:o,value:a}}},addToRelatedRecords(e,t,r){const i=t,{record:n,relationship:o,relatedRecord:s}=i,a=e.getRelatedRecordsSync(n,o);if(void 0===a&&(null==r?void 0:r.raiseNotFoundExceptions)&&void 0===e.getRecordSync(n))throw new Je(n.type,n.id);if(void 0===a||!Se(a,s))return{op:"removeFromRelatedRecords",record:n,relationship:o,relatedRecord:s}},removeFromRelatedRecords(e,t,r){const i=t,{record:n,relationship:o,relatedRecord:s}=i,a=e.getRelatedRecordsSync(n,o);if(void 0===a&&(null==r?void 0:r.raiseNotFoundExceptions)&&void 0===e.getRecordSync(n))throw new Je(n.type,n.id);if(void 0!==a&&Se(a,s))return{op:"addToRelatedRecords",record:n,relationship:o,relatedRecord:s}},replaceRelatedRecords(e,t,r){const i=t,{record:n,relationship:o,relatedRecords:s}=i,a=e.getRelatedRecordsSync(n,o);if(void 0===a&&(null==r?void 0:r.raiseNotFoundExceptions)&&void 0===e.getRecordSync(n))throw new Je(n.type,n.id);if(void 0===a||!Ae(a,s))return{op:"replaceRelatedRecords",record:n,relationship:o,relatedRecords:a||[]}},replaceRelatedRecord(e,t,r){const i=t,{record:n,relationship:o,relatedRecord:s}=i,a=e.getRelatedRecordSync(n,o);if(void 0===a&&(null==r?void 0:r.raiseNotFoundExceptions)&&void 0===e.getRecordSync(n))throw new Je(n.type,n.id);if(void 0===a||!ze(a,s))return{op:"replaceRelatedRecord",record:n,relationship:o,relatedRecord:a||null}}},Wr={findRecord(e,t,r){const{record:i}=t,n=e.getRecordSync(i);if(!n&&(null==r?void 0:r.raiseNotFoundExceptions))throw new Je(i.type,i.id);return n},findRecords(e,t,r){let i=t,n=e.getRecordsSync(i.records||i.type);return i.filter&&(n=Xr(n,i.filter)),i.sort&&(n=ei(n,i.sort)),i.page&&(n=ti(n,i.page)),n},findRelatedRecords(e,t,r){const i=t,{record:n,relationship:o}=i,s=e.getRelatedRecordsSync(n,o);if(!s||0===s.length){if(!e.getRecordSync(n)){if(null==r?void 0:r.raiseNotFoundExceptions)throw new Je(n.type,n.id);return}return[]}let a=e.getRecordsSync(s);return i.filter&&(a=Xr(a,i.filter)),i.sort&&(a=ei(a,i.sort)),i.page&&(a=ti(a,i.page)),a},findRelatedRecord(e,t,r){const i=t,{record:n,relationship:o}=i,s=e.getRelatedRecordSync(n,o);if(s)return e.getRecordSync(s)||null;if(e.getRecordSync(n))return null;if(null==r?void 0:r.raiseNotFoundExceptions)throw new Je(n.type,n.id)}};function Xr(e,t){return e.filter((e=>{for(let r=0,i=t.length;r<i;r++)if(!Yr(e,t[r]))return!1;return!0}))}function Yr(e,t){if("attribute"===t.kind){let r=I(e,["attributes",t.attribute]);if(void 0===r)return!1;let i=t.value;switch(t.op){case"equal":return r===i;case"gt":return r>i;case"gte":return r>=i;case"lt":return r<i;case"lte":return r<=i;default:throw new te("Filter operation ${filter.op} not recognized for Store.")}}else if("relatedRecords"===t.kind){let r=I(e,["relationships",t.relation,"data"]);if(void 0===r)return!1;let i=t.records;switch(t.op){case"equal":return r.length===i.length&&i.every((e=>r.some((t=>t.id===e.id&&t.type===e.type))));case"all":return i.every((e=>r.some((t=>t.id===e.id&&t.type===e.type))));case"some":return i.some((e=>r.some((t=>t.id===e.id&&t.type===e.type))));case"none":return!i.some((e=>r.some((t=>t.id===e.id&&t.type===e.type))));default:throw new te("Filter operation ${filter.op} not recognized for Store.")}}else if("relatedRecord"===t.kind){let r=I(e,["relationships",t.relation,"data"]);if(void 0===r)return!1;let i=t.record;switch(t.op){case"equal":return null===r?null===i:Array.isArray(i)?i.some((e=>r.type===e.type&&r.id===e.id)):!!i&&r.type===i.type&&r.id===i.id;default:throw new te("Filter operation ${filter.op} not recognized for Store.")}}return!1}function ei(e,t){const r=new Map;e.forEach((e=>{r.set(e,t.map((t=>{if("attribute"===t.kind)return I(e,["attributes",t.attribute]);throw new te("Sort specifier ${sortSpecifier.kind} not recognized for Store.")})))}));const i=t.map((e=>"descending"===e.order?-1:1));return e.sort(((e,n)=>{const o=r.get(e),s=r.get(n);for(let e=0;e<t.length;e++){if(o[e]<s[e])return-i[e];if(o[e]>s[e])return i[e];if(_(o[e])&&!_(s[e]))return i[e];if(_(s[e])&&!_(o[e]))return-i[e]}return 0}))}function ti(e,t){if(void 0!==t.limit){let r=void 0===t.offset?0:t.offset;return e.slice(r,r+t.limit)}throw new te("Pagination options not recognized for Store. Please specify `offset` and `limit`.")}const ri={addRecord(e,t,r){const i=t,{record:n}=i;return e.setRecordSync(n),e.keyMap&&e.keyMap.pushRecord(n),n},updateRecord(e,t,r){const i=t,{record:n}=i,o=e.getRecordSync(n);if(void 0===o&&(null==r?void 0:r.raiseNotFoundExceptions))throw new Je(n.type,n.id);const s=xe(o||null,n);return e.setRecordSync(s),e.keyMap&&e.keyMap.pushRecord(s),s},removeRecord(e,t,r){const i=t,n=e.removeRecordSync(i.record);if(void 0===n&&(null==r?void 0:r.raiseNotFoundExceptions))throw new Je(i.record.type,i.record.id);return n},replaceKey(e,t,r){const i=t,n=e.getRecordSync(i.record);let o;if(n)o=T(n);else if(o=$e(i.record),null==r?void 0:r.raiseNotFoundExceptions)throw new Je(o.type,o.id);return M(o,["keys",i.key],i.value),e.setRecordSync(o),e.keyMap&&e.keyMap.pushRecord(o),o},replaceAttribute(e,t,r){const i=t,n=e.getRecordSync(i.record);let o;if(n)o=T(n);else if(o=$e(i.record),null==r?void 0:r.raiseNotFoundExceptions)throw new Je(o.type,o.id);return M(o,["attributes",i.attribute],i.value),e.setRecordSync(o),o},addToRelatedRecords(e,t,r){const i=t,{relationship:n,relatedRecord:o}=i,s=e.getRecordSync(i.record);let a;if(s)a=T(s);else if(a=$e(i.record),null==r?void 0:r.raiseNotFoundExceptions)throw new Je(a.type,a.id);const u=I(a,["relationships",n,"data"])||[];return Se(u,o)||(u.push(o),M(a,["relationships",n,"data"],u),e.setRecordSync(a)),a},removeFromRelatedRecords(e,t,r){const i=t,n=e.getRecordSync(i.record),{relationship:o,relatedRecord:s}=i;let a;if(n){a=T(n);let t=I(a,["relationships",o,"data"]);return t&&(t=t.filter((e=>!ze(e,s))),M(a,["relationships",o,"data"],t)&&e.setRecordSync(a)),a}if(null==r?void 0:r.raiseNotFoundExceptions)throw new Je(i.record.type,i.record.id)},replaceRelatedRecords(e,t,r){const i=t,n=e.getRecordSync(i.record),{relationship:o,relatedRecords:s}=i;let a;if(n)a=T(n);else if(a=$e(i.record),null==r?void 0:r.raiseNotFoundExceptions)throw new Je(a.type,a.id);return M(a,["relationships",o,"data"],s)&&e.setRecordSync(a),a},replaceRelatedRecord(e,t,r){const i=t,n=e.getRecordSync(i.record),{relationship:o,relatedRecord:s}=i;let a;if(n)a=T(n);else if(a=$e(i.record),null==r?void 0:r.raiseNotFoundExceptions)throw new Je(a.type,a.id);return M(a,["relationships",o,"data"],s)&&e.setRecordSync(a),a}},{assert:ii,deprecate:ni}=B;class oi extends jr{constructor(e){var t,r,i;super(e),this._queryOperators=null!==(t=e.queryOperators)&&void 0!==t?t:Wr,this._transformOperators=null!==(r=e.transformOperators)&&void 0!==r?r:ri,this._inverseTransformOperators=null!==(i=e.inverseTransformOperators)&&void 0!==i?i:Gr,this._debounceLiveQueries=!1!==e.debounceLiveQueries,this._transformBuffer=e.transformBuffer;const n=e.processors?e.processors:[Vr,Dr];!1!==e.autoValidate&&void 0===e.processors&&n.push(Zr),this._processors=n.map((e=>{let t=new e(this);return ii("Each processor must extend SyncOperationProcessor",t instanceof Ir),t}))}get processors(){return this._processors}getQueryOperator(e){return this._queryOperators[e]}getTransformOperator(e){return this._transformOperators[e]}getInverseTransformOperator(e){return this._inverseTransformOperators[e]}applyRecordChangesetSync(e){const{setRecords:t,removeRecords:r,addInverseRelationships:i,removeInverseRelationships:n}=e;t&&t.length>0&&this.setRecordsSync(t),r&&r.length>0&&this.removeRecordsSync(r),i&&i.length>0&&this.addInverseRelationshipsSync(i),n&&n.length>0&&this.removeInverseRelationshipsSync(n)}getRelatedRecordSync(e,t){const r=this.getRecordSync(e);if(r)return I(r,["relationships",t,"data"])}getRelatedRecordsSync(e,t){const r=this.getRecordSync(e);if(r)return I(r,["relationships",t,"data"])}query(e,t,r){const i=oe(e,t,r,this._queryBuilder),n=this._query(i,t);return(null==t?void 0:t.fullResponse)?n:n.data}update(e,t,r){const i=he(e,t,r,this._transformBuilder),n=this._update(i,t);return(null==t?void 0:t.fullResponse)?n:n.data}patch(e){ni("SyncRecordCache#patch has been deprecated. Use SyncRecordCache#update instead.");const{data:t,details:r}=this.update(e,{fullResponse:!0});return{inverse:(null==r?void 0:r.inverseOperations)||[],data:Array.isArray(t)?t:[t]}}liveQuery(e,t,r){const i=oe(e,t,r,this.queryBuilder);let n=t&&t.debounce;return"boolean"!=typeof n&&(n=this._debounceLiveQueries),new Er({debounce:n,cache:this,query:i})}_query(e,t){let r;if(Array.isArray(e.expressions)){r=[];for(let t of e.expressions){const i=this.getQueryOperator(t.op);if(!i)throw new Error(`Unable to find query operator: ${t.op}`);r.push(i(this,t,this.getQueryOptions(e,t)))}}else{const t=e.expressions,i=this.getQueryOperator(t.op);if(!i)throw new Error(`Unable to find query operator: ${t.op}`);r=i(this,t,this.getQueryOptions(e,t))}return{data:r}}_update(e,t){var r,i;if(null===(r=this.getTransformOptions(e))||void 0===r?void 0:r.useBuffer){const t=this._initTransformBuffer(e);t.startTrackingChanges();const r=t.update(e,{fullResponse:!0}),i=t.stopTrackingChanges();this.applyRecordChangesetSync(i);const{appliedOperations:n,appliedOperationResults:o}=r.details;for(let e=0,t=n.length;e<t;e++)this.emit("patch",n[e],o[e]);return r}{const r={data:[]};let n;return(null==t?void 0:t.fullResponse)&&(r.details={appliedOperations:[],appliedOperationResults:[],inverseOperations:[]}),Array.isArray(e.operations)?(this._applyTransformOperations(e,e.operations,r,!0),n=r.data):(this._applyTransformOperation(e,e.operations,r,!0),Array.isArray(r.data)&&(n=r.data[0])),(null==t?void 0:t.fullResponse)&&(null===(i=r.details)||void 0===i||i.inverseOperations.reverse()),{...r,data:n}}}_getTransformBuffer(){if(void 0===this._transformBuffer)throw new k("transformBuffer must be provided to cache via constructor settings");return this._transformBuffer}_initTransformBuffer(e){const t=this._getTransformBuffer(),r=function(e){const t=[];for(let r of e){if(r.record&&(t.push(r.record),"addRecord"===r.op||"updateRecord"===r.op)){let e=r.record;if(e.relationships)for(let r in e.relationships){let i=e.relationships[r];(null==i?void 0:i.data)&&(Array.isArray(i.data)?Array.prototype.push.apply(t,i.data):t.push(i.data))}}"addToRelatedRecords"===r.op||"removeFromRelatedRecords"===r.op||"replaceRelatedRecord"===r.op?r.relatedRecord&&t.push(r.relatedRecord):"replaceRelatedRecords"===r.op&&Array.prototype.push.apply(t,r.relatedRecords)}return function(e){let t={},r=[];return e.forEach((e=>{const i=Fe(e);void 0===t[i]&&(r.push(e),t[i]=!0)})),r}(t)}(q(e.operations)),i=this.getInverseRelationshipsSync(r),n=i.map((e=>e.record));return Array.prototype.push.apply(r,n),t.resetState(),t.setRecordsSync(this.getRecordsSync(r)),t.addInverseRelationshipsSync(i),t}_applyTransformOperations(e,t,r,i=!1){for(const n of t)this._applyTransformOperation(e,n,r,i)}_applyTransformOperation(e,t,r,i=!1){var n,o,s,a;t instanceof ne&&(t=t.toOperation());for(let e of this._processors)e.validate(t);const u=this.getInverseTransformOperator(t.op)(this,t,this.getTransformOptions(e,t));if(u){null===(o=null===(n=r.details)||void 0===n?void 0:n.inverseOperations)||void 0===o||o.push(u);for(let i of this._processors)this._applyTransformOperations(e,i.before(t),r);let a=[];for(let e of this._processors)a.push(e.after(t));let c=this.getTransformOperator(t.op)(this,t,this.getTransformOptions(e,t));i&&(null===(s=r.data)||void 0===s||s.push(c)),r.details&&(r.details.appliedOperationResults.push(c),r.details.appliedOperations.push(t));for(let e of this._processors)e.immediate(t);this.emit("patch",t,c);for(let t of a)this._applyTransformOperations(e,t,r);for(let i of this._processors)this._applyTransformOperations(e,i.finally(t),r)}else i&&(null===(a=r.data)||void 0===a||a.push(void 0))}}function si(e){return`${Fe(e.record)}::${e.relationship}`}function ai(e){const[t,r]=e.split("::");return{record:Te(t),relationship:r}}class ui extends oi{constructor(e){super(e),this.resetState()}resetState(){this._state={records:{},inverseRelationships:{}}}startTrackingChanges(){this._delta={records:{},inverseRelationships:{}}}stopTrackingChanges(){var e,t,r,i;if(void 0===this._delta)throw new Error("Changes are not being tracked. Call 'startTrackingChanges' before 'stopTrackingChanges'");let{records:n,inverseRelationships:o}=this._delta,s={};for(let r of Object.keys(n)){let i=n[r];null===i?(s.removeRecords=null!==(e=s.removeRecords)&&void 0!==e?e:[],s.removeRecords.push(Te(r))):(s.setRecords=null!==(t=s.setRecords)&&void 0!==t?t:[],s.setRecords.push(i))}for(let e of Object.keys(o)){let t=Te(e),n=o[e];for(let e of Object.keys(n)){let o=n[e],{record:a,relationship:u}=ai(e),c={relatedRecord:t,record:a,relationship:u};null===o?(s.removeInverseRelationships=null!==(r=s.removeInverseRelationships)&&void 0!==r?r:[],s.removeInverseRelationships.push(c)):(s.addInverseRelationships=null!==(i=s.addInverseRelationships)&&void 0!==i?i:[],s.addInverseRelationships.push(c))}}return this._delta=void 0,s}getRecordSync(e){var t;return null!==(t=this._state.records[Fe(e)])&&void 0!==t?t:void 0}getRecordsSync(e){if("string"==typeof e)return N(this._state.records[e]);if(Array.isArray(e)){const t=[],r=e;for(let e of r){let r=this.getRecordSync(e);r&&t.push(r)}return t}throw new Error("typeOrIdentities must be specified in getRecordsSync")}setRecordSync(e){this._state.records[Fe(e)]=e,this._delta&&(this._delta.records[Fe(e)]=e)}setRecordsSync(e){e.forEach((e=>this.setRecordSync(e)))}removeRecordSync(e){const t=this.getRecordSync(e);return t?(delete this._state.records[Fe(t)],this._delta&&(this._delta.records[Fe(t)]=null),t):void 0}removeRecordsSync(e){const t=[];for(let r of e){let e=this.getRecordSync(r);e&&(t.push(e),delete this._state.records[Fe(e)],this._delta&&(this._delta.records[Fe(e)]=null))}return t}getInverseRelationshipsSync(e){if(Array.isArray(e)){let t=[];return e.forEach((e=>{Array.prototype.push(t,this._getInverseRelationshipsSync(e))})),t}return this._getInverseRelationshipsSync(e)}addInverseRelationshipsSync(e){var t,r;for(let i of e){const e=Fe(i.relatedRecord),n=si(i),o=null!==(t=this._state.inverseRelationships[e])&&void 0!==t?t:{};if(o[n]=i,this._state.inverseRelationships[e]=o,this._delta){const t=null!==(r=this._delta.inverseRelationships[e])&&void 0!==r?r:{};t[n]=i,this._delta.inverseRelationships[e]=t}}}removeInverseRelationshipsSync(e){var t;for(let r of e){const e=Fe(r.relatedRecord),i=si(r),n=this._state.inverseRelationships[e];n&&(n[i]=null,this._delta)&&((null!==(t=this._delta.inverseRelationships[e])&&void 0!==t?t:{})[i]=null)}}_getInverseRelationshipsSync(e){let t=this._state.inverseRelationships[Fe(e)];return t?N(t).filter((e=>null!==e)):[]}}const{assert:ci,deprecate:li}=B;class di extends oi{constructor(e){const{base:t,trackUpdateOperations:r}=e;super(e),this._base=t,this._isTrackingUpdateOperations=null!=r?r:void 0!==t,this.reset()}get base(){return this._base}fork(e={}){var t,r,i,n,o;return e.base=this,e.schema=this.schema,e.keyMap=this._keyMap,null!==(t=e.queryBuilder)&&void 0!==t||(e.queryBuilder=this._queryBuilder),null!==(r=e.transformBuilder)&&void 0!==r||(e.transformBuilder=this._transformBuilder),null!==(i=e.defaultQueryOptions)&&void 0!==i||(e.defaultQueryOptions=this._defaultQueryOptions),null!==(n=e.defaultTransformOptions)&&void 0!==n||(e.defaultTransformOptions=this._defaultTransformOptions),!1!==e.autoValidate&&(null!==(o=e.validatorFor)&&void 0!==o||(e.validatorFor=this._validatorFor),void 0===e.autoValidate&&void 0===e.validatorFor&&(e.autoValidate=!1)),new di(e)}merge(e,t){let{coalesce:r,...i}=null!=t?t:{};ci("MemoryCache#merge can only merge a forked cache that is configured with `trackUpdateOperations: true`.",e.isTrackingUpdateOperations);let n=e.getAllUpdateOperations();return!1!==r&&(n=et(n)),this.update(n,i)}rebase(){ci("A `base` cache must be defined for `rebase` to work",void 0!==this._base),ci("MemoryCache#rebase requires that the cache is configured with `trackUpdateOperations: true`.",this._isTrackingUpdateOperations);let e=this.getAllUpdateOperations();this.reset(),this.update(e)}getRecordSync(e){return this._records[e.type].get(e.id)}getRecordsSync(e){if(void 0===e){const e=Object.keys(this.schema.models),t=[];return e.forEach((e=>Array.prototype.push.apply(t,Array.from(this._records[e].values())))),t}if("string"==typeof e)return Array.from(this._records[e].values());{const t=[],r=e;for(let e of r){let r=this.getRecordSync(e);r&&t.push(r)}return t}}setRecordSync(e){this._records[e.type].set(e.id,e)}setRecordsSync(e){let t={};for(let r of e)t[r.type]=t[r.type]||[],t[r.type].push([r.id,r]);for(let e in t)this._records[e].setMany(t[e])}removeRecordSync(e){const t=this._records[e.type],r=t.get(e.id);return r?(t.remove(e.id),r):void 0}removeRecordsSync(e){const t=[],r={};for(let i of e){let e=this.getRecordSync(i);e&&(t.push(e),r[e.type]=r[e.type]||[],r[e.type].push(i.id))}for(let e in r)this._records[e].removeMany(r[e]);return t}getInverseRelationshipsSync(e){const t=[],r=Array.isArray(e)?e:[e];for(let e of r){const r=this._inverseRelationships[e.type].get(e.id);r&&Array.prototype.push.apply(t,r)}return t}addInverseRelationshipsSync(e){e.forEach((e=>{let t=this._inverseRelationships[e.relatedRecord.type].get(e.relatedRecord.id);t=t?[...t,T(e)]:[T(e)],this._inverseRelationships[e.relatedRecord.type].set(e.relatedRecord.id,t)}))}removeInverseRelationshipsSync(e){e.forEach((e=>{let t=this._inverseRelationships[e.relatedRecord.type].get(e.relatedRecord.id);if(t){let r=t.filter((t=>!(ze(t.record,e.record)&&t.relationship===e.relationship)));this._inverseRelationships[e.relatedRecord.type].set(e.relatedRecord.id,r)}}))}reset(){let e=this._base;arguments.length>0&&(li("Calling MemoryCache#reset with a `base` argument is deprecated. Instead configure your MemoryCache with a `base` cache."),null!=e||(e=arguments[0])),this._records={},this._isTrackingUpdateOperations&&(this._updateOperations=[]),Object.keys(this._schema.models).forEach((t=>{this._records[t]=new zr(null==e?void 0:e._records[t])})),this._resetInverseRelationships(e),this._processors.forEach((t=>t.reset(e))),this.emit("reset")}upgrade(){Object.keys(this._schema.models).forEach((e=>{this._records[e]||(this._records[e]=new zr)})),this._resetInverseRelationships();for(let e of this._processors)e.upgrade()}get isTrackingUpdateOperations(){return this._isTrackingUpdateOperations}getAllUpdateOperations(){return ci("MemoryCache#getAllUpdateOperations requires that cache be configured with `trackUpdateOperations: true`.",this._isTrackingUpdateOperations),this._updateOperations}_update(e,t){return this._isTrackingUpdateOperations&&Array.prototype.push.apply(this._updateOperations,q(e.operations)),super._update(e,t)}_getTransformBuffer(){if(void 0===this._transformBuffer){const{schema:e,keyMap:t}=this;this._transformBuffer=new ui({schema:e,keyMap:t})}return this._transformBuffer}_resetInverseRelationships(e){const t={};Object.keys(this._schema.models).forEach((r=>{t[r]=new zr(e&&e._inverseRelationships[r])})),this._inverseRelationships=t}}var hi;const{assert:fi,deprecate:vi}=B;let pi=hi=class extends Tt{constructor(e){var t,r,i,n,o,s,a,u;const{keyMap:c,schema:l,base:d}=e;e.name=null!==(t=e.name)&&void 0!==t?t:"memory",super(e),this._transforms={},this._transformInverses={},this.transformLog.on("clear",this._logCleared.bind(this)),this.transformLog.on("truncate",this._logTruncated.bind(this)),this.transformLog.on("rollback",this._logRolledback.bind(this));let h=null!==(r=e.cacheSettings)&&void 0!==r?r:{};h.schema=l,h.keyMap=c,null!==(i=h.queryBuilder)&&void 0!==i||(h.queryBuilder=this.queryBuilder),null!==(n=h.transformBuilder)&&void 0!==n||(h.transformBuilder=this.transformBuilder),null!==(o=h.defaultQueryOptions)&&void 0!==o||(h.defaultQueryOptions=this.defaultQueryOptions),null!==(s=h.defaultTransformOptions)&&void 0!==s||(h.defaultTransformOptions=this.defaultTransformOptions),null!==(a=h.autoValidate)&&void 0!==a||(h.autoValidate=e.autoValidate),!1!==h.autoValidate&&void 0===h.validatorFor&&void 0===h.validators&&(h.validatorFor=this._validatorFor),d&&(this._base=d,this._forkPoint=d.transformLog.head,h.base=d.cache);const f=null!==(u=e.cacheClass)&&void 0!==u?u:di;this._cache=new f(h)}get cache(){return this._cache}get base(){return this._base}get forkPoint(){return this._forkPoint}async upgrade(){this._cache.upgrade()}async _sync(e){this.transformLog.contains(e.id)||(this._applyTransform(e),await this.transformed([e]))}async _update(e,t){let r;const i={};return this.transformLog.contains(e.id)||(r=this._applyTransform(e),i.transforms=[e]),(null==t?void 0:t.data)?Array.isArray(e.operations)?(fi("MemorySource#update: `hints.data` must be an array if `transform.operations` is an array",Array.isArray(t.data)),i.data=t.data.map((e=>this._retrieveOperationResult(e)))):i.data=this._retrieveOperationResult(t.data):r&&(i.data=r),(null==t?void 0:t.details)&&(i.details=t.details),i}async _query(e,t){let r;return(null==t?void 0:t.data)?(r={},Array.isArray(e.expressions)?(fi("MemorySource#query: `hints.data` must be an array if `query.expressions` is an array",Array.isArray(t.data)),r.data=t.data.map((e=>this._retrieveQueryExpressionResult(e)))):r.data=this._retrieveQueryExpressionResult(t.data)):r=this._cache.query(e,{fullResponse:!0}),(null==t?void 0:t.details)&&(r.details=t.details),r}fork(e={}){var t,r,i,n,o;return e.base=this,e.schema=this.schema,e.keyMap=this.keyMap,null!==(t=e.queryBuilder)&&void 0!==t||(e.queryBuilder=this._queryBuilder),null!==(r=e.transformBuilder)&&void 0!==r||(e.transformBuilder=this._transformBuilder),null!==(i=e.defaultQueryOptions)&&void 0!==i||(e.defaultQueryOptions=this._defaultQueryOptions),null!==(n=e.defaultTransformOptions)&&void 0!==n||(e.defaultTransformOptions=this._defaultTransformOptions),!1!==e.autoValidate&&(null!==(o=e.validatorFor)&&void 0!==o||(e.validatorFor=this._validatorFor),void 0===e.autoValidate&&void 0===e.validatorFor&&(e.autoValidate=!1)),new hi(e)}async merge(e,t){let r,{coalesce:i,sinceTransformId:n,transformOptions:o,...s}=null!=t?t:{};o?(vi("In MemorySource#merge, passing `transformOptions` nested within `options` is deprecated. Instead, include them directly alongside other options."),r=o):r=null!=s?s:{};let a=[];if(e.cache.isTrackingUpdateOperations)a=e.cache.getAllUpdateOperations();else{let t;n?(vi("In MemorySource#merge, passing `sinceTransformId` is deprecated. Instead, call `update` with a custom transform/operations."),t=e.getTransformsSince(n)):t=e.getAllTransforms(),t.forEach((e=>{Array.prototype.push.apply(a,q(e.operations))}))}return!1!==i&&(a=et(a)),this.update(a,r)}rebase(){const e=this._base;if(!e)throw new k("A `base` source must be defined for `rebase` to work");this.cache.reset(),this.getAllTransforms().forEach((e=>this._applyTransform(e))),this._forkPoint=e.transformLog.head}async reset(){this.cache.reset(),this._forkPoint=this._base?this._base.transformLog.head:void 0,await this.transformLog.clear()}rollback(e,t=0){return this.transformLog.rollback(e,t)}getTransformsSince(e){return this.transformLog.after(e).map((e=>this._transforms[e]))}transformsSince(e){return vi("MemorySource#transformsSince has been deprecated. Please call `source.getTransformsSince(tranformId)` instead."),this.getTransformsSince(e)}getAllTransforms(){return this.transformLog.entries.map((e=>this._transforms[e]))}allTransforms(){return vi("MemorySource#allTransforms has been deprecated. Please call `source.getAllTransforms()` instead."),this.getAllTransforms()}getTransform(e){return this._transforms[e]}getInverseOperations(e){return this._transformInverses[e]}get defaultQueryOptions(){return super.defaultQueryOptions}set defaultQueryOptions(e){super.defaultQueryOptions=this._cache.defaultQueryOptions=e}get defaultTransformOptions(){return super.defaultTransformOptions}set defaultTransformOptions(e){this._defaultTransformOptions=this._cache.defaultTransformOptions=e}_retrieveQueryExpressionResult(e){return Array.isArray(e)?this._cache.getRecordsSync(e):e?this._cache.getRecordSync(e):e}_retrieveOperationResult(e){return e?this._cache.getRecordSync(e):e}_applyTransform(e){var t;const{data:r,details:i}=this.cache.update(e,{fullResponse:!0});return this._transforms[e.id]=e,this._transformInverses[e.id]=null!==(t=null==i?void 0:i.inverseOperations)&&void 0!==t?t:[],r}_clearTransformFromHistory(e){delete this._transforms[e],delete this._transformInverses[e]}_logCleared(){this._transforms={},this._transformInverses={}}_logTruncated(e,t,r){r.forEach((e=>this._clearTransformFromHistory(e)))}_logRolledback(e,t,r){r.reverse().forEach((e=>{const t=this._transformInverses[e];t&&this.cache.update(t),this._clearTransformFromHistory(e)}))}};pi=hi=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([function(e){let t=e.prototype;t.__syncable__||(we("Syncable interface can only be applied to a Source",t instanceof de),t.__syncable__=!0,t.sync=async function(e){if(await this.activated,!Array.isArray(e)){let t;if("function"==typeof e)t=he(e,void 0,void 0,this.transformBuilder);else if(t=e,this.transformLog.contains(t.id))return;return this._syncQueue.push({type:"sync",data:t})}{const t=e;for(let e of t)await this.sync(e)}},t.__sync__=async function(e){if(!this.transformLog.contains(e.id))try{await V(this,"beforeSync",e),await this._sync(e),await this.transformed([e]),await K(this,"sync",e)}catch(t){throw await K(this,"syncFail",e,t),t}})},be,Oe],pi);class yi extends j{constructor(e){super(`Client error: ${e}`)}}class mi extends j{constructor(e){super(`Server error: ${e}`)}}class Ri extends j{constructor(e){super(`Network error: ${e}`)}}class bi extends j{constructor(e){super(`Invalid server response: ${e}`),this.response=e}}function wi(e,t=[]){let r=[];return Object.keys(e).forEach((i=>{if(!e.hasOwnProperty(i))return;let n=t.slice();n.push(i),null!==e[i]&&"object"==typeof e[i]?Array.prototype.push.apply(r,wi(e[i],n)):r.push({path:n,val:e[i]})})),r}function gi(e){return wi(e).map((e=>{let t,r=e.val;return null===r&&(r="null"),t=1===e.path.length?e.path[0]:e.path[0]+"["+e.path.slice(1).join("][")+"]",{path:t,val:r}})).map((e=>encodeURIComponent(e.path)+"="+encodeURIComponent(e.val))).join("&")}function Oi(e,t){let r=e;if(t.filter&&Array.isArray(t.filter)){let e=t.filter;delete t.filter,e.forEach((e=>{r=Oi(r,{filter:e})}))}let i=gi(t);return i.length>0&&(r+=function(e){return-1===e.indexOf("?")?"?":"&"}(r),r+=i),r}var $i;!function(e){e.Resource="resource",e.ResourceField="resourceField",e.ResourceIdentity="resourceIdentity",e.ResourceType="resourceType",e.ResourceDocument="resourceDocument",e.ResourceTypeParam="resourceTypeParam",e.ResourceTypePath="resourceTypePath",e.ResourceFieldParam="resourceFieldParam",e.ResourceFieldPath="resourceFieldPath",e.ResourceAtomicOperation="resourceAtomicOperation",e.ResourceAtomicOperationsDocument="resourceAtomicOperationsDocument",e.ResourceAtomicResultsDocument="resourceAtomicResultsDocument"}($i||($i={}));const{deprecate:zi}=B;class Ai{constructor(e){this.host=e.host,this.namespace=e.namespace,this.serializerFor=e.serializerFor,e.serializer&&(this.serializer=e.serializer,zi("The 'serializer' setting for 'JSONAPIURLBuilder' has been deprecated. Pass 'serializerFor' instead.")),this.keyMap=e.keyMap}resourceNamespace(e){return this.namespace}resourceHost(e){return this.host}resourceURL(e,t){let r=this.resourceHost(e),i=this.resourceNamespace(e),n=[];return r&&n.push(r),i&&n.push(i),n.push(this.resourcePath(e,t)),r||n.unshift(""),n.join("/")}resourcePath(e,t){let r,i;this.serializer?(r=this.serializer.resourceType(e),t&&(i=this.serializer.resourceId(e,t))):(r=this.serializerFor($i.ResourceTypePath).serialize(e),t&&(i=this.serializerFor($i.ResourceIdentity).serialize({type:e,id:t}).id));let n=[r];return i&&n.push(i),n.join("/")}resourceRelationshipURL(e,t,r){return[this.resourceURL(e,t),"relationships",this.serializeRelationshipInPath(e,r)].join("/")}relatedResourceURL(e,t,r){return[this.resourceURL(e,t),this.serializeRelationshipInPath(e,r)].join("/")}buildFilterParam(e,t){var r,i,n;const o=[];if(Array.isArray(e))for(let t of e)if("attribute"===t.kind&&"equal"===t.op){const e=t,i=this.serializeFieldParam(e.attribute,{kind:"attribute"});o.push({[i]:null!==(r=e.value)&&void 0!==r?r:null})}else if("relatedRecord"===t.kind){const e=t;if("equal"!==e.op)throw new te(`Filter operation '${e.op}' not recognized by JSONAPIURLBuilder#buildFilterParam for relatedRecord filtering. Override this method to provide a custom handler.`);const r=this.serializeFieldParam(e.relation,{kind:"relationship"});Array.isArray(e.record)?o.push({[r]:e.record.map((e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null})).join(",")}):o.push({[r]:null!==(n=null===(i=null==e?void 0:e.record)||void 0===i?void 0:i.id)&&void 0!==n?n:null})}else{if("relatedRecords"!==t.kind)throw new te(`Filter operation '${t.op}' not recognized by JSONAPIURLBuilder#buildFilterParam. Override this method to provide a custom handler.`);{const e=t;if("equal"!==e.op)throw new te(`Filter operation '${e.op}' not recognized by JSONAPIURLBuilder#buildFilterParam for relatedRecords filtering. Override this method to provide a custom handler.`);const r=this.serializeFieldParam(e.relation,{kind:"relationship"});o.push({[r]:e.records.map((e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null})).join(",")})}}else for(let t in e){const r=e[t],i=this.serializeFieldParam(t);if(Array.isArray(r))for(let e of r)o.push({[i]:e});else o.push({[i]:r})}return o}buildSortParam(e,t){if(Array.isArray(e))return e.map((e=>{let t,r;if("string"==typeof e?(t="-"===e.charAt(0),r=t?e.substring(1):e):"attribute"===e.kind&&(t="descending"===e.order,r=e.attribute),r)return`${t?"-":""}${this.serializeFieldParam(r,{kind:"attribute"})}`})).join(",");if("string"==typeof e)return e;throw new te("Sort specifier not recognized for JSONAPISource.")}buildPageParam(e,t){let r=T(e);return delete r.kind,r}buildIncludeParam(e,t){return Array.isArray(e)?e.map((e=>(Array.isArray(e)?e:e.split(".")).map((e=>this.serializeFieldParam(e,{kind:"relationship"}))).join("."))).join(","):e}buildFieldsParam(e,t){const r={};for(let t in e){const i=e[t],n=this.serializerFor($i.ResourceTypeParam).serialize(t),o=Array.isArray(i)?i:i.split(",");r[n]=o.map((e=>this.serializeFieldParam(e))).join(",")}return r}appendQueryParams(e,t){let r=e;return t&&(r=Oi(r,t)),r}serializeFieldParam(e,t){return this.serializer?"attribute"===(null==t?void 0:t.kind)?this.serializer.resourceAttribute(null==t?void 0:t.type,e):"relationship"===(null==t?void 0:t.kind)?this.serializer.resourceRelationship(null==t?void 0:t.type,e):e:this.serializerFor($i.ResourceFieldParam).serialize(e,{type:null==t?void 0:t.type})}serializeRelationshipInPath(e,t){return this.serializer?this.serializer.resourceRelationship(e,t):this.serializerFor($i.ResourceFieldPath).serialize(t,{type:e})}}class ji{constructor(e){this.serializerFor=null==e?void 0:e.serializerFor,this.serializationOptions=null==e?void 0:e.serializationOptions,this.deserializationOptions=null==e?void 0:e.deserializationOptions}buildSerializationOptions(e){let t=this.serializationOptions;return t&&e?{...t,...e}:t||e||{}}buildDeserializationOptions(e){let t=this.deserializationOptions;return t&&e?{...t,...e}:t||e||{}}}class Si extends ji{serialize(e){return!!e}deserialize(e){return!!e}}class xi extends ji{serialize(e){return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}deserialize(e){const[t,r,i]=e.split("-");return new Date(parseInt(t),parseInt(r)-1,parseInt(i))}}class ki extends ji{serialize(e){return e.toISOString()}deserialize(e){let t=e.indexOf("+");return-1!==t&&e.length-5===t?(t+=3,new Date(e.slice(0,t)+":"+e.slice(t))):new Date(e)}}function Fi(e={},t){return r=>{if(e[r])return e[r];if(t)return t(r);throw new Error(`Inflection mapping for '${r}' does not exist.`)}}class Ti{serialize(e){return e}deserialize(e){return e}}class qi extends ji{serialize(e){return e}deserialize(e){return e}}function Pi(e){return e.replace(/(\-|\_|\.|\s)+(.)?/g,(function(e,t,r){return r?r.toUpperCase():""})).replace(/(^|\/)([A-Z])/g,(function(e){return e.toLowerCase()}))}const _i={camelize:Pi,dasherize:function(e){return function(e){return e.replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase()}(e).replace(/[ _]/g,"-")},underscore:function(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},pluralize:function(e){return e+"s"},singularize:function(e){return e.lastIndexOf("s")===e.length-1?e.substr(0,e.length-1):e}},Ei={camelize:null,dasherize:"camelize",underscore:"camelize",pluralize:"singularize",singularize:"pluralize"};class Ii extends ji{constructor(e){if(super(e),this.inflectors=(null==e?void 0:e.inflectors)||{},this.inverseInflectors=(null==e?void 0:e.inverseInflectors)||{},this.serializationOptions&&void 0===this.deserializationOptions){const{inflectors:e}=this.serializationOptions;this.deserializationOptions={inflectors:this.buildInverseInflectors(e)}}}serialize(e,t){const r=this.buildSerializationOptions(t),{inflectors:i}=r;let n=e;if(i)for(let e of i)n=this.applyInflector(e,n);return n}deserialize(e,t){const r=this.buildDeserializationOptions(t),{inflectors:i}=r;let n=e;if(i)for(let e of i)n=this.applyInflector(e,n);return n}buildInverseInflectors(e){if(e){const t=[];for(let r of e){let e;if("string"==typeof r&&(e=this.inverseInflectors[r]||Ei[r]),!e)return;t.unshift(e)}return t}}applyInflector(e,t){var r;let i;if("function"==typeof e)i=e;else if(i=null!==(r=this.inflectors[e])&&void 0!==r?r:_i[e],!i)throw new Error(`'StringSerializer does not recognize inflector '${e}'`);return i(t)}}function Mi(e){const t={},r=e.sharedSettings||{},i=e.settingsByType||{};return function(e){return t[e]||function(e){const n={...r,...i[e]||{}};return t[e]=n}(e)}}class Ni extends ji{constructor(e){const{serializerFor:t,serializationOptions:r,deserializationOptions:i,schema:n,keyMap:o}=e;super({serializerFor:t,serializationOptions:r,deserializationOptions:i}),this._schema=n,this._keyMap=o}get schema(){return this._schema}get keyMap(){return this._keyMap}get resourceSerializer(){return this.serializerFor($i.Resource)}get documentSerializer(){return this.serializerFor($i.ResourceDocument)}get identitySerializer(){return this.serializerFor($i.ResourceIdentity)}get typeSerializer(){return this.serializerFor($i.ResourceType)}get fieldSerializer(){return this.serializerFor($i.ResourceField)}get atomicOperationSerializer(){return this.serializerFor($i.ResourceAtomicOperation)}get atomicOperationsDocumentSerializer(){return this.serializerFor($i.ResourceAtomicOperationsDocument)}get atomicResultsDocumentSerializer(){return this.serializerFor($i.ResourceAtomicResultsDocument)}}class Ci extends Ni{serialize(e){switch(e.op){case"addRecord":return this.serializeAddRecordOperation(e);case"updateRecord":return this.serializeUpdateRecordOperation(e);case"removeRecord":return this.serializeRemoveRecordOperation(e);case"addToRelatedRecords":return this.serializeAddToRelatedRecordsOperation(e);case"removeFromRelatedRecords":return this.serializeRemoveFromRelatedRecordsOperation(e);case"replaceRelatedRecord":return this.serializeReplaceRelatedRecordOperation(e);case"replaceRelatedRecords":return this.serializeReplaceRelatedRecordsOperation(e);case"replaceAttribute":return this.serializeReplaceAttributeOperation(e);default:throw new Error(`JSONAPIOperationSerializer: Unrecognized operation ${e.op}.`)}}deserialize(e){if(function(e){return"add"===e.op}(e))return this.deserializeAddOperation(e);if(function(e){return"update"===e.op}(e))return this.deserializeUpdateOperation(e);if(function(e){return"remove"===e.op}(e))return this.deserializeRemoveOperation(e);throw new Error('JSONAPIOperationSerializer: Only "add", "update" and "remove" operations are supported at this time.')}serializeAddRecordOperation(e){return{op:"add",ref:this.identitySerializer.serialize(e.record),data:this.resourceSerializer.serialize(e.record)}}serializeUpdateRecordOperation(e){return{op:"update",ref:this.identitySerializer.serialize(e.record),data:this.resourceSerializer.serialize(e.record)}}serializeRemoveRecordOperation(e){return{op:"remove",ref:this.identitySerializer.serialize(e.record)}}serializeAddToRelatedRecordsOperation(e){const t=this.identitySerializer.serialize(e.record);return{op:"add",ref:{relationship:e.relationship,...t},data:this.identitySerializer.serialize(e.relatedRecord)}}serializeRemoveFromRelatedRecordsOperation(e){const t=this.identitySerializer.serialize(e.record);return{op:"remove",ref:{relationship:e.relationship,...t},data:this.identitySerializer.serialize(e.relatedRecord)}}serializeReplaceRelatedRecordsOperation(e){const t=this.identitySerializer.serialize(e.record);return{op:"update",ref:{relationship:e.relationship,...t},data:e.relatedRecords.map((e=>this.identitySerializer.serialize(e)))}}serializeReplaceRelatedRecordOperation(e){const t=this.identitySerializer.serialize(e.record);return{op:"update",ref:{relationship:e.relationship,...t},data:e.relatedRecord?this.identitySerializer.serialize(e.relatedRecord):null}}serializeReplaceAttributeOperation(e){const t=this.resourceSerializer.deserialize({id:e.record.id,type:e.record.type,attributes:{[e.attribute]:e.value}});return{op:"update",ref:{id:t.id,type:t.type},data:t}}deserializeAddOperation(e){return Di(e)?{op:"addToRelatedRecords",relationship:e.ref.relationship,record:this.identitySerializer.deserialize(e.ref),relatedRecord:this.identitySerializer.deserialize(e.data)}:{op:"addRecord",record:this.resourceSerializer.deserialize(e.data)}}deserializeUpdateOperation(e){return Di(e)?Array.isArray(e.data)?{op:"replaceRelatedRecords",relationship:e.ref.relationship,record:this.identitySerializer.deserialize(e.ref),relatedRecords:e.data.map((e=>this.identitySerializer.deserialize(e)))}:{op:"replaceRelatedRecord",relationship:e.ref.relationship,record:this.identitySerializer.deserialize(e.ref),relatedRecord:e.data?this.identitySerializer.deserialize(e.data):null}:{op:"updateRecord",record:this.resourceSerializer.deserialize(e.data)}}deserializeRemoveOperation(e){return Di(e)?{op:"removeFromRelatedRecords",relationship:e.ref.relationship,record:this.identitySerializer.deserialize(e.ref),relatedRecord:this.identitySerializer.deserialize(e.data)}:{op:"removeRecord",record:this.identitySerializer.deserialize(e.ref)}}}function Di(e){return!!e.ref.relationship}const{deprecate:Ui}=B;class Li extends Ni{serialize(e){const t=this.identitySerializer.serialize(e),r=this.schema.getModel(e.type);return this.serializeAttributes(t,e,r),this.serializeRelationships(t,e,r),this.serializeLinks(t,e,r),this.serializeMeta(t,e,r),t}deserialize(e,t){const r=this.buildDeserializationOptions(t);r.includeKeys=!0;const i=this.identitySerializer.deserialize(e,r),n=this.schema.getModel(i.type);return this.deserializeAttributes(i,e,n),this.deserializeRelationships(i,e,n),this.deserializeLinks(i,e,n),this.deserializeMeta(i,e,n),i}serializeAttributes(e,t,r){if(t.attributes)for(let i of Object.keys(t.attributes))this.serializeAttribute(e,t,i,r)}serializeAttribute(e,t,r,i){var n,o,s,a;const u=null===(n=t.attributes)||void 0===n?void 0:n[r];if(void 0===u)return;const c=null===(o=i.attributes)||void 0===o?void 0:o[r];if(void 0===c)return;let l;if(null===u)l=null;else{const e=null!==(s=c.type)&&void 0!==s?s:"unknown",i=this.serializerFor(e);if(!i)throw new k(`Serializer could not be found for attribute type '${e}'`);{const e=null!==(a=c.serialization)&&void 0!==a?a:c.serializationOptions;void 0!==c.serializationOptions&&Ui(`The attribute '${r}' for '${t.type}' has been assigned \`serializationOptions\` in the schema. Use \`serialization\` instead.`),l=i.serialize(u,e)}}M(e,["attributes",this.fieldSerializer.serialize(r,{type:t.type})],l)}serializeRelationships(e,t,r){if(t.relationships)for(let i of Object.keys(t.relationships))this.serializeRelationship(e,t,i,r)}serializeRelationship(e,t,r,i){var n,o;const s=null===(n=t.relationships)||void 0===n?void 0:n[r].data;if(void 0===s)return;if(void 0===(null===(o=i.relationships)||void 0===o?void 0:o[r]))return;let a;if(null===s)a=null;else{const e=this.identitySerializer;a=Array.isArray(s)?s.map((t=>e.serialize(t))):e.serialize(s)}M(e,["relationships",this.fieldSerializer.serialize(r,{type:t.type}),"data"],a)}serializeLinks(e,t,r){}serializeMeta(e,t,r){}deserializeAttributes(e,t,r){if(t.attributes)for(let i of Object.keys(t.attributes))this.deserializeAttribute(e,t,i,r)}deserializeAttribute(e,t,r,i){var n,o,s;const a=null===(n=t.attributes)||void 0===n?void 0:n[r];if(void 0===a)return;const u=this.fieldSerializer.deserialize(r,{type:e.type}),c=null===(o=i.attributes)||void 0===o?void 0:o[u];if(void 0===c)return;let l;if(null===a)l=null;else{const t=c.type||"unknown",r=this.serializerFor(t);if(!r)throw new k(`Serializer could not be found for attribute type '${t}'`);{const t=null!==(s=c.deserialization)&&void 0!==s?s:c.deserializationOptions;void 0!==c.deserializationOptions&&Ui(`The attribute '${u}' for '${e.type}' has been assigned \`deserializationOptions\` in the schema. Use \`deserialization\` instead.`),l=r.deserialize(a,t)}}M(e,["attributes",u],l)}deserializeRelationships(e,t,r){if(t.relationships)for(let i of Object.keys(t.relationships))this.deserializeRelationship(e,t,i,r)}deserializeRelationship(e,t,r,i){var n,o;const s=null===(n=t.relationships)||void 0===n?void 0:n[r];if(!s)return;const a=this.fieldSerializer.deserialize(r,{type:e.type});if(void 0===(null===(o=i.relationships)||void 0===o?void 0:o[a]))return;let u=s.data;if(void 0!==u){let t;if(null===u)t=null;else{const e=this.identitySerializer;t=Array.isArray(u)?u.map((t=>e.deserialize(t))):e.deserialize(u)}M(e,["relationships",a,"data"],t)}let{links:c,meta:l}=s;void 0!==c&&M(e,["relationships",a,"links"],c),void 0!==l&&M(e,["relationships",a,"meta"],l)}deserializeLinks(e,t,r){t.links&&(e.links=t.links)}deserializeMeta(e,t,r){t.meta&&(e.meta=t.meta)}}const{assert:Bi}=B;class Qi extends Ni{constructor(e){const{serializerFor:t,deserializationOptions:r,schema:i,keyMap:n,getResourceKey:o}=e;super({serializerFor:t,deserializationOptions:r,schema:i,keyMap:n}),this._resourceKeys={},this._getCustomResourceKey=o}getResourceKey(e){let t=this._resourceKeys[e];if(void 0===t){if(this._getCustomResourceKey&&(t=this._getCustomResourceKey(e)),void 0===t){const r=this.schema.getModel(e);if(null==r?void 0:r.keys){let e=Object.keys(r.keys);1===e.length&&(t=e[0])}void 0===t&&(t="id")}Bi("JSONAPIResourceIdentitySerializer requires a keyMap to support resource keys other than 'id'","id"===t||void 0!==this.keyMap),this._resourceKeys[e]=t}return t}serialize(e){const{type:t,id:r}=e,i=this.getResourceKey(t),n=this.typeSerializer.serialize(t),o="id"===i?r:this.keyMap.idToKey(t,i,r),s={type:n};return void 0!==o&&(s.id=o),s}deserialize(e,t){var r;const i=this.buildDeserializationOptions(t),n=this.typeSerializer.deserialize(e.type),o=this.getResourceKey(n);if("id"===o){const{id:t}=e;if(t)return{type:n,id:t};throw new k(`Resource of type '${n}' is missing 'id'`)}{const t=this.keyMap,s=null==i?void 0:i.primaryRecord;let a,u;e.id?(u={[o]:e.id},a=(null===(r=i.primaryRecord)||void 0===r?void 0:r.id)||t.idFromKeys(n,u)||this.schema.generateId(n)):(u=null,a=s&&s.id||this.schema.generateId(n));const c={type:n,id:a};return u&&(i.includeKeys?(c.keys=u,t.pushRecord(c)):t.pushRecord({type:n,id:a,keys:u})),c}}}class Ji extends Ni{serialize(e){let t={data:Array.isArray(e.data)?this.serializeRecords(e.data):this.serializeRecord(e.data)};return this.serializeLinks(e,t),this.serializeMeta(e,t),t}deserialize(e,t){const r=this.buildSerializationOptions(t);let i,n=e.data;i=Array.isArray(n)?this.deserializeResources(n,null==r?void 0:r.primaryRecords):null!==n?this.deserializeResource(n,null==r?void 0:r.primaryRecord):null;let o={data:i};return e.included&&(o.included=e.included.map((e=>this.deserializeResource(e)))),this.deserializeLinks(e,o),this.deserializeMeta(e,o),o}serializeRecords(e){return e.map((e=>this.serializeRecord(e)))}serializeRecord(e){return this.resourceSerializer.serialize(e)}serializeLinks(e,t){}serializeMeta(e,t){}deserializeResources(e,t){return e.map(t?(e,r)=>this.deserializeResource(e,t[r]):e=>this.deserializeResource(e))}deserializeResource(e,t){return t?this.resourceSerializer.deserialize(e,{primaryRecord:t}):this.resourceSerializer.deserialize(e)}deserializeLinks(e,t){e.links&&(t.links=e.links)}deserializeMeta(e,t){e.meta&&(t.meta=e.meta)}}class Hi extends Ii{serialize(e,t){return super.serialize(e,t)}deserialize(e,t){return super.deserialize(e,t)}}const{assert:Ki,deprecate:Vi}=B;class Zi{constructor(e){let{sourceName:t,allowedContentTypes:r,schema:i,keyMap:n,SerializerClass:o,serializerFor:s,serializerClassFor:a,serializerSettingsFor:u}=e;this.sourceName=t,this.allowedContentTypes=r||["application/vnd.api+json","application/json"],this.schema=i,this.keyMap=n,o&&(Vi("The 'SerializerClass' setting for 'JSONAPIRequestProcessor' has been deprecated. Pass 'serializerFor', 'serializerClassFor', and/or 'serializerSettingsFor' instead."),this._serializer=new o({schema:i,keyMap:n})),this._serializerFor=function(e){const{schema:t,keyMap:r}=e,i=function(e={}){return t=>e[t]}({unknown:Ti,object:Ti,array:Ti,boolean:Si,string:Ii,date:xi,datetime:ki,number:qi,[$i.Resource]:Li,[$i.ResourceDocument]:Ji,[$i.ResourceIdentity]:Qi,[$i.ResourceAtomicOperation]:Ci,[$i.ResourceType]:Ii,[$i.ResourceTypeParam]:Ii,[$i.ResourceTypePath]:Ii,[$i.ResourceField]:Hi,[$i.ResourceFieldParam]:Hi,[$i.ResourceFieldPath]:Hi});let n,o;n=e.serializerClassFor?(t="unknown")=>e.serializerClassFor(t)||i(t):i;let s=Mi({sharedSettings:{keyMap:r,schema:t},settingsByType:{[$i.ResourceTypePath]:{serializationOptions:{inflectors:["pluralize","dasherize"]}},[$i.ResourceFieldPath]:{serializationOptions:{inflectors:["dasherize"]}}}}),a=e.serializerSettingsFor;o=a?(e="unknown")=>E(s(e)||{},a(e)||{}):s;let u=e.serializerFor,c=function(e){var t;const r={...null!==(t=e.serializers)&&void 0!==t?t:{}},i=e.serializerClassFor,n=e.serializerSettingsFor;return function e(t){var o;return null!==(o=r[t])&&void 0!==o?o:function(t){const o=i&&i(t);if(o){const i=n&&n(t)||{};return i.serializerFor=e,r[t]=new o(i)}}(t)}}({serializerClassFor:n,serializerSettingsFor:o});return u?(e="unknown")=>u(e)||c(e):(e="unknown")=>c(e)}({schema:i,keyMap:n,serializerFor:s,serializerClassFor:a,serializerSettingsFor:u}),this.urlBuilder=new(e.URLBuilderClass||Ai)({host:e.host,namespace:e.namespace,keyMap:e.keyMap,serializer:this._serializer,serializerFor:this._serializerFor}),this.initDefaultFetchSettings(e)}get serializer(){return Vi("'JSONAPIRequestProcessor#serializer' has been deprecated. Use 'serializerFor' instead."),this._serializer?this._serializer:this._serializerFor($i.ResourceDocument)}get serializerFor(){return this._serializerFor}fetch(e,t){let r=this.initFetchSettings(t),i=e;r.params&&(i=this.urlBuilder.appendQueryParams(i,r.params),delete r.params);let n=B.fetch||B.globals.fetch;if(void 0!==r.timeout&&r.timeout>0){let e=r.timeout;return delete r.timeout,new Promise(((t,o)=>{let s,a=B.globals.setTimeout((()=>{s=!0,o(new Ri(`No fetch response within ${e}ms.`))}),e);n(i,r).catch((e=>{if(B.globals.clearTimeout(a),!s)return this.handleFetchError(e)})).then((e=>{if(B.globals.clearTimeout(a),!s)return this.handleFetchResponse(e)})).then(t,o)}))}return n(i,r).catch((e=>this.handleFetchError(e))).then((e=>this.handleFetchResponse(e)))}initFetchSettings(e={}){let t=E({},this.defaultFetchSettings,e);return t.json&&(Ki("`json` and `body` can't both be set for fetch requests.",!t.body),t.body=JSON.stringify(t.json),delete t.json),t.headers&&!t.body&&delete t.headers["Content-Type"],t}operationsFromDeserializedDocument(e){const t=[];return Array.prototype.push.apply(t,q(e.data)),e.included&&Array.prototype.push.apply(t,e.included),t.map((e=>({op:"updateRecord",record:e})))}buildFetchSettings(e){var t;const r={params:{},...null===(t=e.options)||void 0===t?void 0:t.settings};if(e.options){const{filter:t,sort:i,page:n,include:o,fields:s}=e.options;t&&(r.params.filter=this.urlBuilder.buildFilterParam(t,e)),i&&(r.params.sort=this.urlBuilder.buildSortParam(i,e)),n&&(r.params.page=this.urlBuilder.buildPageParam(n,e)),o&&(r.params.include=this.urlBuilder.buildIncludeParam(o,e)),s&&(r.params.fields=this.urlBuilder.buildFieldsParam(s,e))}return r}mergeRequestOptions(e){return ae(e,this.sourceName)}customRequestOptions(e,t){return Vi("'JSONAPIRequestProcessor#customRequestOptions' has been deprecated. Use 'mergeRequestOptions' instead."),this.mergeRequestOptions([e.options,t.options])}preprocessResponseDocument(e,t){}responseHasContent(e,t){let r=e.headers.get("Content-Type");if(r){for(let e of this.allowedContentTypes)if(r.indexOf(e)>-1)return!0;if(!t)throw new bi(`The server responded with the content type '${r}', which is not allowed. Allowed content types include: '${this.allowedContentTypes.join("', '")}'.`)}return!1}initDefaultFetchSettings(e){this.defaultFetchSettings={headers:{Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"},timeout:5e3},e.defaultFetchSettings&&E(this.defaultFetchSettings,e.defaultFetchSettings)}async handleFetchResponse(e){const t={response:e};if(e.status>=200&&e.status<300)204!==e.status&&this.responseHasContent(e)&&(t.document=await e.json());else if(304!==e.status&&404!==e.status)if(this.responseHasContent(e,!0)){const t=await e.json();await this.handleFetchResponseError(e,t)}else await this.handleFetchResponseError(e);return t}async handleFetchResponseError(e,t){let r;throw r=e.status>=400&&e.status<500?new yi(e.statusText):new mi(e.statusText),r.response=e,r.data=t,r}async handleFetchError(e){throw"string"==typeof e?new Ri(e):e}}const Gi={findRecord:e=>({op:"findRecord",record:$e(e.record)}),findRecords(e){const t=e,{filter:r,sort:i,page:n}=t;return{op:"findRecords",type:t.type,options:{filter:r,sort:i,page:n}}},findRelatedRecord(e){const t=e;return{op:"findRelatedRecord",record:$e(t.record),relationship:t.relationship}},findRelatedRecords(e){const t=e,{filter:r,sort:i,page:n}=t;return{op:"findRelatedRecords",record:$e(t.record),relationship:t.relationship,options:{filter:r,sort:i,page:n}}}},Wi={async findRecord(e,t){var r,i,n;const{record:o}=t,s=e.buildFetchSettings(t),a=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceURL(o.type,o.id),u=await e.fetch(a,s),{document:c}=u;if(e.preprocessResponseDocument(c,t),c){const t=e.serializerFor($i.ResourceDocument).deserialize(c);return{transforms:[he(e.operationsFromDeserializedDocument(t))],data:t.data,details:u}}if(null===(n=t.options)||void 0===n?void 0:n.raiseNotFoundExceptions)throw new Je(o.type,o.id);return{transforms:[]}},async findRecords(e,t){var r,i;const{type:n}=t,o=e.buildFetchSettings(t),s=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceURL(n),a=await e.fetch(s,o),{document:u}=a;if(e.preprocessResponseDocument(u,t),u){const t=e.serializerFor($i.ResourceDocument).deserialize(u);return{transforms:[he(e.operationsFromDeserializedDocument(t))],data:t.data,details:a}}return{transforms:[]}},async findRelatedRecord(e,t){var r,i,n;const{record:o,relationship:s}=t,a=e.buildFetchSettings(t),u=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.relatedResourceURL(o.type,o.id,s),c=await e.fetch(u,a),{document:l}=c;if(e.preprocessResponseDocument(l,t),l){const t=e.serializerFor($i.ResourceDocument).deserialize(l),r=t.data,i=e.operationsFromDeserializedDocument(t);return i.push({op:"replaceRelatedRecord",record:o,relationship:s,relatedRecord:r}),{transforms:[he(i)],data:r,details:c}}if(null===(n=t.options)||void 0===n?void 0:n.raiseNotFoundExceptions)throw new Je(o.type,o.id);return{transforms:[]}},async findRelatedRecords(e,t){var r,i,n,o,s,a,u,c,l;const{record:d,relationship:h}=t,f=e.buildFetchSettings(t),v=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.relatedResourceURL(d.type,d.id,h),p=await e.fetch(v,f),{document:y}=p;if(e.preprocessResponseDocument(y,t),y){const r=e.serializerFor($i.ResourceDocument).deserialize(y),i=r.data,l=e.operationsFromDeserializedDocument(r);if(null!==(o=null===(n=t.options)||void 0===n?void 0:n.partialSet)&&void 0!==o?o:(null===(s=t.options)||void 0===s?void 0:s.filter)||(null===(a=t.options)||void 0===a?void 0:a.page)||(null===(u=r.links)||void 0===u?void 0:u.next)||(null===(c=r.links)||void 0===c?void 0:c.prev))for(let e of i)l.push({op:"addToRelatedRecords",record:d,relationship:h,relatedRecord:e});else l.push({op:"replaceRelatedRecords",record:d,relationship:h,relatedRecords:i});return{transforms:[he(l)],data:i,details:p}}if(null===(l=t.options)||void 0===l?void 0:l.raiseNotFoundExceptions)throw new Je(d.type,d.id);return{transforms:[]}}},Xi={async addRecord(e,t){var r,i;const{record:n}=t,o=e.serializerFor($i.ResourceDocument),s=o.serialize({data:n}),a={...e.buildFetchSettings(t),method:"POST",json:s},u=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceURL(n.type),c=await e.fetch(u,a),l=c.document;return e.preprocessResponseDocument(l,t),tn(n,o.deserialize(l,{primaryRecord:n}),c)},async removeRecord(e,t){var r,i;const{record:n}=t,{type:o,id:s}=n,a={...e.buildFetchSettings(t),method:"DELETE"},u=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceURL(o,s);return{transforms:[],data:n,details:await e.fetch(u,a)}},async updateRecord(e,t){var r,i;const{record:n}=t,{type:o,id:s}=n,a=e.serializerFor($i.ResourceDocument),u=a.serialize({data:n}),c={...e.buildFetchSettings(t),method:"PATCH",json:u},l=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceURL(o,s),d=await e.fetch(l,c),{document:h}=d;return h?(e.preprocessResponseDocument(h,t),tn(n,a.deserialize(h,{primaryRecord:n}),d)):{transforms:[],data:n,details:d}},async addToRelatedRecords(e,t){var r,i;const{relationship:n,record:o,relatedRecords:s}=t,{type:a,id:u}=o,c=e.serializerFor($i.ResourceIdentity),l={data:s.map((e=>c.serialize(e)))},d={...e.buildFetchSettings(t),method:"POST",json:l},h=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceRelationshipURL(a,u,n);return{transforms:[],data:o,details:await e.fetch(h,d)}},async removeFromRelatedRecords(e,t){var r,i;const{relationship:n,record:o,relatedRecords:s}=t,{type:a,id:u}=o,c=e.serializerFor($i.ResourceIdentity),l={data:s.map((e=>c.serialize(e)))},d={...e.buildFetchSettings(t),method:"DELETE",json:l},h=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceRelationshipURL(a,u,n);return{transforms:[],data:o,details:await e.fetch(h,d)}},async replaceRelatedRecord(e,t){var r,i;const{relationship:n,relatedRecord:o,record:s}=t,{type:a,id:u}=s,c=e.serializerFor($i.ResourceIdentity),l={data:o?c.serialize(o):null},d={...e.buildFetchSettings(t),method:"PATCH",json:l},h=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceRelationshipURL(a,u,n);return{transforms:[],data:s,details:await e.fetch(h,d)}},async replaceRelatedRecords(e,t){var r,i;const{relationship:n,relatedRecords:o,record:s}=t,{type:a,id:u}=s,c=e.serializerFor($i.ResourceIdentity),l={data:o.map((e=>c.serialize(e)))},d={...e.buildFetchSettings(t),method:"PATCH",json:l},h=null!==(i=null===(r=t.options)||void 0===r?void 0:r.url)&&void 0!==i?i:e.urlBuilder.resourceRelationshipURL(a,u,n);return{transforms:[],data:s,details:await e.fetch(h,d)}}},Yi={addRecord:e=>({op:"addRecord",record:T(e.record)}),removeRecord:e=>({op:"removeRecord",record:$e(e.record)}),replaceAttribute(e){const t=e,r=$e(t.record);return en(r,t.attribute,t.value),{op:"updateRecord",record:r}},updateRecord:e=>({op:"updateRecord",record:T(e.record)}),addToRelatedRecords(e){const{record:t,relationship:r,relatedRecord:i}=e;return{op:"addToRelatedRecords",record:$e(t),relationship:r,relatedRecords:[$e(i)]}},removeFromRelatedRecords(e){const{record:t,relationship:r,relatedRecord:i}=e;return{op:"removeFromRelatedRecords",record:$e(t),relationship:r,relatedRecords:[$e(i)]}},replaceRelatedRecord(e){const t=$e(e.record),{relationship:r,relatedRecord:i}=e;return M(t,["relationships",r,"data"],i),{op:"updateRecord",record:t}},replaceRelatedRecords(e){const t=$e(e.record),{relationship:r,relatedRecords:i}=e;return M(t,["relationships",r,"data"],i),{op:"updateRecord",record:t}}};function en(e,t,r){M(e,["attributes",t],r)}function tn(e,t,r){let i=t.data,n=[],o=function(e,t){var r;const i=[];if(e&&t){let n=!1;const o=$e(e),s={...o};for(let i in t)if("id"!==i&&"type"!==i){let o,a;switch(i){case"attributes":case"keys":case"relationships":for(let u in t[i])o=null===(r=e[i])||void 0===r?void 0:r[u],a=t[i][u],F(o,a)||("relationships"===i&&(n=!0),M(s,[i,u],a));break;default:o=e[i],a=t[i],F(a,o)||(s[i]=a,n=!0)}}if(n)i.push({op:"updateRecord",record:s});else{if(s.attributes)for(let e in s.attributes)i.push({op:"replaceAttribute",record:o,attribute:e,value:s.attributes[e]});if(s.keys)for(let e in s.keys)i.push({op:"replaceKey",record:o,key:e,value:s.keys[e]})}}return i}(e,i);if(o.length>0&&n.push(he(o)),t.included&&t.included.length>0){let e=t.included.map((e=>({op:"updateRecord",record:e})));n.push(he(e))}return{transforms:n,data:i,details:r}}const{deprecate:rn}=B;let nn=class extends Tt{constructor(e){e.name=e.name||"jsonapi",super(e);let{name:t,maxRequestsPerTransform:r,maxRequestsPerQuery:i,namespace:n,host:o,defaultFetchSettings:s,allowedContentTypes:a,serializerFor:u,serializerClassFor:c,serializerSettingsFor:l,SerializerClass:d,RequestProcessorClass:h,URLBuilderClass:f,keyMap:v}=e;if(void 0===this.schema)throw new k("JSONAPISource's `schema` must be specified in the  `settings` passed to its constructor");void 0===this._defaultQueryOptions&&(this._defaultQueryOptions={}),void 0===this._defaultTransformOptions&&(this._defaultTransformOptions={}),void 0===this._defaultQueryOptions.parallelRequests&&(this._defaultQueryOptions.parallelRequests=!0),void 0!==r&&(rn("The 'maxRequestsPerTransform' setting for 'JSONAPSource' has been deprecated in favor of 'defaultTransformOptions.maxRequests'."),this._defaultTransformOptions.maxRequests=r),void 0!==i&&(rn("The 'maxRequestsPerQuery' setting for 'JSONAPSource' has been deprecated in favor of 'defaultQueryOptions.maxRequests'."),this._defaultQueryOptions.maxRequests=i),h=h||Zi,this.requestProcessor=new h({sourceName:t,serializerFor:u,serializerClassFor:c,serializerSettingsFor:l,SerializerClass:d,URLBuilderClass:f||Ai,allowedContentTypes:a,defaultFetchSettings:s,namespace:n,host:o,schema:this.schema,keyMap:v})}get maxRequestsPerTransform(){var e;return rn("The 'maxRequestsPerTransform' property for 'JSONAPSource' has been deprecated in favor of 'defaultTransformOptions.maxRequests'."),null===(e=this._defaultTransformOptions)||void 0===e?void 0:e.maxRequests}set maxRequestsPerTransform(e){rn("The 'maxRequestsPerTransform' property for 'JSONAPSource' has been deprecated in favor of 'defaultTransformOptions.maxRequests'."),void 0===this._defaultTransformOptions&&(this._defaultTransformOptions={}),this._defaultTransformOptions.maxRequests=e}get maxRequestsPerQuery(){var e;return rn("The 'maxRequestsPerQuery' property for 'JSONAPSource' has been deprecated in favor of 'defaultQueryOptions.maxRequests'."),null===(e=this._defaultQueryOptions)||void 0===e?void 0:e.maxRequests}set maxRequestsPerQuery(e){rn("The 'maxRequestsPerQuery' property for 'JSONAPSource' has been deprecated in favor of 'defaultQueryOptions.maxRequests'."),void 0===this._defaultQueryOptions&&(this._defaultQueryOptions={}),this._defaultQueryOptions.maxRequests=e}async _push(e){if(this.transformLog.contains(e.id))return{};const t=await this.processTransformRequests(e),r=[],i=[];for(let e of t)e.transforms&&Array.prototype.push.apply(i,e.transforms),e.details&&r.push(e.details);return{transforms:[e,...i],details:r}}async _pull(e){const t=await this.processQueryRequests(e),r=[],i=[];for(let e of t)e.transforms&&Array.prototype.push.apply(i,e.transforms),e.details&&r.push(e.details);return{transforms:i,details:r}}async _query(e){const t=await this.processQueryRequests(e),r=[],i=[],n=[];for(let e of t)e.transforms&&Array.prototype.push.apply(i,e.transforms),e.details&&r.push(e.details),n.push(e.data);return{data:Array.isArray(e.expressions)?n:n[0],details:r,transforms:i}}async _update(e){if(this.transformLog.contains(e.id))return{};const t=await this.processTransformRequests(e),r=[],i=[],n=[];for(let e of t)e.transforms&&Array.prototype.push.apply(i,e.transforms),e.details&&r.push(e.details),n.push(e.data);return{data:Array.isArray(e.operations)?n:n[0],details:r,transforms:[e,...i]}}getQueryRequestProcessor(e){return Wi[e.op]}getTransformRequestProcessor(e){return Xi[e.op]}async processQueryRequests(e){const t=this.getQueryOptions(e),r=function(e,t){const r=[];for(let i of q(t.expressions)){const n=Gi[i.op](i,e),o=e.mergeRequestOptions([n.options,t.options,i.options]);o&&(n.options=o),r.push(n)}return r}(this.requestProcessor,e);if(void 0!==(null==t?void 0:t.maxRequests)&&r.length>t.maxRequests)throw new re(`This query requires ${r.length} requests, which exceeds the specified limit of ${t.maxRequests} requests per query.`,e);if(null==t?void 0:t.parallelRequests)return Promise.all(r.map((e=>this.getQueryRequestProcessor(e)(this.requestProcessor,e))));{const e=[];for(let t of r){const r=this.getQueryRequestProcessor(t);e.push(await r(this.requestProcessor,t))}return e}}async processTransformRequests(e){const t=this.getTransformOptions(e),r=function(e,t){const r=[];let i=null;for(let o of q(t.operations)){let s,a=!0;if(i&&ze(i.record,o.record)&&("removeRecord"===o.op?(a=!1,"removeRecord"!==i.op&&(i=null,r.pop())):"addRecord"===i.op||"updateRecord"===i.op?"replaceAttribute"===o.op?(a=!1,en(i.record,o.attribute,o.value)):"replaceRelatedRecord"===o.op?(a=!1,M(i.record,["relationships",o.relationship,"data"],(n=o.relatedRecord)?$e(n):null)):"replaceRelatedRecords"===o.op&&(a=!1,M(i.record,["relationships",o.relationship,"data"],o.relatedRecords.map((e=>$e(e))))):("addToRelatedRecords"===i.op&&"addToRelatedRecords"===o.op&&i.relationship===o.relationship||"removeFromRelatedRecords"===i.op&&"removeFromRelatedRecords"===o.op&&i.relationship===o.relationship)&&(a=!1,i.relatedRecords.push($e(o.relatedRecord)))),a&&(s=Yi[o.op](o)),s){const n=e.mergeRequestOptions([s.options,t.options,o.options]);n&&(s.options=n),r.push(s),i=s}}var n;return r}(this.requestProcessor,e);if(void 0!==(null==t?void 0:t.maxRequests)&&r.length>t.maxRequests)throw new ie(`This transform requires ${r.length} requests, which exceeds the specified limit of ${t.maxRequests} requests per transform.`,e);if(null==t?void 0:t.parallelRequests)return Promise.all(r.map((e=>this.getTransformRequestProcessor(e)(this.requestProcessor,e))));{const e=[];for(let t of r){const r=this.getTransformRequestProcessor(t);e.push(await r(this.requestProcessor,t))}return e}}};nn=function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s}([function(e){let t=e.prototype;t.__pullable__||(ve("Pullable interface can only be applied to a Source",t instanceof de),t.__pullable__=!0,t.pull=async function(e,t,r){pe("'pull' has been deprecated. Please use 'query' instead and create your own transform from the results."),await this.activated;const i=oe(e,t,r,this.queryBuilder),n=await this._requestQueue.push({type:"pull",data:i});return(null==t?void 0:t.fullResponse)?n:n.transforms||[]},t.__pull__=async function(e){var t;try{const r={},i=await V(this,"beforePull",e,r),n=await this._pull(e,r);return i.length>0&&(n.sources=ce(i)),(null===(t=n.transforms)||void 0===t?void 0:t.length)>0&&await this.transformed(n.transforms),await K(this,"pull",e,n),n}catch(t){throw await K(this,"pullFail",e,t),t}})},function(e){let t=e.prototype;t.__pushable__||(ye("Pushable interface can only be applied to a Source",t instanceof de),t.__pushable__=!0,t.push=async function(e,t,r){me("'push' has been deprecated. Please use 'update' instead and specify '{ fullResponse: true }' to access the resultant 'transforms'."),await this.activated;const i=he(e,t,r,this.transformBuilder);if(this.transformLog.contains(i.id)){const e=[];return(null==t?void 0:t.fullResponse)?{transforms:e}:e}{const e=await this._requestQueue.push({type:"push",data:i});return(null==t?void 0:t.fullResponse)?e:e.transforms||[]}},t.__push__=async function(e){var t;if(this.transformLog.contains(e.id))return{transforms:[]};try{const r={},i=await V(this,"beforePush",e,r),n=await this._push(e,r);return i.length>0&&(n.sources=ce(i)),(null===(t=n.transforms)||void 0===t?void 0:t.length)>0&&await this.transformed(n.transforms),await K(this,"push",e,n),n}catch(t){throw await K(this,"pushFail",e,t),t}})},be,Oe],nn);const on="https://gmail-clone.com/api",{assert:sn}=B;var an;!function(e){e[e.None=0]="None",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.Info=3]="Info"}(an||(an={}));class un{constructor(e={}){this._sources={},this._strategies={},e.sources&&e.sources.forEach((e=>this.addSource(e))),e.strategies&&e.strategies.forEach((e=>this.addStrategy(e))),this._defaultActivationOptions=e.defaultActivationOptions||{},void 0===this._defaultActivationOptions.logLevel&&(this._defaultActivationOptions.logLevel=an.Info)}addSource(e){const t=e.name;t?(sn(`A source named '${t}' has already been added to this coordinator.`,!this._sources[t]),sn("A coordinator's sources can not be changed while it is active.",!this._activated),this._sources[t]=e):sn("Sources require a 'name' to be added to a coordinator.",!!t)}removeSource(e){sn(`Source '${e}' has not been added to this coordinator.`,!!this._sources[e]),sn("A coordinator's sources can not be changed while it is active.",!this._activated),delete this._sources[e]}getSource(e){return this._sources[e]}get sources(){return N(this._sources)}get sourceNames(){return Object.keys(this._sources)}addStrategy(e){const t=e.name;sn(`A strategy named '${t}' has already been added to this coordinator.`,!this._strategies[t]),sn("A coordinator's strategies can not be changed while it is active.",!this._activated),this._strategies[t]=e}removeStrategy(e){sn(`Strategy '${e}' has not been added to this coordinator.`,!!this._strategies[e]),sn("A coordinator's strategies can not be changed while it is active.",!this._activated),delete this._strategies[e]}getStrategy(e){return this._strategies[e]}get strategies(){return N(this._strategies)}get strategyNames(){return Object.keys(this._strategies)}get activated(){return this._activated}async activate(e={}){this._activated||(this._activated=this._activate(e)),await this._activated}async deactivate(){this._activated&&(await this._activated,await this._deactivate()),this._activated=void 0}async _activate(e={}){void 0===e.logLevel&&(e.logLevel=this._defaultActivationOptions.logLevel),this._currentActivationOptions=e;for(let t of this.strategies)await t.activate(this,e);for(let e of this.strategies)await e.beforeSourceActivation();for(let e of this.sources)await e.activate();for(let e of this.strategies)await e.afterSourceActivation()}async _deactivate(){const e=this.strategies.reverse(),t=this.sources.reverse();for(let t of e)await t.beforeSourceDeactivation();for(let e of t)await e.deactivate();for(let t of e)await t.afterSourceDeactivation();for(let t of e)await t.deactivate()}}const{assert:cn}=B,{assert:ln}=B;class dn extends class{constructor(e={}){this._sources=[],e.name?this._name=e.name:cn("Strategy requires a name",!1),this._sourceNames=e.sources,this._logPrefix=e.logPrefix||`[${this._name}]`,this._logLevel=this._customLogLevel=e.logLevel}async activate(e,t={}){this._coordinator=e,void 0===this._customLogLevel&&(this._logLevel=t.logLevel),this._sources=this._sourceNames?this._sourceNames.map((t=>e.getSource(t))):e.sources}async deactivate(){this._coordinator=void 0}async beforeSourceActivation(){}async afterSourceActivation(){}async beforeSourceDeactivation(){}async afterSourceDeactivation(){}get name(){return this._name}get coordinator(){return this._coordinator}get sources(){return this._sources}get logPrefix(){return this._logPrefix}get logLevel(){return this._logLevel}getSourceName(e){if(e.name)return e.name;throw new k("Sources require a 'name' to be used by a coordination strategy.")}}{constructor(e){ln("A `source` must be specified for a ConnectionStrategy",!!e.source),ln("`source` should be a Source name specified as a string","string"==typeof e.source),ln("`on` should be specified as the name of the event a ConnectionStrategy listens for","string"==typeof e.on),e.sources=[e.source];let t=`${e.source}:${e.on}`;delete e.source,e.target&&(ln("`target` should be a Source name specified as a string","string"==typeof e.target),e.sources.push(e.target),t+=` -> ${e.target}`,"string"==typeof e.action&&(t+=`:${e.action}`),delete e.target),e.name=e.name||t,super(e),this._event=e.on,this._action=e.action,this._catch=e.catch,this._filter=e.filter,this._blocking="function"==typeof e.blocking?e.blocking:!!e.blocking}get source(){return this._sources[0]}get target(){return this._sources[1]}get blocking(){return this._blocking}async activate(e,t={}){await super.activate(e,t),this._listener=this.generateListener(),this.source.on(this._event,this._listener)}async deactivate(){await super.deactivate(),this.source.off(this._event,this._listener),this._listener=void 0}generateListener(){return(...e)=>this.defaultListener(...e)}async defaultListener(...e){if(this._filter&&!this._filter.apply(this,e))return;let t=this.invokeAction(...e);if(this._catch&&t&&t.catch&&(t=t.catch((t=>this._catch.apply(this,[t,...e])))),t){let r=!1;if("function"==typeof this._blocking?this._blocking(...e)&&(r=!0):this._blocking&&(r=!0),r)return this.handleBlockingResponse(t,...e)}}invokeAction(...e){return"string"==typeof this._action?this.target[this._action](...e):this._action.apply(this,e)}async handleBlockingResponse(e,...t){await e}}class hn extends dn{constructor(e){super(e),this.passHints=!!e.passHints}invokeAction(e){return"string"==typeof this._action?this.target[this._action](e,{fullResponse:!0}):super.invokeAction(...arguments)}async handleBlockingResponse(e,t,r){const i=await e;return this.passHints&&r&&this.assignHints(r,i),[this.target.name,i]}assignHints(e,t){void 0!==t.data&&(e.data=t.data),void 0!==t.details&&(e.details=t.details)}}const{assert:fn}=B;class vn extends dn{constructor(e){let t=e;fn("A `source` must be specified for a SyncStrategy",!!t.source),fn("A `target` must be specified for a SyncStrategy",!!t.target),fn("`source` should be a Source name specified as a string","string"==typeof t.source),fn("`target` should be a Source name specified as a string","string"==typeof t.target),t.on=t.on||"transform",t.action=t.action||"sync",super(t)}}const pn={async activate(){const e=new un({sources:[mn,Rn]});e.addStrategy(new hn({source:"memory",on:"beforeQuery",target:"remote",action:"query",blocking:e=>{const t=mn.cache.query(e);return!t||!(!Array.isArray(t)||t.length)}})),e.addStrategy(new hn({source:"memory",on:"beforeUpdate",target:"remote",action:"update",blocking:!1})),e.addStrategy(new vn({source:"remote",target:"memory",blocking:!1})),await e.activate({logLevel:an.Info}).then((()=>{console.log("Coordinator will be chatty")}))}},yn=new wt({models:{mail:{attributes:{from:{type:"string"},fromEmail:{type:"string"},subject:{type:"string"},text:{type:"string"},datetime:{type:"string"},starred:{type:"boolean"}}}}}),mn=new pi({schema:yn}),Rn=new nn({schema:yn,name:"remote",host:on,serializerSettingsFor:Mi({sharedSettings:{inflectors:{pluralize:Fi({person:"people"},(e=>`${e}s`)),singularize:Fi({people:"person"},(e=>e.substring(0,e.length-1)))}},settingsByType:{[$i.ResourceType]:{serializationOptions:{inflectors:["pluralize"]}}}})}),bn=mn;var wn=function(e,t){return function(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];return e.apply(t,r)}},gn=Object.prototype.toString;function On(e){return Array.isArray(e)}function $n(e){return void 0===e}function zn(e){return"[object ArrayBuffer]"===gn.call(e)}function An(e){return null!==e&&"object"==typeof e}function jn(e){if("[object Object]"!==gn.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function Sn(e){return"[object Function]"===gn.call(e)}function xn(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),On(e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}var kn={isArray:On,isArrayBuffer:zn,isBuffer:function(e){return null!==e&&!$n(e)&&null!==e.constructor&&!$n(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===gn.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&zn(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:An,isPlainObject:jn,isUndefined:$n,isDate:function(e){return"[object Date]"===gn.call(e)},isFile:function(e){return"[object File]"===gn.call(e)},isBlob:function(e){return"[object Blob]"===gn.call(e)},isFunction:Sn,isStream:function(e){return An(e)&&Sn(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===gn.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:xn,merge:function e(){var t={};function r(r,i){t[i]=jn(t[i])&&jn(r)?e(t[i],r):jn(r)?e({},r):On(r)?r.slice():r}for(var i=0,n=arguments.length;i<n;i++)xn(arguments[i],r);return t},extend:function(e,t,r){return xn(t,(function(t,i){e[i]=r&&"function"==typeof t?wn(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function Fn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Tn=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(kn.isURLSearchParams(t))i=t.toString();else{var n=[];kn.forEach(t,(function(e,t){null!=e&&(kn.isArray(e)?t+="[]":e=[e],kn.forEach(e,(function(e){kn.isDate(e)?e=e.toISOString():kn.isObject(e)&&(e=JSON.stringify(e)),n.push(Fn(t)+"="+Fn(e))})))})),i=n.join("&")}if(i){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e};function qn(){this.handlers=[]}qn.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},qn.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},qn.prototype.forEach=function(e){kn.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var Pn=qn,_n=function(e,t){kn.forEach(e,(function(r,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[i])}))},En=function(e,t,r,i,n){return e.config=t,r&&(e.code=r),e.request=i,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e},In=function(e,t,r,i,n){var o=new Error(e);return En(o,t,r,i,n)},Mn=kn.isStandardBrowserEnv()?{write:function(e,t,r,i,n,o){var s=[];s.push(e+"="+encodeURIComponent(t)),kn.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),kn.isString(i)&&s.push("path="+i),kn.isString(n)&&s.push("domain="+n),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Nn=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Cn=kn.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var i=e;return t&&(r.setAttribute("href",i),i=r.href),r.setAttribute("href",i),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=kn.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0};function Dn(e){this.message=e}Dn.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Dn.prototype.__CANCEL__=!0;var Un=Dn,Ln={"Content-Type":"application/x-www-form-urlencoded"};function Bn(e,t){!kn.isUndefined(e)&&kn.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Qn,Jn={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Qn=function(e){return new Promise((function(t,r){var i,n=e.data,o=e.headers,s=e.responseType;function a(){e.cancelToken&&e.cancelToken.unsubscribe(i),e.signal&&e.signal.removeEventListener("abort",i)}kn.isFormData(n)&&delete o["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var c=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(c+":"+l)}var d,h,f=(h=e.url,(d=e.baseURL)&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(d,h):h);function v(){if(u){var i,n,o,c,l,d="getAllResponseHeaders"in u?(i=u.getAllResponseHeaders(),l={},i?(kn.forEach(i.split("\n"),(function(e){if(c=e.indexOf(":"),n=kn.trim(e.substr(0,c)).toLowerCase(),o=kn.trim(e.substr(c+1)),n){if(l[n]&&Nn.indexOf(n)>=0)return;l[n]="set-cookie"===n?(l[n]?l[n]:[]).concat([o]):l[n]?l[n]+", "+o:o}})),l):l):null;!function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(In("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}((function(e){t(e),a()}),(function(e){r(e),a()}),{data:s&&"text"!==s&&"json"!==s?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:d,config:e,request:u}),u=null}}if(u.open(e.method.toUpperCase(),Tn(f,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=v:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(v)},u.onabort=function(){u&&(r(In("Request aborted",e,"ECONNABORTED",u)),u=null)},u.onerror=function(){r(In("Network Error",e,null,u)),u=null},u.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(In(t,e,(e.transitional||Hn.transitional).clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",u)),u=null},kn.isStandardBrowserEnv()){var p=(e.withCredentials||Cn(f))&&e.xsrfCookieName?Mn.read(e.xsrfCookieName):void 0;p&&(o[e.xsrfHeaderName]=p)}"setRequestHeader"in u&&kn.forEach(o,(function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete o[t]:u.setRequestHeader(t,e)})),kn.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),s&&"json"!==s&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(i=function(e){u&&(r(!e||e&&e.type?new Un("canceled"):e),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(i),e.signal&&(e.signal.aborted?i():e.signal.addEventListener("abort",i))),n||(n=null),u.send(n)}))}),Qn),transformRequest:[function(e,t){return _n(t,"Accept"),_n(t,"Content-Type"),kn.isFormData(e)||kn.isArrayBuffer(e)||kn.isBuffer(e)||kn.isStream(e)||kn.isFile(e)||kn.isBlob(e)?e:kn.isArrayBufferView(e)?e.buffer:kn.isURLSearchParams(e)?(Bn(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):kn.isObject(e)||t&&"application/json"===t["Content-Type"]?(Bn(t,"application/json"),function(e){if(kn.isString(e))try{return(0,JSON.parse)(e),kn.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Jn.transitional,r=!(t&&t.silentJSONParsing)&&"json"===this.responseType;if(r||t&&t.forcedJSONParsing&&kn.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw En(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};kn.forEach(["delete","get","head"],(function(e){Jn.headers[e]={}})),kn.forEach(["post","put","patch"],(function(e){Jn.headers[e]=kn.merge(Ln)}));var Hn=Jn,Kn=function(e,t,r){var i=this||Hn;return kn.forEach(r,(function(r){e=r.call(i,e,t)})),e},Vn=function(e){return!(!e||!e.__CANCEL__)};function Zn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Un("canceled")}var Gn=function(e){return Zn(e),e.headers=e.headers||{},e.data=Kn.call(e,e.data,e.headers,e.transformRequest),e.headers=kn.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),kn.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||Hn.adapter)(e).then((function(t){return Zn(e),t.data=Kn.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return Vn(t)||(Zn(e),t&&t.response&&(t.response.data=Kn.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Wn=function(e,t){t=t||{};var r={};function i(e,t){return kn.isPlainObject(e)&&kn.isPlainObject(t)?kn.merge(e,t):kn.isPlainObject(t)?kn.merge({},t):kn.isArray(t)?t.slice():t}function n(r){return kn.isUndefined(t[r])?kn.isUndefined(e[r])?void 0:i(void 0,e[r]):i(e[r],t[r])}function o(e){if(!kn.isUndefined(t[e]))return i(void 0,t[e])}function s(r){return kn.isUndefined(t[r])?kn.isUndefined(e[r])?void 0:i(void 0,e[r]):i(void 0,t[r])}function a(r){return r in t?i(e[r],t[r]):r in e?i(void 0,e[r]):void 0}var u={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a};return kn.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=u[e]||n,i=t(e);kn.isUndefined(i)&&t!==a||(r[e]=i)})),r},Xn={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Xn[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var Yn={};Xn.transitional=function(e,t,r){function i(e,t){return"[Axios v0.25.0] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,o){if(!1===e)throw new Error(i(n," has been removed"+(t?" in "+t:"")));return t&&!Yn[n]&&(Yn[n]=!0,console.warn(i(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}};var eo={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),n=i.length;n-- >0;){var o=i[n],s=t[o];if(s){var a=e[o],u=void 0===a||s(a,o,e);if(!0!==u)throw new TypeError("option "+o+" must be "+u)}else if(!0!==r)throw Error("Unknown option "+o)}},validators:Xn},to=eo.validators;function ro(e){this.defaults=e,this.interceptors={request:new Pn,response:new Pn}}ro.prototype.request=function(e,t){if("string"==typeof e?(t=t||{}).url=e:t=e||{},!t.url)throw new Error("Provided config url is not valid");(t=Wn(this.defaults,t)).method=t.method?t.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var r=t.transitional;void 0!==r&&eo.assertOptions(r,{silentJSONParsing:to.transitional(to.boolean),forcedJSONParsing:to.transitional(to.boolean),clarifyTimeoutError:to.transitional(to.boolean)},!1);var i=[],n=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(n=n&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));var o,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!n){var a=[Gn,void 0];for(Array.prototype.unshift.apply(a,i),a=a.concat(s),o=Promise.resolve(t);a.length;)o=o.then(a.shift(),a.shift());return o}for(var u=t;i.length;){var c=i.shift(),l=i.shift();try{u=c(u)}catch(e){l(e);break}}try{o=Gn(u)}catch(e){return Promise.reject(e)}for(;s.length;)o=o.then(s.shift(),s.shift());return o},ro.prototype.getUri=function(e){if(!e.url)throw new Error("Provided config url is not valid");return e=Wn(this.defaults,e),Tn(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},kn.forEach(["delete","get","head","options"],(function(e){ro.prototype[e]=function(t,r){return this.request(Wn(r||{},{method:e,url:t,data:(r||{}).data}))}})),kn.forEach(["post","put","patch"],(function(e){ro.prototype[e]=function(t,r,i){return this.request(Wn(i||{},{method:e,url:t,data:r}))}}));var io=ro;function no(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;this.promise.then((function(e){if(r._listeners){var t,i=r._listeners.length;for(t=0;t<i;t++)r._listeners[t](e);r._listeners=null}})),this.promise.then=function(e){var t,i=new Promise((function(e){r.subscribe(e),t=e})).then(e);return i.cancel=function(){r.unsubscribe(t)},i},e((function(e){r.reason||(r.reason=new Un(e),t(r.reason))}))}no.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},no.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},no.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},no.source=function(){var e;return{token:new no((function(t){e=t})),cancel:e}};var oo=no,so=function e(t){var r=new io(t),i=wn(io.prototype.request,r);return kn.extend(i,io.prototype,r),kn.extend(i,r),i.create=function(r){return e(Wn(t,r))},i}(Hn);so.Axios=io,so.Cancel=Un,so.CancelToken=oo,so.isCancel=Vn,so.VERSION="0.25.0",so.all=function(e){return Promise.all(e)},so.spread=function(e){return function(t){return e.apply(null,t)}},so.isAxiosError=function(e){return kn.isObject(e)&&!0===e.isAxiosError};var ao=so;ao.default=so;const uo=ao.create({baseURL:on});var co="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function lo(e,t,r){return e(r={path:t,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},r.exports),r.exports}var ho,fo="object"==typeof co&&co&&co.Object===Object&&co,vo="object"==typeof self&&self&&self.Object===Object&&self,po=fo||vo||Function("return this")(),yo=po.Symbol,mo=Object.prototype,Ro=mo.hasOwnProperty,bo=mo.toString,wo=yo?yo.toStringTag:void 0,go=Object.prototype.toString,Oo=yo?yo.toStringTag:void 0,$o=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Oo&&Oo in Object(e)?function(e){var t=Ro.call(e,wo),r=e[wo];try{e[wo]=void 0;var i=!0}catch(e){}var n=bo.call(e);return i&&(t?e[wo]=r:delete e[wo]),n}(e):function(e){return go.call(e)}(e)},zo=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Ao=function(e){if(!zo(e))return!1;var t=$o(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},jo=po["__core-js_shared__"],So=(ho=/[^.]+$/.exec(jo&&jo.keys&&jo.keys.IE_PROTO||""))?"Symbol(src)_1."+ho:"",xo=Function.prototype.toString,ko=function(e){if(null!=e){try{return xo.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Fo=/^\[object .+?Constructor\]$/,To=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qo=function(e){return!(!zo(e)||(t=e,So&&So in t))&&(Ao(e)?To:Fo).test(ko(e));var t},Po=function(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return qo(r)?r:void 0},_o=function(){try{var e=Po(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Eo=function(e,t,r){"__proto__"==t&&_o?_o(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},Io=function(e,t,r){for(var i=-1,n=Object(e),o=r(e),s=o.length;s--;){var a=o[++i];if(!1===t(n[a],a,n))break}return e},Mo=function(e){return null!=e&&"object"==typeof e},No=function(e){return Mo(e)&&"[object Arguments]"==$o(e)},Co=Object.prototype,Do=Co.hasOwnProperty,Uo=Co.propertyIsEnumerable,Lo=No(function(){return arguments}())?No:function(e){return Mo(e)&&Do.call(e,"callee")&&!Uo.call(e,"callee")},Bo=Array.isArray,Qo=function(){return!1},Jo=lo((function(e,t){var r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,n=i&&i.exports===r?po.Buffer:void 0;e.exports=(n?n.isBuffer:void 0)||Qo})),Ho=/^(?:0|[1-9]\d*)$/,Ko=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ho.test(e))&&e>-1&&e%1==0&&e<t},Vo=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Zo={};Zo["[object Float32Array]"]=Zo["[object Float64Array]"]=Zo["[object Int8Array]"]=Zo["[object Int16Array]"]=Zo["[object Int32Array]"]=Zo["[object Uint8Array]"]=Zo["[object Uint8ClampedArray]"]=Zo["[object Uint16Array]"]=Zo["[object Uint32Array]"]=!0,Zo["[object Arguments]"]=Zo["[object Array]"]=Zo["[object ArrayBuffer]"]=Zo["[object Boolean]"]=Zo["[object DataView]"]=Zo["[object Date]"]=Zo["[object Error]"]=Zo["[object Function]"]=Zo["[object Map]"]=Zo["[object Number]"]=Zo["[object Object]"]=Zo["[object RegExp]"]=Zo["[object Set]"]=Zo["[object String]"]=Zo["[object WeakMap]"]=!1;var Go,Wo=lo((function(e,t){var r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,n=i&&i.exports===r&&fo.process,o=function(){try{return i&&i.require&&i.require("util").types||n&&n.binding&&n.binding("util")}catch(e){}}();e.exports=o})),Xo=Wo&&Wo.isTypedArray,Yo=Xo?(Go=Xo,function(e){return Go(e)}):function(e){return Mo(e)&&Vo(e.length)&&!!Zo[$o(e)]},es=Object.prototype.hasOwnProperty,ts=function(e,t){var r=Bo(e),i=!r&&Lo(e),n=!r&&!i&&Jo(e),o=!r&&!i&&!n&&Yo(e),s=r||i||n||o,a=s?function(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}(e.length,String):[],u=a.length;for(var c in e)!t&&!es.call(e,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ko(c,u))||a.push(c);return a},rs=Object.prototype,is=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||rs)},ns=function(e,t){return function(r){return e(t(r))}},os=ns(Object.keys,Object),ss=Object.prototype.hasOwnProperty,as=function(e){return null!=e&&Vo(e.length)&&!Ao(e)},us=function(e){return as(e)?ts(e):function(e){if(!is(e))return os(e);var t=[];for(var r in Object(e))ss.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)},cs=function(e,t){return e&&Io(e,t,us)},ls=function(e,t){return e===t||e!=e&&t!=t},ds=function(e,t){for(var r=e.length;r--;)if(ls(e[r][0],t))return r;return-1},hs=Array.prototype.splice;function fs(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}fs.prototype.clear=function(){this.__data__=[],this.size=0},fs.prototype.delete=function(e){var t=this.__data__,r=ds(t,e);return!(r<0||(r==t.length-1?t.pop():hs.call(t,r,1),--this.size,0))},fs.prototype.get=function(e){var t=this.__data__,r=ds(t,e);return r<0?void 0:t[r][1]},fs.prototype.has=function(e){return ds(this.__data__,e)>-1},fs.prototype.set=function(e,t){var r=this.__data__,i=ds(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this};var vs=fs,ps=Po(po,"Map"),ys=Po(Object,"create"),ms=Object.prototype.hasOwnProperty,Rs=Object.prototype.hasOwnProperty;function bs(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}bs.prototype.clear=function(){this.__data__=ys?ys(null):{},this.size=0},bs.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},bs.prototype.get=function(e){var t=this.__data__;if(ys){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return ms.call(t,e)?t[e]:void 0},bs.prototype.has=function(e){var t=this.__data__;return ys?void 0!==t[e]:Rs.call(t,e)},bs.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ys&&void 0===t?"__lodash_hash_undefined__":t,this};var ws=bs,gs=function(e,t){var r,i,n=e.__data__;return("string"==(i=typeof(r=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof t?"string":"hash"]:n.map};function Os(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Os.prototype.clear=function(){this.size=0,this.__data__={hash:new ws,map:new(ps||vs),string:new ws}},Os.prototype.delete=function(e){var t=gs(this,e).delete(e);return this.size-=t?1:0,t},Os.prototype.get=function(e){return gs(this,e).get(e)},Os.prototype.has=function(e){return gs(this,e).has(e)},Os.prototype.set=function(e,t){var r=gs(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this};var $s=Os;function zs(e){var t=this.__data__=new vs(e);this.size=t.size}zs.prototype.clear=function(){this.__data__=new vs,this.size=0},zs.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},zs.prototype.get=function(e){return this.__data__.get(e)},zs.prototype.has=function(e){return this.__data__.has(e)},zs.prototype.set=function(e,t){var r=this.__data__;if(r instanceof vs){var i=r.__data__;if(!ps||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new $s(i)}return r.set(e,t),this.size=r.size,this};var As=zs;function js(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new $s;++t<r;)this.add(e[t])}js.prototype.add=js.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},js.prototype.has=function(e){return this.__data__.has(e)};var Ss=js,xs=function(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1},ks=function(e,t,r,i,n,o){var s=1&r,a=e.length,u=t.length;if(a!=u&&!(s&&u>a))return!1;var c=o.get(e),l=o.get(t);if(c&&l)return c==t&&l==e;var d=-1,h=!0,f=2&r?new Ss:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var v=e[d],p=t[d];if(i)var y=s?i(p,v,d,t,e,o):i(v,p,d,e,t,o);if(void 0!==y){if(y)continue;h=!1;break}if(f){if(!xs(t,(function(e,t){if(!f.has(t)&&(v===e||n(v,e,r,i,o)))return f.push(t)}))){h=!1;break}}else if(v!==p&&!n(v,p,r,i,o)){h=!1;break}}return o.delete(e),o.delete(t),h},Fs=po.Uint8Array,Ts=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r},qs=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},Ps=yo?yo.prototype:void 0,_s=Ps?Ps.valueOf:void 0,Es=function(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e},Is=function(e,t,r){var i=t(e);return Bo(e)?i:Es(i,r(e))},Ms=function(){return[]},Ns=Object.prototype.propertyIsEnumerable,Cs=Object.getOwnPropertySymbols,Ds=Cs?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var r=-1,i=null==e?0:e.length,n=0,o=[];++r<i;){var s=e[r];t(s,r,e)&&(o[n++]=s)}return o}(Cs(e),(function(t){return Ns.call(e,t)})))}:Ms,Us=function(e){return Is(e,us,Ds)},Ls=Object.prototype.hasOwnProperty,Bs=Po(po,"DataView"),Qs=Po(po,"Promise"),Js=Po(po,"Set"),Hs=Po(po,"WeakMap"),Ks=ko(Bs),Vs=ko(ps),Zs=ko(Qs),Gs=ko(Js),Ws=ko(Hs),Xs=$o;(Bs&&"[object DataView]"!=Xs(new Bs(new ArrayBuffer(1)))||ps&&"[object Map]"!=Xs(new ps)||Qs&&"[object Promise]"!=Xs(Qs.resolve())||Js&&"[object Set]"!=Xs(new Js)||Hs&&"[object WeakMap]"!=Xs(new Hs))&&(Xs=function(e){var t=$o(e),r="[object Object]"==t?e.constructor:void 0,i=r?ko(r):"";if(i)switch(i){case Ks:return"[object DataView]";case Vs:return"[object Map]";case Zs:return"[object Promise]";case Gs:return"[object Set]";case Ws:return"[object WeakMap]"}return t});var Ys=Xs,ea=Object.prototype.hasOwnProperty,ta=function(e,t,r,i,n,o){var s=Bo(e),a=Bo(t),u=s?"[object Array]":Ys(e),c=a?"[object Array]":Ys(t),l="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),d="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),h=u==c;if(h&&Jo(e)){if(!Jo(t))return!1;s=!0,l=!1}if(h&&!l)return o||(o=new As),s||Yo(e)?ks(e,t,r,i,n,o):function(e,t,r,i,n,o,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new Fs(e),new Fs(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ls(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Ts;case"[object Set]":if(a||(a=qs),e.size!=t.size&&!(1&i))return!1;var u=s.get(e);if(u)return u==t;i|=2,s.set(e,t);var c=ks(a(e),a(t),i,n,o,s);return s.delete(e),c;case"[object Symbol]":if(_s)return _s.call(e)==_s.call(t)}return!1}(e,t,u,r,i,n,o);if(!(1&r)){var f=l&&ea.call(e,"__wrapped__"),v=d&&ea.call(t,"__wrapped__");if(f||v){var p=f?e.value():e,y=v?t.value():t;return o||(o=new As),n(p,y,r,i,o)}}return!!h&&(o||(o=new As),function(e,t,r,i,n,o){var s=1&r,a=Us(e),u=a.length;if(u!=Us(t).length&&!s)return!1;for(var c=u;c--;){var l=a[c];if(!(s?l in t:Ls.call(t,l)))return!1}var d=o.get(e),h=o.get(t);if(d&&h)return d==t&&h==e;var f=!0;o.set(e,t),o.set(t,e);for(var v=s;++c<u;){var p=e[l=a[c]],y=t[l];if(i)var m=s?i(y,p,l,t,e,o):i(p,y,l,e,t,o);if(!(void 0===m?p===y||n(p,y,r,i,o):m)){f=!1;break}v||(v="constructor"==l)}if(f&&!v){var R=e.constructor,b=t.constructor;R==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof R&&R instanceof R&&"function"==typeof b&&b instanceof b||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,r,i,n,o))},ra=function e(t,r,i,n,o){return t===r||(null==t||null==r||!Mo(t)&&!Mo(r)?t!=t&&r!=r:ta(t,r,i,n,e,o))},ia=function(e){return e==e&&!zo(e)},na=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}},oa=function(e){var t=function(e){for(var t=us(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,ia(n)]}return t}(e);return 1==t.length&&t[0][2]?na(t[0][0],t[0][1]):function(r){return r===e||function(e,t,r,i){var n=r.length,o=n,s=!i;if(null==e)return!o;for(e=Object(e);n--;){var a=r[n];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++n<o;){var u=(a=r[n])[0],c=e[u],l=a[1];if(s&&a[2]){if(void 0===c&&!(u in e))return!1}else{var d=new As;if(i)var h=i(c,l,u,e,t,d);if(!(void 0===h?ra(l,c,3,i,d):h))return!1}}return!0}(r,e,t)}},sa=function(e){return"symbol"==typeof e||Mo(e)&&"[object Symbol]"==$o(e)},aa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ua=/^\w*$/,ca=function(e,t){if(Bo(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!sa(e))||ua.test(e)||!aa.test(e)||null!=t&&e in Object(t)};function la(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],o=r.cache;if(o.has(n))return o.get(n);var s=e.apply(this,i);return r.cache=o.set(n,s)||o,s};return r.cache=new(la.Cache||$s),r}la.Cache=$s;var da,ha,fa,va=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pa=/\\(\\)?/g,ya=(da=la((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(va,(function(e,r,i,n){t.push(i?n.replace(pa,"$1"):r||e)})),t}),(function(e){return 500===ha.size&&ha.clear(),e})),ha=da.cache,da),ma=function(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n},Ra=yo?yo.prototype:void 0,ba=Ra?Ra.toString:void 0,wa=function e(t){if("string"==typeof t)return t;if(Bo(t))return ma(t,e)+"";if(sa(t))return ba?ba.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r},ga=function(e){return null==e?"":wa(e)},Oa=function(e,t){return Bo(e)?e:ca(e,t)?[e]:ya(ga(e))},$a=function(e){if("string"==typeof e||sa(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},za=function(e,t){for(var r=0,i=(t=Oa(t,e)).length;null!=e&&r<i;)e=e[$a(t[r++])];return r&&r==i?e:void 0},Aa=function(e,t){return null!=e&&t in Object(e)},ja=function(e,t){return null!=e&&function(e,t,r){for(var i=-1,n=(t=Oa(t,e)).length,o=!1;++i<n;){var s=$a(t[i]);if(!(o=null!=e&&r(e,s)))break;e=e[s]}return o||++i!=n?o:!!(n=null==e?0:e.length)&&Vo(n)&&Ko(s,n)&&(Bo(e)||Lo(e))}(e,t,Aa)},Sa=function(e,t){return ca(e)&&ia(t)?na($a(e),t):function(r){var i=function(e,t,r){var i=null==e?void 0:za(e,t);return void 0===i?r:i}(r,e);return void 0===i&&i===t?ja(r,e):ra(t,i,3)}},xa=function(e){return e},ka=function(e){return ca(e)?(t=$a(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return za(t,e)}}(e);var t},Fa=function(e){return"function"==typeof e?e:null==e?xa:"object"==typeof e?Bo(e)?Sa(e[0],e[1]):oa(e):ka(e)},Ta=function(e,t){var r={};return t=Fa(t),cs(e,(function(e,i,n){Eo(r,i,t(e,i,n))})),r},qa=ns(Object.getPrototypeOf,Object),Pa=Function.prototype.toString,_a=Object.prototype.hasOwnProperty,Ea=Pa.call(Object),Ia=function(e){if(!Mo(e)||"[object Object]"!=$o(e))return!1;var t=qa(e);if(null===t)return!0;var r=_a.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Pa.call(r)==Ea},Ma=/\s/,Na=/^\s+/,Ca=function(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Ma.test(e.charAt(t)););return t}(e)+1).replace(Na,""):e},Da=/^[-+]0x[0-9a-f]+$/i,Ua=/^0b[01]+$/i,La=/^0o[0-7]+$/i,Ba=parseInt,Qa=function(e){return e?1/0===(e=function(e){if("number"==typeof e)return e;if(sa(e))return NaN;if(zo(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=zo(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ca(e);var r=Ua.test(e);return r||La.test(e)?Ba(e.slice(2),r?2:8):Da.test(e)?NaN:+e}(e))||-1/0===e?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},Ja=Math.max,Ha=function(e,t,r){var i=Object(e);if(!as(e)){var n=Fa(t);e=us(e),t=function(e){return n(i[e],e,i)}}var o=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:function(e){var t=Qa(e),r=t%1;return t==t?r?t-r:t:0}(r);return n<0&&(n=Ja(i+n,0)),function(e,t,r,i){for(var n=e.length,o=r+(i?1:-1);i?o--:++o<n;)if(t(e[o],o,e))return o;return-1}(e,Fa(t),n)}(e,t,r);return o>-1?i[n?e[o]:o]:void 0},Ka=function(e,t,r){(void 0!==r&&!ls(e[t],r)||void 0===r&&!(t in e))&&Eo(e,t,r)},Va=lo((function(e,t){var r=t&&!t.nodeType&&t,i=r&&e&&!e.nodeType&&e,n=i&&i.exports===r?po.Buffer:void 0,o=n?n.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,i=o?o(r):new e.constructor(r);return e.copy(i),i}})),Za=function(e,t){var r=t?function(e){var t=new e.constructor(e.byteLength);return new Fs(t).set(new Fs(e)),t}(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)},Ga=Object.create,Wa=function(){function e(){}return function(t){if(!zo(t))return{};if(Ga)return Ga(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Xa=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},Ya=Object.prototype.hasOwnProperty,eu=function(e,t,r){var i=e[t];Ya.call(e,t)&&ls(i,r)&&(void 0!==r||t in e)||Eo(e,t,r)},tu=function(e,t,r,i){var n=!r;r||(r={});for(var o=-1,s=t.length;++o<s;){var a=t[o],u=i?i(r[a],e[a],a,r,e):void 0;void 0===u&&(u=e[a]),n?Eo(r,a,u):eu(r,a,u)}return r},ru=Object.prototype.hasOwnProperty,iu=function(e){if(!zo(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=is(e),r=[];for(var i in e)("constructor"!=i||!t&&ru.call(e,i))&&r.push(i);return r},nu=function(e){return as(e)?ts(e,!0):iu(e)},ou=function(e,t,r,i,n,o,s){var a,u=Xa(e,r),c=Xa(t,r),l=s.get(c);if(l)Ka(e,r,l);else{var d=o?o(u,c,r+"",e,t,s):void 0,h=void 0===d;if(h){var f=Bo(c),v=!f&&Jo(c),p=!f&&!v&&Yo(c);d=c,f||v||p?Bo(u)?d=u:Mo(a=u)&&as(a)?d=function(e,t){var r=-1,i=e.length;for(t||(t=Array(i));++r<i;)t[r]=e[r];return t}(u):v?(h=!1,d=Va(c,!0)):p?(h=!1,d=Za(c,!0)):d=[]:Ia(c)||Lo(c)?(d=u,Lo(u)?d=function(e){return tu(e,nu(e))}(u):zo(u)&&!Ao(u)||(d=function(e){return"function"!=typeof e.constructor||is(e)?{}:Wa(qa(e))}(c))):h=!1}h&&(s.set(c,d),n(d,c,i,o,s),s.delete(c)),Ka(e,r,d)}},su=function e(t,r,i,n,o){t!==r&&Io(r,(function(s,a){if(o||(o=new As),zo(s))ou(t,r,a,i,e,n,o);else{var u=n?n(Xa(t,a),s,a+"",t,r,o):void 0;void 0===u&&(u=s),Ka(t,a,u)}}),nu)},au=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},uu=Math.max,cu=function(e,t,r){return t=uu(void 0===t?e.length-1:t,0),function(){for(var i=arguments,n=-1,o=uu(i.length-t,0),s=Array(o);++n<o;)s[n]=i[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=i[n];return a[t]=r(s),au(e,this,a)}},lu=Date.now,du=function(e){var t=0,r=0;return function(){var i=lu(),n=16-(i-r);if(r=i,n>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(_o?function(e,t){return _o(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:xa),hu=function(e){return function(e,t){return du(cu(e,t,xa),e+"")}((function(t,r){var i=-1,n=r.length,o=n>1?r[n-1]:void 0,s=n>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(n--,o):void 0,s&&function(e,t,r){if(!zo(r))return!1;var i=typeof t;return!!("number"==i?as(r)&&Ko(t,r.length):"string"==i&&t in r)&&ls(r[t],e)}(r[0],r[1],s)&&(o=n<3?void 0:o,n=1),t=Object(t);++i<n;){var a=r[i];a&&e(t,a,i,o)}return t}))},fu=hu((function(e,t,r){su(e,t,r)})),vu=function(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e},pu=function(e,t,r){var i=Bo(e),n=i||Jo(e)||Yo(e);if(t=Fa(t),null==r){var o=e&&e.constructor;r=n?i?new o:[]:zo(e)&&Ao(o)?Wa(qa(e)):{}}return(n?vu:cs)(e,(function(e,i,n){return t(r,e,i,n)})),r},yu=function(e,t,r,i){if(!zo(e))return e;for(var n=-1,o=(t=Oa(t,e)).length,s=o-1,a=e;null!=a&&++n<o;){var u=$a(t[n]),c=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(n!=s){var l=a[u];void 0===(c=i?i(l,u,a):void 0)&&(c=zo(l)?l:Ko(t[n+1])?[]:{})}eu(a,u,c),a=a[u]}return e},mu=function(e,t,r){for(var i=-1,n=t.length,o={};++i<n;){var s=t[i],a=za(e,s);r(a,s)&&yu(o,Oa(s,e),a)}return o},Ru=yo?yo.isConcatSpreadable:void 0,bu=function(e){return Bo(e)||Lo(e)||!!(Ru&&e&&e[Ru])},wu=function e(t,r,i,n,o){var s=-1,a=t.length;for(i||(i=bu),o||(o=[]);++s<a;){var u=t[s];r>0&&i(u)?r>1?e(u,r-1,i,n,o):Es(o,u):n||(o[o.length]=u)}return o},gu=function(e){return null!=e&&e.length?wu(e,1):[]},Ou=function(e){return du(cu(e,void 0,gu),e+"")}((function(e,t){return null==e?{}:function(e,t){return mu(e,t,(function(t,r){return ja(e,r)}))}(e,t)})),$u=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Es(t,Ds(e)),e=qa(e);return t}:Ms,zu=function(e,t){if(null==e)return{};var r=ma(function(e){return Is(e,nu,$u)}(e),(function(e){return[e]}));return t=Fa(t),mu(e,r,(function(e,r){return t(e,r[0])}))},Au=(fa=cs,function(e,t){if(null==e)return e;if(!as(e))return fa(e,t);for(var r=e.length,i=-1,n=Object(e);++i<r&&!1!==t(n[i],i,n););return e}),ju=function(e,t){return(Bo(e)?vu:Au)(e,"function"==typeof(r=t)?r:xa);var r},Su=Object.prototype.hasOwnProperty,xu=function(e,t){return Su.call(e,t)},ku=Array.prototype.splice,Fu=function(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&ku.call(e,r,1)},Tu=function(e){return e.split("").map((function(e){return"(?:"+[e.toUpperCase(),e.toLowerCase()].join("|")+")"})).join("")};function qu(){this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[],this.acronyms={},this.acronymRegex=/(?=a)b/}qu.getInstance=function(e){var t="undefined"!=typeof process?process:co;return t.__Inflector_Inflections=t.__Inflector_Inflections||{},t.__Inflector_Inflections[e]=t.__Inflector_Inflections[e]||new qu,t.__Inflector_Inflections[e]},qu.prototype.acronym=function(e){this.acronyms[e.toLowerCase()]=e;var t=[];for(var r in this.acronyms)xu(this.acronyms,r)&&t.push(this.acronyms[r]);this.acronymRegex=new RegExp(t.join("|"))},qu.prototype.plural=function(e,t){"string"==typeof e&&Fu(this.uncountables,e),Fu(this.uncountables,t),this.plurals.unshift([e,t])},qu.prototype.singular=function(e,t){"string"==typeof e&&Fu(this.uncountables,e),Fu(this.uncountables,t),this.singulars.unshift([e,t])},qu.prototype.irregular=function(e,t){Fu(this.uncountables,e),Fu(this.uncountables,t);var r=e[0],i=e.substr(1),n=t[0],o=t.substr(1);if(r.toUpperCase()===n.toUpperCase())this.plural(new RegExp("("+r+")"+i+"$","i"),"$1"+o),this.plural(new RegExp("("+n+")"+o+"$","i"),"$1"+o),this.singular(new RegExp("("+r+")"+i+"$","i"),"$1"+i),this.singular(new RegExp("("+n+")"+o+"$","i"),"$1"+i);else{var s=Tu(i),a=Tu(o);this.plural(new RegExp(r.toUpperCase()+s+"$"),n.toUpperCase()+o),this.plural(new RegExp(r.toLowerCase()+s+"$"),n.toLowerCase()+o),this.plural(new RegExp(n.toUpperCase()+a+"$"),n.toUpperCase()+o),this.plural(new RegExp(n.toLowerCase()+a+"$"),n.toLowerCase()+o),this.singular(new RegExp(r.toUpperCase()+s+"$"),r.toUpperCase()+i),this.singular(new RegExp(r.toLowerCase()+s+"$"),r.toLowerCase()+i),this.singular(new RegExp(n.toUpperCase()+a+"$"),r.toUpperCase()+i),this.singular(new RegExp(n.toLowerCase()+a+"$"),r.toLowerCase()+i)}},qu.prototype.uncountable=function(){var e=Array.prototype.slice.call(arguments,0);this.uncountables=this.uncountables.concat(e)},qu.prototype.human=function(e,t){this.humans.unshift([e,t])},qu.prototype.clear=function(e){"all"===(e=e||"all")?(this.plurals=[],this.singulars=[],this.uncountables=[],this.humans=[]):this[e]=[]};var Pu=qu,_u={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O","×":"x",Ø:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y",Þ:"Th",ß:"ss",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ð:"d",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",þ:"th",ÿ:"y",Ā:"A",ā:"a",Ă:"A",ă:"a",Ą:"A",ą:"a",Ć:"C",ć:"c",Ĉ:"C",ĉ:"c",Ċ:"C",ċ:"c",Č:"C",č:"c",Ď:"D",ď:"d",Đ:"D",đ:"d",Ē:"E",ē:"e",Ĕ:"E",ĕ:"e",Ė:"E",ė:"e",Ę:"E",ę:"e",Ě:"E",ě:"e",Ĝ:"G",ĝ:"g",Ğ:"G",ğ:"g",Ġ:"G",ġ:"g",Ģ:"G",ģ:"g",Ĥ:"H",ĥ:"h",Ħ:"H",ħ:"h",Ĩ:"I",ĩ:"i",Ī:"I",ī:"i",Ĭ:"I",ĭ:"i",Į:"I",į:"i",İ:"I",ı:"i",Ĳ:"IJ",ĳ:"ij",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",ĺ:"l",Ļ:"L",ļ:"l",Ľ:"L",ľ:"l",Ŀ:"L",ŀ:"l",Ł:"L",ł:"l",Ń:"N",ń:"n",Ņ:"N",ņ:"n",Ň:"N",ň:"n",ŉ:"'n",Ŋ:"NG",ŋ:"ng",Ō:"O",ō:"o",Ŏ:"O",ŏ:"o",Ő:"O",ő:"o",Œ:"OE",œ:"oe",Ŕ:"R",ŕ:"r",Ŗ:"R",ŗ:"r",Ř:"R",ř:"r",Ś:"S",ś:"s",Ŝ:"S",ŝ:"s",Ş:"S",ş:"s",Š:"S",š:"s",Ţ:"T",ţ:"t",Ť:"T",ť:"t",Ŧ:"T",ŧ:"t",Ũ:"U",ũ:"u",Ū:"U",ū:"u",Ŭ:"U",ŭ:"u",Ů:"U",ů:"u",Ű:"U",ű:"u",Ų:"U",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",ź:"z",Ż:"Z",ż:"z",Ž:"Z",ž:"z"};function Eu(){for(var e in this.approximations={},_u)this.approximate(e,_u[e])}Eu.getInstance=function(e){var t="undefined"!=typeof process?process:co;return t.__Inflector_Transliterator=t.__Inflector_Transliterator||{},t.__Inflector_Transliterator[e]=t.__Inflector_Transliterator[e]||new Eu,t.__Inflector_Transliterator[e]},Eu.prototype.approximate=function(e,t){this.approximations[e]=t},Eu.prototype.transliterate=function(e,t){var r=this;return e.replace(/[^\u0000-\u007f]/g,(function(e){return r.approximations[e]||t||"?"}))};var Iu=Eu,Mu={en:function(e){e.plural(/$/,"s"),e.plural(/s$/i,"s"),e.plural(/^(ax|test)is$/i,"$1es"),e.plural(/(octop|vir)us$/i,"$1i"),e.plural(/(octop|vir)i$/i,"$1i"),e.plural(/(alias|status)$/i,"$1es"),e.plural(/(bu)s$/i,"$1ses"),e.plural(/(buffal|tomat)o$/i,"$1oes"),e.plural(/([ti])um$/i,"$1a"),e.plural(/([ti])a$/i,"$1a"),e.plural(/sis$/i,"ses"),e.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),e.plural(/(hive)$/i,"$1s"),e.plural(/([^aeiouy]|qu)y$/i,"$1ies"),e.plural(/(x|ch|ss|sh)$/i,"$1es"),e.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),e.plural(/^(m|l)ouse$/i,"$1ice"),e.plural(/^(m|l)ice$/i,"$1ice"),e.plural(/^(ox)$/i,"$1en"),e.plural(/^(oxen)$/i,"$1"),e.plural(/(quiz)$/i,"$1zes"),e.singular(/s$/i,""),e.singular(/(ss)$/i,"$1"),e.singular(/(n)ews$/i,"$1ews"),e.singular(/([ti])a$/i,"$1um"),e.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)(sis|ses)$/i,"$1sis"),e.singular(/(^analy)(sis|ses)$/i,"$1sis"),e.singular(/([^f])ves$/i,"$1fe"),e.singular(/(hive)s$/i,"$1"),e.singular(/(tive)s$/i,"$1"),e.singular(/([lr])ves$/i,"$1f"),e.singular(/([^aeiouy]|qu)ies$/i,"$1y"),e.singular(/(s)eries$/i,"$1eries"),e.singular(/(m)ovies$/i,"$1ovie"),e.singular(/(x|ch|ss|sh)es$/i,"$1"),e.singular(/^(m|l)ice$/i,"$1ouse"),e.singular(/(bus)(es)?$/i,"$1"),e.singular(/(o)es$/i,"$1"),e.singular(/(shoe)s$/i,"$1"),e.singular(/(cris|test)(is|es)$/i,"$1is"),e.singular(/^(a)x[ie]s$/i,"$1xis"),e.singular(/(octop|vir)(us|i)$/i,"$1us"),e.singular(/(alias|status)(es)?$/i,"$1"),e.singular(/^(ox)en/i,"$1"),e.singular(/(vert|ind)ices$/i,"$1ex"),e.singular(/(matr)ices$/i,"$1ix"),e.singular(/(quiz)zes$/i,"$1"),e.singular(/(database)s$/i,"$1"),e.irregular("person","people"),e.irregular("man","men"),e.irregular("child","children"),e.irregular("sex","sexes"),e.irregular("move","moves"),e.irregular("zombie","zombies"),e.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans","police")}},Nu=Object.prototype.toString,Cu=function(e){return"[object Function]"===Nu.call(e)},Du={pluralize:function(e,t){return this._applyInflections(e,this.inflections(t=t||"en").plurals)},singularize:function(e,t){return this._applyInflections(e,this.inflections(t=t||"en").singulars)},camelize:function(e,t){null==t&&(t=!0);var r=""+e,i=this;return(r=t?r.replace(/^[a-z\d]*/,(function(e){return i.inflections().acronyms[e]||i.capitalize(e)})):r.replace(new RegExp("^(?:"+this.inflections().acronymRegex.source+"(?=\\b|[A-Z_])|\\w)"),(function(e){return e.toLowerCase()}))).replace(/(?:_|(\/))([a-z\d]*)/gi,(function(e,t,r){return t||(t=""),""+t+(i.inflections().acronyms[r]||i.capitalize(r))}))},underscore:function(e){var t=""+e;return(t=(t=(t=(t=t.replace(new RegExp("(?:([A-Za-z\\d])|^)("+this.inflections().acronymRegex.source+")(?=\\b|[^a-z])","g"),(function(e,t,r){return(t||"")+(t?"_":"")+r.toLowerCase()}))).replace(/([A-Z\d]+)([A-Z][a-z])/g,"$1_$2")).replace(/([a-z\d])([A-Z])/g,"$1_$2")).replace(/-/g,"_")).toLowerCase()},humanize:function(e,t){var r,i,n,o=""+e,s=this.inflections().humans,a=this;null==(t=t||{}).capitalize&&(t.capitalize=!0);for(var u=0,c=s.length;u<c;u++)if(n=(r=s[u])[1],(i=r[0]).test&&i.test(o)||o.indexOf(i)>-1){o=o.replace(i,n);break}return o=(o=(o=o.replace(/_id$/,"")).replace(/_/g," ")).replace(/([a-z\d]*)/gi,(function(e){return a.inflections().acronyms[e]||e.toLowerCase()})),t.capitalize&&(o=o.replace(/^\w/,(function(e){return e.toUpperCase()}))),o},capitalize:function(e){var t=null==e?"":String(e);return t.charAt(0).toUpperCase()+t.slice(1)},titleize:function(e){return this.humanize(this.underscore(e)).replace(/(^|[\s¿\/]+)([a-z])/g,(function(e,t,r){return e.replace(r,r.toUpperCase())}))},tableize:function(e){return this.pluralize(this.underscore(e))},classify:function(e){return this.camelize(this.singularize(e.replace(/.*\./g,"")))},dasherize:function(e){return e.replace(/_/g,"-")},foreignKey:function(e,t){return null==t&&(t=!0),this.underscore(e)+(t?"_id":"id")},ordinal:function(e){var t=Math.abs(Number(e)),r=t%100;if(11===r||12===r||13===r)return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},ordinalize:function(e){return""+e+this.ordinal(e)},transliterate:function(e,t){var r=(t=t||{}).replacement||"?";return this.transliterations(t.locale||"en").transliterate(e,r)},parameterize:function(e,t){void 0===(t=t||{}).separator&&(t.separator="-"),null===t.separator&&(t.separator="");var r=this.transliterate(e,t);if(r=r.replace(/[^a-z0-9\-_]+/gi,t.separator),t.separator.length){var i=new RegExp(t.separator);r=(r=r.replace(new RegExp(i.source+"{2,}"),t.separator)).replace(new RegExp("^"+i.source+"|"+i.source+"$","i"),"")}return r.toLowerCase()},_applyInflections:function(e,t){var r,i,n,o=""+e;if(0===o.length)return o;var s=o.toLowerCase().match(/\b\w+$/);if(s&&this.inflections().uncountables.indexOf(s[0])>-1)return o;for(var a=0,u=t.length;a<u;a++)if(n=(r=t[a])[1],o.match(i=r[0])){o=o.replace(i,n);break}return o},inflections:function(e,t){if(Cu(e)&&(t=e,e=null),e=e||"en",!t)return Pu.getInstance(e);t(Pu.getInstance(e))},transliterations:function(e,t){if(Cu(e)&&(t=e,e=null),e=e||"en",!t)return Iu.getInstance(e);t(Iu.getInstance(e))}};for(var Uu in Mu)Du.inflections(Uu,Mu[Uu]);var Lu=Du,Bu=function(e,t){switch(e=Lu.underscore(e),t.keyForAttribute){case"dash-case":case"lisp-case":case"spinal-case":case"kebab-case":return Lu.dasherize(e);case"underscore_case":case"snake_case":return e;case"CamelCase":return Lu.camelize(e);case"camelCase":return Lu.camelize(e,!1);default:return Lu.dasherize(e)}},Qu=function(e,t,r,i){function n(e){return Array.isArray(e)||Ia(e)}function o(e){return Ia(e)?pu(e,(function(e,t,r){n(t)?e[o(r)]=o(t):e[o(r)]=t})):Array.isArray(e)?e.map((function(e){return n(e)?o(e):e})):Ao(i.keyForAttribute)?i.keyForAttribute(e):Bu(e,i)}function s(){return i.id||"id"}function a(e,t){var r;return t=t||{},Ao(i.typeForAttribute)&&(r=i.typeForAttribute(e,t)),void 0!==i.pluralizeType&&!i.pluralizeType||void 0!==r||(r=function(e){return Lu.pluralize(e)}(e)),void 0===r&&(r=e),r}function u(e,r,i){return Ta(r,(function(r){return Ao(r)?r(t,e,i):r}))}function c(e,r){return Ao(r)?r(t):Ta(r,(function(r){return Ao(r)?r(t,e):r}))}function l(e,t){return function(e,t){var r={};return t=Fa(t),cs(e,(function(e,i,n){Eo(r,t(e,i,n),e)})),r}(Ou(e,t),(function(e,t){return o(t)}))}this.serialize=function(e,t,r,i){var n=this,s=null;if(i&&i.ref){if(e.relationships||(e.relationships={}),s=Array.isArray(t[r])?t[r].map((function(e){return n.serializeRef(e,t,r,i)})):n.serializeRef(t[r],t,r,i),e.relationships[o(r)]={},i.ignoreRelationshipData||(e.relationships[o(r)].data=s),i.relationshipLinks){var a=u(t[r],i.relationshipLinks,e);a.related&&(e.relationships[o(r)].links=a)}i.relationshipMeta&&(e.relationships[o(r)].meta=c(t[r],i.relationshipMeta))}else Array.isArray(t[r])?(s=t[r].length&&Ia(t[r][0])?t[r].map((function(e){return n.serializeNested(e,t,r,i)})):t[r],e.attributes[o(r)]=s):Ia(t[r])?(s=n.serializeNested(t[r],t,r,i),e.attributes[o(r)]=s):e.attributes[o(r)]=t[r]},this.serializeRef=function(e,t,i,o){var s=this,c=function(e,t,r){if(Ao(r.ref))return r.ref(e,t);if(!0===r.ref){if(Array.isArray(t))return t.map((function(e){return String(e)}));if(t)return String(t)}else if(t&&t[r.ref])return String(t[r.ref])}(t,e,o),d=a(i,e),h=[],f=[];o.attributes&&(e&&o.attributes.forEach((function(t){o[t]&&!e[t]&&o[t].nullIfMissing&&(e[t]=null)})),h=o.attributes.filter((function(e){return o[e]})),f=o.attributes.filter((function(e){return!o[e]})));var v={type:d,id:c};return f&&(v.attributes=l(e,f)),h.forEach((function(t){e&&(n(e[t])||null===e[t])&&s.serialize(v,e,t,o[t])})),f.length&&(void 0===o.included||o.included)&&(o.includedLinks&&(v.links=u(e,o.includedLinks)),void 0!==c&&function(e,t){var i,n=Ha(r.included,{id:(i=t).id,type:i.type});n?(n.relationships=fu(n.relationships,zu(t.relationships,xa)),n.attributes=fu(n.attributes,zu(t.attributes,xa))):(e.included||(e.included=[]),e.included.push(t))}(r,v)),void 0!==c?{type:d,id:c}:null},this.serializeNested=function(e,t,r,i){var o=this,s=[],a=[],u={};return i&&i.attributes?(s=i.attributes.filter((function(e){return i[e]})),(a=i.attributes.filter((function(e){return!i[e]})))&&(u.attributes=l(e,a)),s.forEach((function(t){n(e[t])&&o.serialize(u,e,t,i[t])}))):u.attributes=e,u.attributes},this.perform=function(){var r=this;if(null===t)return null;i&&i.transform&&(t=i.transform(t));var n={type:a(e,t)};return null==t[s()]||(n.id=String(t[s()])),i.dataLinks&&(n.links=u(t,i.dataLinks)),i.dataMeta&&(n.meta=c(t,i.dataMeta)),ju(i.attributes,(function(e){var o=e.split(":");if(i[e]&&!t[e]&&i[e].nullIfMissing&&(t[e]=null),o[0]in t){n.attributes||(n.attributes={});var s=e;o.length>1&&(e=o[0],s=o[1]),r.serialize(n,t,e,i[s])}})),n}},Ju=(hu((function(e,t){tu(t,nu(t),e)})),function(e,t,r){if(this.serialize=function(e){var t=this,r={};return t.opts.topLevelLinks&&(r.links=Ta(t.opts.topLevelLinks,(function(t){return Ao(t)?t(e):t}))),t.opts.meta&&(r.meta=Ta(t.opts.meta,(function(t){return Ao(t)?t(e):t}))),Array.isArray(e)?(r.data=[],e.forEach((function(e){var i=new Qu(t.collectionName,e,r,t.opts);r.data.push(i.perform())})),r):(r.data=new Qu(t.collectionName,e,r,t.opts).perform(e),r)},3===arguments.length)return this.collectionName=e,this.opts=r,this.serialize(t);this.collectionName=e,this.opts=t});const Hu=(e,t)=>new Ju(e,{attributes:t.attributes,keyForAttribute:"camelCase"}),Ku={getEmails:async()=>(await bn.query((e=>e.findRecords("mail")))).map(Vu),async saveEdittedEmail(e){const t=Hu("mail",{attributes:["from","subject","text","datetime","starred"]}).serialize(e);await uo.patch(`mails/${e.id}`,t)},getEmail:async e=>Vu(await bn.query((t=>t.findRecord({type:"mail",id:e}))))};function Vu(e){const t=e;return t.attributes.id=t.id,t.attributes.datetime=new Date(t.attributes.datetime),t.attributes}export{on as A,Ku as E,pn as O,f as R,lo as a,Pi as b,co as c,p as d,h,z as m}